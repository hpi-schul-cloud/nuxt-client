<template>
	<v-container fluid>
		<v-custom-breadcrumbs :breadcrumbs="breadcrumbs"></v-custom-breadcrumbs>
		<v-container class="container-max-width">
			<h1 class="text-h3 page-title">
				{{ $t("pages.administration.school.index.title") }}
			</h1>
			<v-alert v-if="schoolError" light prominent text type="error">
				{{ $t("pages.administration.school.index.error") }}
			</v-alert>
			<img
				v-if="schoolError"
				class="school-error-image"
				role="presentation"
				alt=""
				src="@assets/img/pc_repair.png"
			/>
			<div v-if="!schoolError" class="no-school-error">
				<v-alert light prominent text type="info">
					{{ $t("pages.administration.school.index.beta.info") }}
					<a href="/help/contact">{{
						$t("pages.administration.school.index.beta.feedback")
					}}</a
					><br />
					<a href="/administration/school/">{{
						$t("pages.administration.school.index.beta.back")
					}}</a>
				</v-alert>
				<h2 class="text-h4">
					{{ currentSchoolYear }}
				</h2>
				<p>
					{{
						$t(
							"pages.administration.school.index.longText.provideStudentsAndTheirParents"
						)
					}}
				</p>
				<v-divider class="my-sm-6 my-md-8"></v-divider>
				<v-row>
					<v-col>
						<general-settings></general-settings>
						<school-policies v-if="schoolPolicyEnabled"></school-policies>
						<template v-if="loading">
							<v-skeleton-loader type="table-thead, table-row, table-row" />
						</template>
						<auth-systems v-else :systems="systems"></auth-systems>
					</v-col>
				</v-row>
			</div>
		</v-container>
	</v-container>
</template>

<script>
import EnvConfigModule from "@store/env-config";
import SchoolsModule from "@/store/schools";
import vCustomBreadcrumbs from "@components/molecules/vCustomBreadcrumbs";
import GeneralSettings from "@components/organisms/administration/GeneralSettings";
import SchoolPolicies from "@components/organisms/administration/SchoolPolicies";
import AuthSystems from "@components/organisms/administration/AuthSystems";

export default {
	components: {
		vCustomBreadcrumbs,
		GeneralSettings,
		SchoolPolicies,
		AuthSystems,
	},
	layout: "defaultVuetify",
	data() {
		return {
			breadcrumbs: [
				{
					text: this.$t("pages.administration.index.title"),
					href: "/administration/",
				},
				{
					text: this.$t("pages.administration.school.index.title"),
					disabled: true,
				},
			],
		};
	},
	computed: {
		systems() {
			return SchoolsModule.getSystems;
		},
		currentYear() {
			return SchoolsModule.getCurrentYear;
		},
		loading() {
			return SchoolsModule.getLoading;
		},
		schoolError() {
			return SchoolsModule.getError;
		},
		schoolPolicyEnabled: () => EnvConfigModule.getSchoolPolicyEnabled,
		currentSchoolYear() {
			return `${this.$t("common.words.schoolYear")} ${this.currentYear.name}`;
		},
	},
	watch: {
		schoolError: (error) => {
			console.error("school could not be loaded", error);
		},
	},
	head() {
		return {
			title: `${this.$t("pages.administration.school.index.title")} - ${
				this.$theme.short_name
			}`,
		};
	},
};
</script>

<style lang="scss" scoped>
@import "@styles";

.container-max-width {
	max-width: var(--size-content-width-max);
}
</style>
