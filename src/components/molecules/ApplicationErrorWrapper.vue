<template>
	<div class="application-error-wrapper">
		<div v-if="hasError" class="text-centered mt-8">
			<error-content
				:status-code="appErrorStatusCode"
				:error-text="translatedErrorMessage"
				data-testid="error-content"
			/>
			<v-btn
				class="mt-4"
				color="primary"
				variant="flat"
				ref="btn-back"
				data-testid="btn-back"
				href="/dashboard"
			>
				{{ $t("error.action.back") }}
			</v-btn>
		</div>
		<slot v-else></slot>
	</div>
</template>
<script lang="ts">
import { injectStrict, APPLICATION_ERROR_KEY } from "@/utils/inject";
import { computed, defineComponent } from "vue";
import ErrorContent from "@/components/error-handling/ErrorContent.vue";
import { useI18n } from "vue-i18n";

export default defineComponent({
	name: "ApplicationErrorRouting",
	components: {
		ErrorContent,
	},
	setup() {
		const applicationErrorModule = injectStrict(APPLICATION_ERROR_KEY);
		const { t } = useI18n();

		const hasError = computed(
			() => applicationErrorModule.getStatusCode !== null
		);

		const appErrorStatusCode = computed(() =>
			Number(applicationErrorModule.getStatusCode)
		);
		const translatedErrorMessage = computed(() =>
			hasError.value
				? t(applicationErrorModule.getTranslationKey).toString()
				: ""
		);

		return {
			hasError,
			appErrorStatusCode,
			translatedErrorMessage,
		};
	},
});
</script>
<style lang="scss" scoped>
.text-centered {
	text-align: center;
}
</style>
