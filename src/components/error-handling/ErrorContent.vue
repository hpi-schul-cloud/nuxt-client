<template>
	<div>
		<permission-error-svg
			v-if="isPermissionError"
			:svg-width="$vuetify.display.xs ? 200 : undefined"
			fill="rgba(var(--v-theme-primary))"
			data-testid="img-permission"
		/>
		<not-found-svg
			v-else-if="isNotFoundError"
			:svg-width="$vuetify.display.xs ? 200 : undefined"
			fill="rgba(var(--v-theme-primary))"
			data-testid="img-notfound"
		/>
		<img
			v-else
			:alt="errorText"
			src="@/assets/img/pc_repair.png"
			class="pa-4 w-66"
			data-testid="img-generic"
		/>

		<h1 class="h4 error-msg pl-4 pr-4" data-testid="err-text">
			{{ errorText }}
		</h1>
	</div>
</template>

<script lang="ts">
import { computed, defineComponent } from "vue";
import PermissionErrorSvg from "@/assets/img/PermissionErrorSvg.vue";
import NotFoundSvg from "@/assets/img/NotFoundSvg.vue";
import { HttpStatusCode } from "@/store/types/http-status-code.enum";
import { useTitle } from "@vueuse/core";
import { buildPageTitle } from "@/utils/pageTitle";
import { useI18n } from "vue-i18n";

export default defineComponent({
	name: "ErrorContent",
	components: { PermissionErrorSvg, NotFoundSvg },
	props: {
		errorText: String,
		statusCode: {
			type: Number,
			default: HttpStatusCode.InternalServerError,
		},
	},
	setup(props) {
		const { t } = useI18n();

		const pageTitle = buildPageTitle(t("error.generic"));
		useTitle(pageTitle);

		const permissionErrorStatusCodes: HttpStatusCode[] = [
			HttpStatusCode.Unauthorized,
			HttpStatusCode.Forbidden,
		];

		const isPermissionError = computed(() =>
			permissionErrorStatusCodes.includes(props.statusCode)
		);

		const isNotFoundError = computed(
			() => props.statusCode === HttpStatusCode.NotFound
		);

		return {
			isPermissionError,
			isNotFoundError,
		};
	},
});
</script>
