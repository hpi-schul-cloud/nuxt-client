<template>
	<div>
		<h1 class="mb--md h4">
			{{ $t("pages.administration.ldapEdit.roles.headLines.title") }}
		</h1>
		<p class="description-section">
			{{
				$t("pages.administration.ldapEdit.roles.headLines.sectionDescription")
			}}
		</p>
		<div role="group" class="section-sub-header">
			<base-input
				:modelValue="groupOption"
				type="radio"
				:label="
					$t('pages.administration.ldapEdit.roles.labels.radio.ldapGroup')
				"
				name="group"
				style="margin-right: var(--space-sm)"
				value="group"
				@update:modelValue="$emit('input', { ...value, groupOption: $event })"
			>
			</base-input>
			<base-input
				:modelValue="groupOption"
				type="radio"
				:label="
					$t('pages.administration.ldapEdit.roles.labels.radio.userAttribute')
				"
				name="group"
				value="user_attribute"
				@update:modelValue="$emit('input', { ...value, groupOption: $event })"
			>
			</base-input>
			<p class="text-sm" style="margin-top: var(--space-xs)">
				{{ $t("pages.administration.ldapEdit.roles.labels.radio.description") }}
			</p>
		</div>
		<base-input
			:modelValue="value.member"
			:disabled="groupOption === 'group'"
			type="text"
			:label="$t('pages.administration.ldapEdit.roles.labels.member')"
			:placeholder="
				$t('pages.administration.ldapEdit.roles.placeholder.member')
			"
			style="margin-bottom: var(--space-xl)"
			:validation-model="v$.value.member"
			:validation-messages="memberValidationMessages"
			data-testid="ldapDataRolesMember"
			@update:modelValue="$emit('input', { ...value, member: $event })"
		>
			<template #icon>
				<v-icon :color="ldapActivatedColor">$mdiAccountOutline</v-icon>
			</template>
		</base-input>
		<base-input
			:modelValue="value.student"
			type="text"
			v-bind="$attrs"
			:label="$t('pages.administration.ldapEdit.roles.labels.student')"
			:placeholder="
				$t('pages.administration.ldapEdit.roles.placeholder.student')
			"
			:info="$t('pages.administration.ldapEdit.roles.info.student')"
			:validation-model="v$.value.student"
			:validation-messages="rolesValidationMessages"
			data-testid="ldapDataRolesStudent"
			@update:modelValue="$emit('input', { ...value, student: $event })"
		>
			<template #icon>
				<v-icon :color="fillColor">$mdiAccountSchoolOutline</v-icon>
			</template>
		</base-input>
		<base-input
			:modelValue="value.teacher"
			type="text"
			:label="$t('pages.administration.ldapEdit.roles.labels.teacher')"
			:placeholder="
				$t('pages.administration.ldapEdit.roles.placeholder.teacher')
			"
			:info="$t('pages.administration.ldapEdit.roles.info.teacher')"
			:validation-model="v$.value.teacher"
			:validation-messages="rolesValidationMessages"
			data-testid="ldapDataRolesTeacher"
			@update:modelValue="$emit('input', { ...value, teacher: $event })"
		>
			<template #icon>
				<v-icon :color="fillColor" class="custom-icon">$teacher</v-icon>
			</template>
		</base-input>
		<base-input
			:modelValue="value.admin"
			type="text"
			:label="$t('pages.administration.ldapEdit.roles.labels.admin')"
			:placeholder="$t('pages.administration.ldapEdit.roles.placeholder.admin')"
			:info="$t('pages.administration.ldapEdit.roles.info.admin')"
			:validation-model="v$.value.admin"
			:validation-messages="rolesValidationMessages"
			data-testid="ldapDataRolesAdmin"
			@update:modelValue="$emit('input', { ...value, admin: $event })"
		>
			<template #icon>
				<v-icon :color="fillColor">$mdiShieldAccountVariantOutline</v-icon>
			</template>
		</base-input>
		<base-input
			:modelValue="value.user"
			type="text"
			:label="$t('pages.administration.ldapEdit.roles.labels.user')"
			:placeholder="$t('pages.administration.ldapEdit.roles.placeholder.user')"
			:info="$t('pages.administration.ldapEdit.roles.info.user')"
			data-testid="ldapDataRolesUser"
			@update:modelValue="$emit('input', { ...value, user: $event })"
		>
			<template #icon>
				<v-icon :color="fillColor">$mdiAccountOffOutline</v-icon>
			</template>
		</base-input>
	</div>
</template>

<script>
import { required } from "@vuelidate/validators";
import { ldapPathRegexValidator } from "@/utils/ldapConstants";
import { defineComponent } from "vue";
import useVuelidate from "@vuelidate/core";

export default defineComponent({
	setup() {
		return { v$: useVuelidate() };
	},
	props: {
		value: {
			type: Object,
			default() {
				return {};
			},
		},
		validate: {
			type: Boolean,
		},
	},
	data() {
		return {
			ldapActivatedColor: "currentColor",
			memberValidationMessages: [
				{ key: "required", message: this.$t("common.validation.required") },
			],
			rolesValidationMessages: [
				{
					key: "ldapPathRegexValidator",
					message: this.$t("pages.administration.ldapEdit.validation.path"),
				},
			],
		};
	},
	computed: {
		groupOption() {
			return this.value.groupOption || "undefined";
		},

		fillColor() {
			return "var(--v-black-base)";
		},
	},
	watch: {
		validate: function () {
			this.v$.$touch();
			this.$emit("update:errors", this.v$.$invalid, "roles");
		},
		groupOption: function () {
			this.groupOption === "user_attribute"
				? (this.ldapActivatedColor = this.fillColor)
				: (this.ldapActivatedColor = "currentColor");

			this.$emit("update:errors", this.v$.$invalid, "roles");
		},
	},
	validations() {
		if (this.groupOption === "group") {
			return {
				value: {
					member: { required },
					student: { ldapPathRegexValidator },
					teacher: { ldapPathRegexValidator },
					admin: { ldapPathRegexValidator },
				},
			};
		}
		return {
			value: {},
		};
	},
});
</script>

<style lang="scss" scoped>
.section-sub-header {
	margin-bottom: var(--space-xs);
}

.description-section {
	margin-bottom: var(--space-xl);
}
</style>
