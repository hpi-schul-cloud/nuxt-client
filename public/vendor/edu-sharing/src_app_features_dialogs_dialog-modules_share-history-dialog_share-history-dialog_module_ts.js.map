{"version":3,"file":"src_app_features_dialogs_dialog-modules_share-history-dialog_share-history-dialog_module_ts.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;AAO6C;AACgB;AACb;AAGwB;;;;;;;;;;;ICZxEI,4DAAA,aAAuF;IACrFA,oDAAA,GACF;;IAAAA,0DAAA,EAAM;;;IADJA,uDAAA,GACF;IADEA,gEAAA,MAAAA,yDAAA,8CACF;;;;;IAaMA,4DAAA,cAAmD;IAC9BA,oDAAA,GAAc;IAAAA,0DAAA,EAAO;IACxCA,4DAAA,eAA0B;IAAAA,oDAAA,GAAuB;IAAAA,0DAAA,EAAO;;;;IADrCA,uDAAA,GAAc;IAAdA,+DAAA,CAAAQ,MAAA,CAAAC,IAAA,CAAc;IACPT,uDAAA,GAAuB;IAAvBA,gEAAA,MAAAQ,MAAA,CAAAE,WAAA,MAAuB;;;;;IAPrDV,4DAAA,cAAoD;IAEtBA,oDAAA,yBAAkB;IAAAA,0DAAA,EAAI;IAChDA,oDAAA,GACF;;IAAAA,0DAAA,EAAM;IACNA,wDAAA,IAAAY,sDAAA,kBAGM;IACRZ,0DAAA,EAAM;;;;IANFA,uDAAA,GACF;IADEA,gEAAA,MAAAA,yDAAA,6CACF;IACqBA,uDAAA,GAAc;IAAdA,wDAAA,YAAAc,QAAA,CAAAC,KAAA,CAAc;;;;;IAUnCf,4DAAA,cAA0D;IACrCA,oDAAA,GAAkB;IAAAA,0DAAA,EAAO;IAC5CA,4DAAA,eAA6B;IAAAA,oDAAA,GAA8B;IAAAA,0DAAA,EAAO;IAClEA,4DAAA,eAA0B;IAAAA,oDAAA,GAA2B;IAAAA,0DAAA,EAAO;;;;IAFzCA,uDAAA,GAAkB;IAAlBA,+DAAA,CAAAgB,WAAA,CAAAP,IAAA,CAAkB;IACRT,uDAAA,GAA8B;IAA9BA,gEAAA,MAAAgB,WAAA,CAAAC,cAAA,MAA8B;IACjCjB,uDAAA,GAA2B;IAA3BA,gEAAA,MAAAgB,WAAA,CAAAN,WAAA,MAA2B;;;;;IARzDV,4DAAA,cAAyD;IAE3BA,oDAAA,gBAAS;IAAAA,0DAAA,EAAI;IACvCA,oDAAA,GACF;;IAAAA,0DAAA,EAAM;IACNA,wDAAA,IAAAkB,uDAAA,kBAIM;IACRlB,0DAAA,EAAM;;;;IAPFA,uDAAA,GACF;IADEA,gEAAA,MAAAA,yDAAA,+CACF;IACyBA,uDAAA,GAAiB;IAAjBA,wDAAA,YAAAc,QAAA,CAAAK,QAAA,CAAiB;;;;;IAW1CnB,4DAAA,cAAwD;IACnCA,oDAAA,GAAiB;IAAAA,0DAAA,EAAO;IAC3CA,4DAAA,eAA0B;IAAAA,oDAAA,GAA0B;IAAAA,0DAAA,EAAO;;;;IADxCA,uDAAA,GAAiB;IAAjBA,+DAAA,CAAAoB,UAAA,CAAAX,IAAA,CAAiB;IACVT,uDAAA,GAA0B;IAA1BA,gEAAA,MAAAoB,UAAA,CAAAV,WAAA,MAA0B;;;;;IAPxDV,4DAAA,cAAwD;IAE1BA,oDAAA,4BAAqB;IAAAA,0DAAA,EAAI;IACnDA,oDAAA,GACF;;IAAAA,0DAAA,EAAM;IACNA,wDAAA,IAAAqB,uDAAA,kBAGM;IACRrB,0DAAA,EAAM;;;;IANFA,uDAAA,GACF;IADEA,gEAAA,MAAAA,yDAAA,+CACF;IACwBA,uDAAA,GAAgB;IAAhBA,wDAAA,YAAAc,QAAA,CAAAQ,OAAA,CAAgB;;;;;IAhC9CtB,4DAAA,aAAwD;IAERA,oDAAA,aAAM;IAAAA,0DAAA,EAAI;IAACA,oDAAA,GAAgB;IAAAA,0DAAA,EAAM;IAC7EA,4DAAA,aAAkB;IAAAA,oDAAA,GAAgB;IAAAA,0DAAA,EAAM;IAE1CA,4DAAA,aAAqB;IACnBA,wDAAA,IAAAuB,gDAAA,iBASM;IACNvB,wDAAA,KAAAwB,iDAAA,kBAUM;IACNxB,wDAAA,KAAAyB,iDAAA,kBASM;IACRzB,0DAAA,EAAM;;;;IAnCmDA,uDAAA,GAAgB;IAAhBA,gEAAA,MAAAc,QAAA,CAAAY,IAAA,KAAgB;IACrD1B,uDAAA,GAAgB;IAAhBA,+DAAA,CAAAc,QAAA,CAAAa,IAAA,CAAgB;IAGR3B,uDAAA,GAAwB;IAAxBA,wDAAA,SAAAc,QAAA,CAAAC,KAAA,CAAAa,MAAA,CAAwB;IAUtB5B,uDAAA,GAA2B;IAA3BA,wDAAA,SAAAc,QAAA,CAAAK,QAAA,CAAAS,MAAA,CAA2B;IAW3B5B,uDAAA,GAA0B;IAA1BA,wDAAA,SAAAc,QAAA,CAAAQ,OAAA,CAAAM,MAAA,CAA0B;;;ADVpD,MAAOC,2BAA2B;EAMpCC,YACqCC,IAA4B,EACtDC,SAA0E,EACzEC,OAAwB,EACxBC,KAAY,EACZC,UAA6B,EAC7BC,WAA6B;IALJ,KAAAL,IAAI,GAAJA,IAAI;IAC9B,KAAAC,SAAS,GAATA,SAAS;IACR,KAAAC,OAAO,GAAPA,OAAO;IACP,KAAAC,KAAK,GAALA,KAAK;IACL,KAAAC,UAAU,GAAVA,UAAU;IACV,KAAAC,WAAW,GAAXA,WAAW;IAXf,KAAAC,WAAW,GAAG,CAAC;IACf,KAAAC,UAAU,GAAG,CAAC;IACd,KAAAC,aAAa,GAAG,CAAC;IAWrB;IACA,IAAI,CAACC,WAAW,EAAE;EACtB;EAEQA,WAAWA,CAAA;IACf,IAAI,CAACR,SAAS,CAACS,UAAU,CAAC;MAAEC,SAAS,EAAE;IAAI,CAAE,CAAC;IAC9C,IAAI,CAACT,OAAO,CAACU,yBAAyB,CAAC,IAAI,CAACZ,IAAI,CAACa,IAAI,CAACC,GAAG,CAACC,EAAE,CAAC,CAACC,SAAS,CAClEhB,IAA8B,IAAI;MAC/B,IAAI,CAACiB,cAAc,CAACjB,IAAI,CAAC;MACzB,IAAI,CAACC,SAAS,CAACS,UAAU,CAAC;QAAEC,SAAS,EAAE;MAAK,CAAE,CAAC;IACnD,CAAC,EACAO,KAAU,IAAI;MACX,IAAI,CAACf,KAAK,CAACe,KAAK,CAACA,KAAK,CAAC;MACvB,IAAI,CAACC,KAAK,EAAE;IAChB,CAAC,CACJ;EACL;EAEQA,KAAKA,CAAA;IACT,IAAI,CAAClB,SAAS,CAACkB,KAAK,EAAE;EAC1B;EAEQF,cAAcA,CAACG,OAAiC;IACpD,IAAI,CAACA,OAAO,GAAG,EAAE;IACjB,IAAIC,CAAC,GAAG,CAAC;IACT,KAAK,MAAMC,KAAK,IAAIF,OAAO,EAAE;MACzB,MAAMG,IAAI,GAAQ,EAAE;MACpBA,IAAI,CAACvC,KAAK,GAAG,EAAE;MACfuC,IAAI,CAACnC,QAAQ,GAAG,EAAE;MAElB,IAAIiC,CAAC,GAAGD,OAAO,CAACvB,MAAM,GAAG,CAAC,EAAE;QACxB0B,IAAI,CAAChC,OAAO,GAAG,IAAI,CAACiC,UAAU,CAC1BF,KAAK,CAAC3C,WAAW,CAACA,WAAW,EAC7ByC,OAAO,CAACC,CAAC,GAAG,CAAC,CAAC,CAAC1C,WAAW,CAACA,WAAW,CACzC;OACJ,MAAM;QACH4C,IAAI,CAAChC,OAAO,GAAG,EAAE;;MAGrBgC,IAAI,CAAC3B,IAAI,GAAG7B,0DAAU,CAAC0D,UAAU,CAAC,IAAI,CAACpB,WAAW,EAAEiB,KAAK,CAAC1B,IAAI,CAAC;MAC/D2B,IAAI,CAAC5B,IAAI,GAAG,IAAI,CAACS,UAAU,CAACsB,kBAAkB,CAACJ,KAAK,CAAC3B,IAAI,CAAC;MAC1D,KAAK,MAAMgC,UAAU,IAAIL,KAAK,CAAC3C,WAAW,CAACA,WAAW,EAAE;QACpD,IAAI0C,CAAC,GAAGD,OAAO,CAACvB,MAAM,GAAG,CAAC,EAAE;UACxB,MAAM+B,MAAM,GAAG,IAAI,CAACC,mBAAmB,CAACF,UAAU,EAAEP,OAAO,CAACC,CAAC,GAAG,CAAC,CAAC,CAAC;UACnE,MAAMS,MAAM,GAAGF,MAAM,CAACE,MAAM;UAC5B,IAAIA,MAAM,IAAI,IAAI,CAACxB,WAAW,EAAE,EAC/B,MAAM,IAAIwB,MAAM,IAAI,IAAI,CAACtB,aAAa,EAAE;YACrCe,IAAI,CAACnC,QAAQ,CAAC2C,IAAI,CAAC,IAAI,CAACC,iBAAiB,CAACL,UAAU,EAAEC,MAAM,CAACjD,WAAW,CAAC,CAAC;WAC7E,MAAM,IAAImD,MAAM,IAAI,IAAI,CAACvB,UAAU,EAAE;YAClCgB,IAAI,CAACvC,KAAK,CAAC+C,IAAI,CAAC,IAAI,CAACC,iBAAiB,CAACL,UAAU,CAAC,CAAC;;SAE1D,MAAM;UACHJ,IAAI,CAACvC,KAAK,CAAC+C,IAAI,CAAC,IAAI,CAACC,iBAAiB,CAACL,UAAU,CAAC,CAAC;;;MAG3D,IAAIJ,IAAI,CAACvC,KAAK,CAACa,MAAM,IAAI0B,IAAI,CAACnC,QAAQ,CAACS,MAAM,IAAI0B,IAAI,CAAChC,OAAO,CAACM,MAAM,EAAE;QAClE,IAAI,CAACuB,OAAO,CAACW,IAAI,CAACR,IAAI,CAAC;;MAE3BF,CAAC,EAAE;;EAEX;EAEQG,UAAUA,CAACS,aAA2B,EAAEC,aAA2B;IACvE,MAAM3C,OAAO,GAAiB,EAAE;IAChC,KAAK,MAAM4C,IAAI,IAAID,aAAa,EAAE;MAC9B,IAAIE,SAAS,GAAG,IAAI;MACpB,KAAK,MAAMC,IAAI,IAAIJ,aAAa,EAAE;QAC9B,IAAII,IAAI,CAACC,SAAS,CAACC,aAAa,KAAKJ,IAAI,CAACG,SAAS,CAACC,aAAa,EAAE;UAC/DH,SAAS,GAAG,KAAK;;;MAGzB,IAAI,CAACA,SAAS,EAAE;MAChB7C,OAAO,CAACwC,IAAI,CAAC,IAAI,CAACC,iBAAiB,CAACG,IAAI,CAAC,CAAC;;IAE9C,OAAO5C,OAAO;EAClB;EAEQsC,mBAAmBA,CACvBI,aAAyB,EACzBC,aAAqC;IAErC,KAAK,MAAMP,UAAU,IAAIO,aAAa,CAACvD,WAAW,CAACA,WAAW,EAAE;MAC5D,IAAIgD,UAAU,CAACW,SAAS,CAACC,aAAa,KAAKN,aAAa,CAACK,SAAS,CAACC,aAAa,EAAE;QAC9E,IAAI,CAACzE,4DAAM,CAAC0E,WAAW,CAACb,UAAU,CAAChD,WAAW,EAAEsD,aAAa,CAACtD,WAAW,CAAC,EAAE;UACxE,OAAO;YAAEmD,MAAM,EAAE,IAAI,CAACtB,aAAa;YAAE7B,WAAW,EAAEgD,UAAU,CAAChD;UAAW,CAAE;;QAE9E,OAAO;UAAEmD,MAAM,EAAE,IAAI,CAACxB;QAAW,CAAE;;;IAG3C,OAAO;MAAEwB,MAAM,EAAE,IAAI,CAACvB;IAAU,CAAE;EACtC;EAEQyB,iBAAiBA,CAACS,CAAa,EAAEvD,cAAA,GAA2B,IAAI;IACpE,MAAMwD,MAAM,GAAQ,EAAE;IACtB,IAAID,CAAC,CAAC9C,IAAI,EAAE+C,MAAM,CAAChE,IAAI,GAAG,CAAC+D,CAAC,CAAC9C,IAAI,CAACgD,SAAS,GAAG,GAAG,GAAGF,CAAC,CAAC9C,IAAI,CAACiD,QAAQ,EAAEC,IAAI,EAAE,CAAC,KACvE,IAAIJ,CAAC,CAACK,KAAK,EAAEJ,MAAM,CAAChE,IAAI,GAAG+D,CAAC,CAACK,KAAK,CAACC,WAAW,CAAC,KAC/C,IAAIN,CAAC,CAACH,SAAS,CAACC,aAAa,KAAK1E,mEAAa,CAACmF,kBAAkB,EAAE;MACrEN,MAAM,CAAChE,IAAI,GAAG,IAAI,CAAC2B,WAAW,CAAC4C,OAAO,CAAC,gBAAgB,CAAC;KAC3D,MAAM;MACHP,MAAM,CAAChE,IAAI,GAAG+D,CAAC,CAACH,SAAS,CAACC,aAAa;;IAE3CE,CAAC,CAAC9D,WAAW,GAAG,IAAI,CAACuE,kBAAkB,CAACT,CAAC,CAAC9D,WAAW,CAAC;IACtDO,cAAc,GAAG,IAAI,CAACgE,kBAAkB,CAAChE,cAAc,CAAC;IACxD,MAAMiE,IAAI,GAAa,EAAE;IACzB,KAAK,MAAMC,IAAI,IAAIX,CAAC,CAAC9D,WAAW,EAAE;MAC9BwE,IAAI,CAACpB,IAAI,CAAC,IAAI,CAAC1B,WAAW,CAAC4C,OAAO,CAAC,kBAAkB,GAAGG,IAAI,CAAC,CAAC;;IAElEV,MAAM,CAAC/D,WAAW,GAAGwE,IAAI,CAACE,IAAI,CAAC,IAAI,CAAC;IACpC,IAAInE,cAAc,EAAE;MAChB,MAAMiE,IAAI,GAAa,EAAE;MACzB,KAAK,MAAMC,IAAI,IAAIlE,cAAc,EAAE;QAC/BiE,IAAI,CAACpB,IAAI,CAAC,IAAI,CAAC1B,WAAW,CAAC4C,OAAO,CAAC,kBAAkB,GAAGG,IAAI,CAAC,CAAC;;MAElEV,MAAM,CAACxD,cAAc,GAAGiE,IAAI,CAACE,IAAI,CAAC,IAAI,CAAC;;IAE3C,OAAOX,MAAM;EACjB;EAEQQ,kBAAkBA,CAACvE,WAAqB;IAC5C,IAAIA,WAAW,IAAI,IAAI,EAAE,OAAOA,WAAW;IAC3C,MAAM2E,GAAG,GAAG3E,WAAW,CAAC4E,OAAO,CAAC1F,mEAAa,CAAC2F,cAAc,CAAC;IAC7D,IAAIF,GAAG,IAAI,CAAC,CAAC,EAAE;MACX3E,WAAW,CAAC8E,MAAM,CAACH,GAAG,EAAE,CAAC,EAAEzF,mEAAa,CAAC6F,sBAAsB,CAAC;;IAEpE,MAAMC,KAAK,GAAGhF,WAAW,CAAC4E,OAAO,CAAC1F,mEAAa,CAAC6F,sBAAsB,CAAC;IACvE,MAAME,MAAM,GAAGjF,WAAW,CAAC4E,OAAO,CAAC1F,mEAAa,CAACgG,uBAAuB,CAAC;IACzE,MAAMC,QAAQ,GAAGnF,WAAW,CAAC4E,OAAO,CAAC1F,mEAAa,CAACkG,mBAAmB,CAAC;IACvE,IAAIJ,KAAK,IAAI,CAAC,CAAC,EAAE;MACb,IAAIC,MAAM,IAAI,CAAC,CAAC,EAAEjF,WAAW,CAAC8E,MAAM,CAACG,MAAM,EAAE,CAAC,CAAC;MAC/C,IAAIE,QAAQ,IAAI,CAAC,CAAC,EAAEnF,WAAW,CAAC8E,MAAM,CAACK,QAAQ,EAAE,CAAC,CAAC;KACtD,MAAM,IAAIF,MAAM,IAAI,CAAC,CAAC,EAAE;MACrB,IAAIE,QAAQ,IAAI,CAAC,CAAC,EAAEnF,WAAW,CAAC8E,MAAM,CAACK,QAAQ,EAAE,CAAC,CAAC;;IAEvD,OAAOnF,WAAW;EACtB;EAAC,QAAAqF,CAAA;qBApJQlE,2BAA2B,EAAA7B,+DAAA,CAOxBD,6EAAgB,GAAAC,+DAAA,CAAAiG,uEAAA,GAAAjG,+DAAA,CAAAmG,qEAAA,GAAAnG,+DAAA,CAAAqG,kDAAA,GAAArG,+DAAA,CAAAuG,4EAAA,GAAAvG,+DAAA,CAAAyG,iEAAA;EAAA;EAAA,QAAAE,EAAA;UAPnB9E,2BAA2B;IAAA+E,SAAA;IAAAC,KAAA;IAAAC,IAAA;IAAAC,MAAA;IAAAC,QAAA,WAAAC,qCAAAC,EAAA,EAAAC,GAAA;MAAA,IAAAD,EAAA;QCrBxClH,wDAAA,IAAAoH,0CAAA,iBAEM;QAENpH,wDAAA,IAAAqH,0CAAA,kBAsCM;;;QA1CArH,wDAAA,WAAAmH,GAAA,CAAAhE,OAAA,KAAAgE,GAAA,CAAAhE,OAAA,CAAAvB,MAAA,MAAAuF,GAAA,CAAAnF,SAAA,CAAAsF,KAAA,CAAA5E,SAAA,CAAiE;QAIhD1C,uDAAA,GAAU;QAAVA,wDAAA,YAAAmH,GAAA,CAAAhE,OAAA,CAAU;;;;;;;;;;;;;;;;;;;;;;;;ACH+B;AACe;;AAExC;AAMjC,MAAOqE,wBAAwB;EAAA,QAAAzB,CAAA;qBAAxByB,wBAAwB;EAAA;EAAA,QAAAb,EAAA;UAAxBa;EAAwB;EAAA,QAAAC,EAAA;cAFvBF,+DAAY;EAAA;;;sHAEbC,wBAAwB;IAAAE,YAAA,GAHlB7F,wFAA2B;IAAA8F,OAAA,GAChCJ,+DAAY;EAAA;AAAA","sources":["./src/app/features/dialogs/dialog-modules/share-history-dialog/share-history-dialog.component.ts","./src/app/features/dialogs/dialog-modules/share-history-dialog/share-history-dialog.component.html","./src/app/features/dialogs/dialog-modules/share-history-dialog/share-history-dialog.module.ts"],"sourcesContent":["import { Component, Inject } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport {\n    NodePermissionsHistory,\n    Permission,\n    RestConstants,\n    RestNodeService,\n} from '../../../../core-module/core.module';\nimport { Helper } from '../../../../core-module/rest/helper';\nimport { DateHelper } from 'ngx-edu-sharing-ui';\nimport { NodeHelperService } from '../../../../services/node-helper.service';\nimport { Toast } from '../../../../services/toast';\nimport { CARD_DIALOG_DATA } from '../../card-dialog/card-dialog-config';\nimport { CardDialogRef } from '../../card-dialog/card-dialog-ref';\nimport { ShareHistoryDialogData, ShareHistoryDialogResult } from './share-history-dialog-data';\n\n@Component({\n    selector: 'es-share-history-dialog',\n    templateUrl: './share-history-dialog.component.html',\n    styleUrls: ['./share-history-dialog.component.scss'],\n})\nexport class ShareHistoryDialogComponent {\n    private STATUS_SAME = 0;\n    private STATUS_ADD = 1;\n    private STATUS_CHANGE = 2;\n    history: any;\n\n    constructor(\n        @Inject(CARD_DIALOG_DATA) public data: ShareHistoryDialogData,\n        public dialogRef: CardDialogRef<ShareHistoryDialogData, ShareHistoryDialogResult>,\n        private nodeApi: RestNodeService,\n        private toast: Toast,\n        private nodeHelper: NodeHelperService,\n        private translation: TranslateService,\n    ) {\n        // Run in constructor to avoid changed-after-checked error.\n        this.loadHistory();\n    }\n\n    private loadHistory() {\n        this.dialogRef.patchState({ isLoading: true });\n        this.nodeApi.getNodePermissionsHistory(this.data.node.ref.id).subscribe(\n            (data: NodePermissionsHistory[]) => {\n                this.processHistory(data);\n                this.dialogRef.patchState({ isLoading: false });\n            },\n            (error: any) => {\n                this.toast.error(error);\n                this.close();\n            },\n        );\n    }\n\n    private close() {\n        this.dialogRef.close();\n    }\n\n    private processHistory(history: NodePermissionsHistory[]) {\n        this.history = [];\n        let i = 0;\n        for (const entry of history) {\n            const info: any = {};\n            info.added = [];\n            info.modified = [];\n\n            if (i < history.length - 1) {\n                info.removed = this.getRemoved(\n                    entry.permissions.permissions,\n                    history[i + 1].permissions.permissions,\n                );\n            } else {\n                info.removed = [];\n            }\n\n            info.date = DateHelper.formatDate(this.translation, entry.date);\n            info.user = this.nodeHelper.getUserDisplayName(entry.user);\n            for (const permission of entry.permissions.permissions) {\n                if (i < history.length - 1) {\n                    const result = this.getPermissionStatus(permission, history[i + 1]);\n                    const status = result.status;\n                    if (status == this.STATUS_SAME) {\n                    } else if (status == this.STATUS_CHANGE) {\n                        info.modified.push(this.convertPermission(permission, result.permissions));\n                    } else if (status == this.STATUS_ADD) {\n                        info.added.push(this.convertPermission(permission));\n                    }\n                } else {\n                    info.added.push(this.convertPermission(permission));\n                }\n            }\n            if (info.added.length || info.modified.length || info.removed.length) {\n                this.history.push(info);\n            }\n            i++;\n        }\n    }\n\n    private getRemoved(permissionNew: Permission[], permissionOld: Permission[]): Permission[] {\n        const removed: Permission[] = [];\n        for (const pOld of permissionOld) {\n            let isRemoved = true;\n            for (const pNew of permissionNew) {\n                if (pNew.authority.authorityName === pOld.authority.authorityName) {\n                    isRemoved = false;\n                }\n            }\n            if (!isRemoved) continue;\n            removed.push(this.convertPermission(pOld));\n        }\n        return removed;\n    }\n\n    private getPermissionStatus(\n        permissionNew: Permission,\n        permissionOld: NodePermissionsHistory,\n    ): any {\n        for (const permission of permissionOld.permissions.permissions) {\n            if (permission.authority.authorityName === permissionNew.authority.authorityName) {\n                if (!Helper.arrayEquals(permission.permissions, permissionNew.permissions)) {\n                    return { status: this.STATUS_CHANGE, permissions: permission.permissions };\n                }\n                return { status: this.STATUS_SAME };\n            }\n        }\n        return { status: this.STATUS_ADD };\n    }\n\n    private convertPermission(p: Permission, oldPermissions: string[] = null) {\n        const object: any = {};\n        if (p.user) object.name = (p.user.firstName + ' ' + p.user.lastName).trim();\n        else if (p.group) object.name = p.group.displayName;\n        else if (p.authority.authorityName === RestConstants.AUTHORITY_EVERYONE) {\n            object.name = this.translation.instant('GROUP_EVERYONE');\n        } else {\n            object.name = p.authority.authorityName;\n        }\n        p.permissions = this.cleanupPermissions(p.permissions);\n        oldPermissions = this.cleanupPermissions(oldPermissions);\n        const list: string[] = [];\n        for (const perm of p.permissions) {\n            list.push(this.translation.instant('PERMISSION_TYPE.' + perm));\n        }\n        object.permissions = list.join(', ');\n        if (oldPermissions) {\n            const list: string[] = [];\n            for (const perm of oldPermissions) {\n                list.push(this.translation.instant('PERMISSION_TYPE.' + perm));\n            }\n            object.oldPermissions = list.join(', ');\n        }\n        return object;\n    }\n\n    private cleanupPermissions(permissions: string[]) {\n        if (permissions == null) return permissions;\n        const all = permissions.indexOf(RestConstants.PERMISSION_ALL);\n        if (all != -1) {\n            permissions.splice(all, 1, RestConstants.PERMISSION_COORDINATOR);\n        }\n        const coord = permissions.indexOf(RestConstants.PERMISSION_COORDINATOR);\n        const collab = permissions.indexOf(RestConstants.PERMISSION_COLLABORATOR);\n        const consumer = permissions.indexOf(RestConstants.PERMISSION_CONSUMER);\n        if (coord != -1) {\n            if (collab != -1) permissions.splice(collab, 1);\n            if (consumer != -1) permissions.splice(consumer, 1);\n        } else if (collab != -1) {\n            if (consumer != -1) permissions.splice(consumer, 1);\n        }\n        return permissions;\n    }\n}\n","<div *ngIf=\"(!history || !history.length) && !dialogRef.state.isLoading\" class=\"empty\">\n  {{ 'WORKSPACE.SHARE.HISTORY.EMPTY' | translate }}\n</div>\n\n<div *ngFor=\"let entry of history\" class=\"groupHistory\">\n  <div class=\"heading\">\n    <div class=\"name\"><i class=\"material-icons\">person</i> {{ entry.user }}</div>\n    <div class=\"date\">{{ entry.date }}</div>\n  </div>\n  <div class=\"content\">\n    <div class=\"group added\" *ngIf=\"entry.added.length\">\n      <div class=\"type\">\n        <i class=\"material-icons\">add_circle_outline</i>\n        {{ 'WORKSPACE.SHARE.HISTORY.ADDED' | translate }}\n      </div>\n      <div *ngFor=\"let add of entry.added\" class=\"entry\">\n        <span class=\"name\">{{ add.name }}</span>\n        <span class=\"permissions\">({{ add.permissions }})</span>\n      </div>\n    </div>\n    <div class=\"group changed\" *ngIf=\"entry.modified.length\">\n      <div class=\"type\">\n        <i class=\"material-icons\">autorenew</i>\n        {{ 'WORKSPACE.SHARE.HISTORY.CHANGED' | translate }}\n      </div>\n      <div *ngFor=\"let changed of entry.modified\" class=\"entry\">\n        <span class=\"name\">{{ changed.name }}</span>\n        <span class=\"permissionsOld\">({{ changed.oldPermissions }})</span>\n        <span class=\"permissions\">({{ changed.permissions }})</span>\n      </div>\n    </div>\n    <div class=\"group removed\" *ngIf=\"entry.removed.length\">\n      <div class=\"type\">\n        <i class=\"material-icons\">remove_circle_outline</i>\n        {{ 'WORKSPACE.SHARE.HISTORY.REMOVED' | translate }}\n      </div>\n      <div *ngFor=\"let remove of entry.removed\" class=\"entry\">\n        <span class=\"name\">{{ remove.name }}</span>\n        <span class=\"permissions\">({{ remove.permissions }})</span>\n      </div>\n    </div>\n  </div>\n</div>\n","import { NgModule } from '@angular/core';\nimport { SharedModule } from '../../../../shared/shared.module';\nimport { ShareHistoryDialogComponent } from './share-history-dialog.component';\n\nexport { ShareHistoryDialogComponent };\n\n@NgModule({\n    declarations: [ShareHistoryDialogComponent],\n    imports: [SharedModule],\n})\nexport class ShareHistoryDialogModule {}\n"],"names":["RestConstants","Helper","DateHelper","CARD_DIALOG_DATA","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate1","ɵɵpipeBind1","ɵɵtextInterpolate","add_r7","name","permissions","ɵɵtemplate","ShareHistoryDialogComponent_div_1_div_9_div_6_Template","ɵɵproperty","entry_r2","added","changed_r10","oldPermissions","ShareHistoryDialogComponent_div_1_div_10_div_6_Template","modified","remove_r13","ShareHistoryDialogComponent_div_1_div_11_div_6_Template","removed","ShareHistoryDialogComponent_div_1_div_9_Template","ShareHistoryDialogComponent_div_1_div_10_Template","ShareHistoryDialogComponent_div_1_div_11_Template","user","date","length","ShareHistoryDialogComponent","constructor","data","dialogRef","nodeApi","toast","nodeHelper","translation","STATUS_SAME","STATUS_ADD","STATUS_CHANGE","loadHistory","patchState","isLoading","getNodePermissionsHistory","node","ref","id","subscribe","processHistory","error","close","history","i","entry","info","getRemoved","formatDate","getUserDisplayName","permission","result","getPermissionStatus","status","push","convertPermission","permissionNew","permissionOld","pOld","isRemoved","pNew","authority","authorityName","arrayEquals","p","object","firstName","lastName","trim","group","displayName","AUTHORITY_EVERYONE","instant","cleanupPermissions","list","perm","join","all","indexOf","PERMISSION_ALL","splice","PERMISSION_COORDINATOR","coord","collab","PERMISSION_COLLABORATOR","consumer","PERMISSION_CONSUMER","_","ɵɵdirectiveInject","i1","CardDialogRef","i2","RestNodeService","i3","Toast","i4","NodeHelperService","i5","TranslateService","_2","selectors","decls","vars","consts","template","ShareHistoryDialogComponent_Template","rf","ctx","ShareHistoryDialogComponent_div_0_Template","ShareHistoryDialogComponent_div_1_Template","state","SharedModule","ShareHistoryDialogModule","_3","declarations","imports"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}