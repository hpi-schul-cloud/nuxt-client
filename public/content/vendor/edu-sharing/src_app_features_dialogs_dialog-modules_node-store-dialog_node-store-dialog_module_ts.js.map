{"version":3,"file":"src_app_features_dialogs_dialog-modules_node-store-dialog_node-store-dialog_module_ts.js","mappings":"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","sources":["./src/app/features/dialogs/dialog-modules/node-store-dialog/node-store-dialog.component.ts","./src/app/features/dialogs/dialog-modules/node-store-dialog/node-store-dialog.component.html","./src/app/features/dialogs/dialog-modules/node-store-dialog/node-store-dialog.module.ts"],"sourcesContent":["import { AfterViewInit, Component, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Node, NodeListService, SortPolicy } from 'ngx-edu-sharing-api';\nimport {\n    ActionbarComponent,\n    CustomOptions,\n    DefaultGroups,\n    InteractionType,\n    ListItem,\n    ListItemSort,\n    ListSortConfig,\n    NodeDataSource,\n    NodeEntriesDisplayType,\n    NodeEntriesWrapperComponent,\n    OptionItem,\n    UIConstants,\n    UIService,\n} from 'ngx-edu-sharing-ui';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { switchMap, takeUntil } from 'rxjs/operators';\nimport { RestConstants } from '../../../../core-module/rest/rest-constants';\nimport { Toast } from '../../../../services/toast';\nimport { CardDialogRef } from '../../card-dialog/card-dialog-ref';\nimport { CardDialogUtilsService } from '../../card-dialog/card-dialog-utils.service';\n\n@Component({\n    selector: 'es-search-node-store-dialog',\n    templateUrl: 'node-store-dialog.component.html',\n    styleUrls: ['node-store-dialog.component.scss'],\n})\nexport class SearchNodeStoreDialogComponent implements OnInit, AfterViewInit, OnDestroy {\n    readonly NodeEntriesDisplayType = NodeEntriesDisplayType;\n    readonly InteractionType = InteractionType;\n\n    @ViewChild(NodeEntriesWrapperComponent) nodeEntries: NodeEntriesWrapperComponent<Node>;\n    @ViewChild(ActionbarComponent) actionBar: ActionbarComponent;\n\n    columns: ListItem[] = [];\n    // buttons = DialogButton.getSingleButton('CLOSE', () => this.cancel(), 'standard');\n    list = new NodeDataSource<Node>();\n\n    readonly sortPolicySubject = new BehaviorSubject<ListSortConfig & SortPolicy>({\n        allowed: true,\n        active: RestConstants.LOM_PROP_TITLE,\n        direction: 'asc',\n        columns: [new ListItemSort('NODE', RestConstants.LOM_PROP_TITLE)],\n    });\n    private options: CustomOptions = {\n        useDefaultOptions: true,\n        supportedOptions: ['OPTIONS.DOWNLOAD'],\n        addOptions: this.getAdditionalOptions(),\n    };\n    private selected: Node[] = [];\n    private readonly destroyed = new Subject<void>();\n\n    constructor(\n        private cardDialogUtils: CardDialogUtilsService,\n        private dialogRef: CardDialogRef,\n        private nodeList: NodeListService,\n        private router: Router,\n        private toast: Toast,\n        private ui: UIService,\n    ) {\n        this.columns.push(new ListItem('NODE', RestConstants.LOM_PROP_TITLE));\n    }\n\n    ngOnInit(): void {\n        this.dialogRef.patchState({ isLoading: true });\n        this.registerNodeList();\n    }\n\n    ngAfterViewInit(): void {\n        this.nodeEntries.initOptionsGenerator({\n            actionbar: this.actionBar,\n            customOptions: this.options,\n        });\n        this.nodeEntries\n            .getSelection()\n            .changed.pipe(takeUntil(this.destroyed))\n            .subscribe((selectionChange) => this.onSelection(selectionChange.source.selected));\n    }\n\n    ngOnDestroy(): void {\n        this.destroyed.next();\n        this.destroyed.complete();\n    }\n\n    private setSelection(node: Node): void {\n        const selection = this.nodeEntries.getSelection();\n        selection.clear();\n        selection.select(node);\n    }\n\n    onClick(node: Node): void {\n        if (this.ui.isMobile()) {\n            this.openNode(node);\n        } else {\n            this.setSelection(node);\n        }\n    }\n\n    openNode(node: Node) {\n        this.router.navigate([UIConstants.ROUTER_PREFIX + 'render', node.ref.id], {\n            state: {\n                nodes: this.list.getData(),\n                scope: 'node-store',\n            },\n        });\n    }\n\n    onSelection(data: Node[]) {\n        this.selected = data;\n    }\n\n    changeSort(config: ListSortConfig) {\n        this.sortPolicySubject.next({ ...config, direction: config.direction || 'asc' });\n    }\n\n    private getAdditionalOptions() {\n        const remove = new OptionItem('SEARCH.NODE_STORE.REMOVE_ITEM', 'delete', () => {\n            this.deleteSelection();\n        });\n        remove.group = DefaultGroups.FileOperations;\n        return [remove];\n    }\n\n    private deleteSelection() {\n        this.dialogRef.patchState({ isLoading: true });\n        this.nodeList\n            .removeFromNodeList(\n                RestConstants.NODE_STORE_LIST,\n                this.selected.map((node) => node.ref.id),\n            )\n            .subscribe(() => {\n                this.toast.toast('SEARCH.NODE_STORE.REMOVED_ITEMS', {\n                    count: this.selected.length,\n                });\n                this.nodeEntries.getSelection().clear();\n            });\n    }\n\n    private registerNodeList(): void {\n        this.sortPolicySubject\n            .pipe(\n                switchMap((sortPolicy) =>\n                    this.nodeList.observeNodeList(RestConstants.NODE_STORE_LIST, {\n                        propertyFilter: [RestConstants.ALL],\n                        sortPolicies: [sortPolicy],\n                    }),\n                ),\n            )\n            .subscribe({\n                next: (nodes) => {\n                    this.list.setData(nodes.nodes);\n                    void this.cardDialogUtils\n                        .configForNodes(nodes.nodes)\n                        .then((config) => this.dialogRef.patchConfig(config));\n                    this.dialogRef.patchState({ isLoading: false });\n                },\n                error: () => {\n                    this.dialogRef.patchState({ isLoading: false });\n                },\n            });\n    }\n}\n","<div class=\"actions\">\n  <es-actionbar></es-actionbar>\n</div>\n\n<!-- Manually hide the table to also hide the header when there are no elements. -->\n<div class=\"noElementsInfo noElements\" *ngIf=\"list.isEmpty()\">\n  {{ 'SEARCH.NODE_STORE.LIST_EMPTY' | translate }}\n</div>\n\n<es-node-entries-wrapper\n  [class.display-none]=\"list.isEmpty()\"\n  [dataSource]=\"list\"\n  [columns]=\"columns\"\n  [displayType]=\"NodeEntriesDisplayType.Table\"\n  [elementInteractionType]=\"InteractionType.Emitter\"\n  [sort]=\"sortPolicySubject | async\"\n  (clickItem)=\"onClick($event.element)\"\n  (dblClickItem)=\"openNode($event.element)\"\n  (sortChange)=\"changeSort($event)\"\n></es-node-entries-wrapper>\n","import { NgModule } from '@angular/core';\nimport { SharedModule } from '../../../../shared/shared.module';\nimport { SearchNodeStoreDialogComponent } from './node-store-dialog.component';\nimport { EduSharingUiModule } from 'ngx-edu-sharing-ui';\n\nexport { SearchNodeStoreDialogComponent as SearchNodeStoreComponent };\n\n@NgModule({\n    declarations: [SearchNodeStoreDialogComponent],\n    imports: [SharedModule, EduSharingUiModule],\n})\nexport class NodeStoreDialogModule {}\n"],"names":["ActionbarComponent","DefaultGroups","InteractionType","ListItem","ListItemSort","NodeDataSource","NodeEntriesDisplayType","NodeEntriesWrapperComponent","OptionItem","UIConstants","BehaviorSubject","Subject","switchMap","takeUntil","RestConstants","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate1","ɵɵpipeBind1","SearchNodeStoreDialogComponent","constructor","cardDialogUtils","dialogRef","nodeList","router","toast","ui","columns","list","sortPolicySubject","allowed","active","LOM_PROP_TITLE","direction","options","useDefaultOptions","supportedOptions","addOptions","getAdditionalOptions","selected","destroyed","push","ngOnInit","patchState","isLoading","registerNodeList","ngAfterViewInit","nodeEntries","initOptionsGenerator","actionbar","actionBar","customOptions","getSelection","changed","pipe","subscribe","selectionChange","onSelection","source","ngOnDestroy","next","complete","setSelection","node","selection","clear","select","onClick","isMobile","openNode","navigate","ROUTER_PREFIX","ref","id","state","nodes","getData","scope","data","changeSort","config","remove","deleteSelection","group","FileOperations","removeFromNodeList","NODE_STORE_LIST","map","count","length","sortPolicy","observeNodeList","propertyFilter","ALL","sortPolicies","setData","configForNodes","then","patchConfig","error","_","ɵɵdirectiveInject","i1","CardDialogUtilsService","i2","CardDialogRef","i3","NodeListService","i4","Router","i5","Toast","i6","UIService","_2","selectors","viewQuery","SearchNodeStoreDialogComponent_Query","rf","ctx","ɵɵelement","ɵɵtemplate","SearchNodeStoreDialogComponent_div_2_Template","ɵɵlistener","SearchNodeStoreDialogComponent_Template_es_node_entries_wrapper_clickItem_3_listener","$event","element","SearchNodeStoreDialogComponent_Template_es_node_entries_wrapper_dblClickItem_3_listener","SearchNodeStoreDialogComponent_Template_es_node_entries_wrapper_sortChange_3_listener","ɵɵproperty","isEmpty","ɵɵclassProp","Table","Emitter","SharedModule","EduSharingUiModule","SearchNodeStoreComponent","NodeStoreDialogModule","_3","declarations","imports"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}