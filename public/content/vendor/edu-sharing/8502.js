"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[8502],{98502:(L,m,i)=>{i.r(m),i.d(m,{ApplyToLmsPageModule:()=>A});var R=i(50555),d=i(22941),r=i(81771),o=i(65879),P=i(1189),E=i(52081),I=i(76754),f=i(96814);function U(n,S){1&n&&(o.TgZ(0,"div"),o._uU(1,"No reurl received. Please check request."),o.qZA())}const y=[{path:":repo/:node",component:(()=>{class n{constructor(t,e,a,p,s,c,l,N,O,T,g){this.connector=t,this.locator=e,this.nodeApi=a,this.toast=p,this.events=s,this.translations=c,this.temporaryStorage=l,this.nodeHelper=N,this.router=O,this.platformLocation=T,this.route=g,this.route.queryParams.subscribe(C=>{C.reurl&&(this.reurl=C.reurl),this.route.params.subscribe(u=>{this.toast.showProgressSpinner(),l.get(r.xU.APPLY_TO_LMS_PARAMETER_NODE)?(this.node=l.get(r.xU.APPLY_TO_LMS_PARAMETER_NODE),this.forward()):u.node&&this.nodeApi.getNodeMetadata(u.node,[r.u6.ALL],u.repo).subscribe(h=>{this.node=h.node,this.forward()},h=>{this.translations.waitForInit().subscribe(()=>{this.toast.error(h)})})})})}static roundNumber(t){return t=Math.round(t),Number.isNaN(t)?0:t}forward(){this.nodeApi.prepareUsage(this.node.ref.id,this.node.ref.repo).subscribe(t=>{this.applyNode(t)},t=>{this.toast.error(t)})}applyNode(t){const e=t.node;t.remote||(t.remote=t.node);const a=this.reurl,p="ccrep://"+encodeURIComponent(t.remote.ref.repo)+"/"+encodeURIComponent(t.remote.ref.id);if("IFRAME"==a||"WINDOW"==a)return e.objectUrl=p,e.nodeId=t.remote.ref.id,void this.nodeHelper.appendImageData(e).then(c=>{this.events.broadcastEvent(r.I_.EVENT_APPLY_NODE,c),window.history.back()},c=>{console.warn("failed to fetch image data",c),this.events.broadcastEvent(r.I_.EVENT_APPLY_NODE,e),window.history.back()});console.warn('Using an absolute url for the "reurl" parameter is deprecated. Please prefer the value "WINDOW" and use frame communication');let s=-1==a.indexOf("?")?"?":"&";s+="nodeId="+p,s+="&localId="+encodeURIComponent(e.ref.id),s+=e.title?"&title="+encodeURIComponent(e.title):"&title="+encodeURIComponent(e.name),s+="&mimeType="+encodeURIComponent(e.mimetype),s+="&mediatype="+encodeURIComponent(e.mediatype),s+="&h="+n.roundNumber(e.properties[r.u6.CCM_PROP_HEIGHT]),s+="&w="+n.roundNumber(e.properties[r.u6.CCM_PROP_WIDTH]),e.content.version&&(s+="&v="+e.content.version),e.properties[r.u6.CCM_PROP_CCRESSOURCETYPE]&&(s+="&resourceType="+encodeURIComponent(e.properties[r.u6.CCM_PROP_CCRESSOURCETYPE])),e.properties[r.u6.CCM_PROP_CCRESSOURCEVERSION]&&(s+="&resourceVersion="+encodeURIComponent(e.properties[r.u6.CCM_PROP_CCRESSOURCEVERSION])),s+="&isDirectory="+e.isDirectory,s+="&iconURL="+encodeURIComponent(e.iconURL),s+="&previewURL="+encodeURIComponent(e.preview.url),s+="&repoType="+encodeURIComponent(e.repositoryType),console.log(a),this.temporaryStorage.set(r.xU.APPLY_TO_LMS_PARAMETER_NODE,e),window.location.replace(a+s)}static#e=this.\u0275fac=function(e){return new(e||n)(o.Y36(r.xD),o.Y36(r.bp),o.Y36(r.xE),o.Y36(P.F),o.Y36(r.I_),o.Y36(E.fA),o.Y36(r.xU),o.Y36(I.G),o.Y36(d.F0),o.Y36(f.lw),o.Y36(d.gz))};static#t=this.\u0275cmp=o.Xpm({type:n,selectors:[["es-apply-to-lms-page"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,a){1&e&&o.YNc(0,U,2,0,"div",0),2&e&&o.Q6J("ngIf",!a.reurl)},dependencies:[f.O5],encapsulation:2})}return n})()}];let v=(()=>{class n{static#e=this.\u0275fac=function(e){return new(e||n)};static#t=this.\u0275mod=o.oAB({type:n});static#o=this.\u0275inj=o.cJS({imports:[d.Bz.forChild(y),d.Bz]})}return n})(),A=(()=>{class n{static#e=this.\u0275fac=function(e){return new(e||n)};static#t=this.\u0275mod=o.oAB({type:n});static#o=this.\u0275inj=o.cJS({imports:[R.m,v]})}return n})()}}]);