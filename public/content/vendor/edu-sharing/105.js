"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[105],{105:(S,m,r)=>{r.r(m),r.d(m,{ContributorDialogModule:()=>P,ContributorsDialogComponent:()=>I});var h=r(50555),f=r(15861),v=r(96124),l=r(81771),p=r(52081),u=r(53461),T=r(4254),t=r(65879),O=r(91486),R=r(1846),b=r(36692),x=r(1189),_=r(96814),A=r(32296),C=r(22557),E=r(30617),Z=r(71365);function L(a,d){if(1&a){const o=t.EpF();t.TgZ(0,"mat-chip",11)(1,"span",12),t.NdJ("click",function(){const e=t.CHM(o),n=e.$implicit,c=e.index,s=t.oxw(2).$implicit,g=t.oxw();return t.KtG(g.editVCard("lifecycle",n,s,c))}),t._uU(2),t.qZA(),t.TgZ(3,"mat-icon",13),t.NdJ("click",function(){const n=t.CHM(o).index,c=t.oxw(2).$implicit,s=t.oxw();return t.KtG(s.remove(s.contributorLifecycle[c],n))}),t._uU(4,"cancel"),t.qZA()()}if(2&a){const o=d.$implicit;t.xp6(2),t.Oqu(o.getDisplayName())}}function M(a,d){if(1&a&&(t.TgZ(0,"div",8)(1,"div",9),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-chip-grid"),t.YNc(5,L,5,1,"mat-chip",10),t.qZA()()),2&a){const o=t.oxw().$implicit,i=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"WORKSPACE.CONTRIBUTOR.TYPE."+o.toUpperCase())),t.xp6(3),t.Q6J("ngForOf",i.contributorLifecycle[o])}}function y(a,d){if(1&a&&(t.TgZ(0,"div"),t.YNc(1,M,6,4,"div",7),t.qZA()),2&a){const o=d.$implicit,i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.contributorLifecycle[o]&&i.contributorLifecycle[o].length)}}function D(a,d){if(1&a){const o=t.EpF();t.TgZ(0,"mat-chip",11)(1,"span",12),t.NdJ("click",function(){const e=t.CHM(o),n=e.$implicit,c=e.index,s=t.oxw(2).$implicit,g=t.oxw();return t.KtG(g.editVCard("metadata",n,s,c))}),t._uU(2),t.qZA(),t.TgZ(3,"mat-icon",13),t.NdJ("click",function(){const n=t.CHM(o).index,c=t.oxw(2).$implicit,s=t.oxw();return t.KtG(s.remove(s.contributorMetadata[c],n))}),t._uU(4,"cancel"),t.qZA()()}if(2&a){const o=d.$implicit;t.xp6(2),t.Oqu(o.getDisplayName())}}function N(a,d){if(1&a&&(t.TgZ(0,"div",8)(1,"div",9),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"mat-chip-grid"),t.YNc(5,D,5,1,"mat-chip",10),t.qZA()()),2&a){const o=t.oxw().$implicit,i=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"WORKSPACE.CONTRIBUTOR.TYPE."+o.toUpperCase())),t.xp6(3),t.Q6J("ngForOf",i.contributorMetadata[o])}}function U(a,d){if(1&a&&(t.TgZ(0,"div"),t.YNc(1,N,6,4,"div",7),t.qZA()),2&a){const o=d.$implicit,i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.contributorMetadata[o]&&i.contributorMetadata[o].length)}}let I=(()=>{class a{constructor(o,i,e,n,c,s,g){this.data=o,this.dialogRef=i,this.cardDialogUtils=e,this.dialogs=n,this.localEvents=c,this.nodeService=s,this.toast=g,this.rolesLifecycle=l.u6.CONTRIBUTOR_ROLES_LIFECYCLE,this.rolesMetadata=l.u6.CONTRIBUTOR_ROLES_METADATA,this.contributorLifecycle={},this.contributorMetadata={}}ngOnInit(){this.initButtons(),this.initData()}initButtons(){this.dialogRef.patchConfig({buttons:[new l.Qd("CANCEL",{color:"standard"},()=>this.dialogRef.close(null)),new l.Qd("APPLY",{color:"primary"},()=>this.saveContributor())]})}initData(){var o=this;return(0,f.Z)(function*(){"string"==typeof o.data.node?(o.dialogRef.patchState({isLoading:!0}),o.node=yield o.nodeService.getNodeMetadata(o.data.node,[l.u6.ALL]).pipe((0,v.U)(({node:i})=>i)).toPromise()):o.node=o.data.node,o.dialogRef.patchConfig(yield o.cardDialogUtils.configForNode(o.node));for(let i of o.rolesLifecycle){o.contributorLifecycle[i]=[];let e=o.node.properties[l.u6.CONTRIBUTOR_LIFECYCLE_PREFIX+i];if(e)for(let n of e)n&&new p._W(n).isValid()&&o.contributorLifecycle[i].push(new p._W(n))}for(let i of o.rolesMetadata){o.contributorMetadata[i]=[];let e=o.node.properties[l.u6.CONTRIBUTOR_METADATA_PREFIX+i];if(e)for(let n of e)n&&new p._W(n).isValid()&&o.contributorMetadata[i].push(new p._W(n))}o.dialogRef.patchState({isLoading:!1})})()}remove(o,i){var e=this;return(0,f.Z)(function*(){(yield e.dialogs.openGenericDialog({title:"WORKSPACE.CONTRIBUTOR.DELETE_TITLE",message:"WORKSPACE.CONTRIBUTOR.DELETE_MESSAGE",messageParameters:{name:o[i].getDisplayName()},buttons:T.G2})).afterClosed().subscribe(c=>{"YES"===c&&(o.splice(i,1),e.dialogRef.patchConfig({closable:u.IA.Confirm}))})})()}addVCard(o){this.openEditDialog({editMode:o})}editVCard(o,i,e,n){var c=this;return(0,f.Z)(function*(){c.openEditDialog({vCard:i.copy(),editMode:o,position:n,role:e})})()}openEditDialog(o){var i=this;return(0,f.Z)(function*(){(yield i.dialogs.openContributorEditDialog(o)).afterClosed().subscribe(n=>{n&&i.saveEdits(o,n)})})()}saveEdits(o,i){this.dialogRef.patchConfig({closable:u.IA.Confirm});let e="lifecycle"==o.editMode?this.contributorLifecycle:this.contributorMetadata;o.role?(e[o.role].splice(o.position,1),o.role===i.role?e[o.role].splice(o.position,0,i.vCard):e[i.role].push(i.vCard)):e[i.role].push(i.vCard)}saveContributor(){this.dialogRef.patchState({isLoading:!0});let o={};for(let i of this.rolesLifecycle){let e=[];for(let n of this.contributorLifecycle[i])e.push(n.toVCardString());o["ccm:lifecyclecontributer_"+i]=e}for(let i of this.rolesMetadata){let e=[];for(let n of this.contributorMetadata[i])e.push(n.toVCardString());o["ccm:metadatacontributer_"+i]=e}this.nodeService.editNodeMetadataNewVersion(this.node.ref.id,l.u6.COMMENT_CONTRIBUTOR_UPDATE,o).subscribe(({node:i})=>{this.dialogRef.close(i),this.toast.toast("WORKSPACE.TOAST.CONTRIBUTOR_UPDATED"),this.localEvents.nodesChanged.emit([i])},i=>{this.toast.error(i),this.dialogRef.patchState({isLoading:!1})})}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(u.W9),t.Y36(O.Y),t.Y36(R.Z),t.Y36(b.H),t.Y36(p.Xn),t.Y36(l.xE),t.Y36(x.F))};static#o=this.\u0275cmp=t.Xpm({type:a,selectors:[["es-contributors-dialog"]],decls:18,vars:14,consts:[[1,"contributor-lifecycle"],[1,"mat-heading-4","lifecycleHeading"],[4,"ngFor","ngForOf"],["mat-raised-button","",1,"btnAdd",3,"click"],["esIcon","add"],[1,"contributor-metadata"],[1,"mat-heading-4","metadataHeading"],["class","group",4,"ngIf"],[1,"group"],[1,"role"],["class","badge clickable",4,"ngFor","ngForOf"],[1,"badge","clickable"],[3,"click"],["matChipRemove","",3,"click"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0)(1,"h4",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,y,2,1,"div",2),t.TgZ(5,"button",3),t.NdJ("click",function(){return e.addVCard("lifecycle")}),t._UZ(6,"i",4),t._uU(7),t.ALo(8,"translate"),t.qZA()(),t.TgZ(9,"div",5)(10,"h4",6),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.YNc(13,U,2,1,"div",2),t.TgZ(14,"button",3),t.NdJ("click",function(){return e.addVCard("metadata")}),t._UZ(15,"i",4),t._uU(16),t.ALo(17,"translate"),t.qZA()()),2&i&&(t.xp6(2),t.hij(" ",t.lcZ(3,6,"WORKSPACE.CONTRIBUTOR.LIFECYCLECONTRIBUTOR")," "),t.xp6(2),t.Q6J("ngForOf",e.rolesLifecycle),t.xp6(3),t.hij(" ",t.lcZ(8,8,"ADD")," "),t.xp6(4),t.hij(" ",t.lcZ(12,10,"WORKSPACE.CONTRIBUTOR.METADATACONTRIBUTOR")," "),t.xp6(2),t.Q6J("ngForOf",e.rolesMetadata),t.xp6(3),t.hij(" ",t.lcZ(17,12,"ADD")," "))},dependencies:[_.sg,_.O5,p.ar,A.lW,C.HS,C.RA,C.qH,E.Hw,Z.X$],styles:[".lifecycleHeading[_ngcontent-%COMP%], .metadataHeading[_ngcontent-%COMP%]{font-weight:700;color:var(--textLight);margin:0 0 10px}.role[_ngcontent-%COMP%]{color:var(--textLight)}.group[_ngcontent-%COMP%]{padding-bottom:10px}mat-chip-grid[_ngcontent-%COMP%]   mat-chip[_ngcontent-%COMP%]     .mat-mdc-chip-action{cursor:pointer;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.metadataHeading[_ngcontent-%COMP%]{padding-top:30px}.btnAdd[_ngcontent-%COMP%]{margin-top:10px;float:none!important;display:inline-flex;align-items:center}.btnAdd[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{top:0}"]})}return a})(),P=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#o=this.\u0275mod=t.oAB({type:a});static#i=this.\u0275inj=t.cJS({imports:[h.m]})}return a})()}}]);