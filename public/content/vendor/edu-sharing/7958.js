"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[7958],{37958:(B,d,s)=>{s.r(d),s.d(d,{AppLoginPageModule:()=>G});var C=s(50555),l=s(22941),u=s(15861),r=s(81771),c=s(52081),h=s(90721),t=s(65879),L=s(1189),f=s(96814),O=s(84003),_=s(34997),x=s(13838),a=s(56223),P=s(94618),T=s(35799),A=s(32296),m=s(64170),b=s(24516),N=s(71365);function M(o,v){1&o&&t._UZ(0,"es-global-progress")}function R(o,v){if(1&o){const n=t.EpF();t.TgZ(0,"div",11),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"button",12),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.register())}),t._uU(4),t.ALo(5,"translate"),t._UZ(6,"i",13),t.qZA()()}2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,2,"LOGIN.REGISTER_TEXT")," "),t.xp6(3),t.hij(" ",t.lcZ(5,4,"LOGIN.REGISTER_LINK")," "))}function E(o,v){if(1&o){const n=t.EpF();t.TgZ(0,"div",2)(1,"div",3)(2,"h1"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"div"),t._uU(6),t.ALo(7,"translate"),t.qZA()(),t.TgZ(8,"es-card",4),t.NdJ("onCancel",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.buttonLoginBack())}),t.ALo(9,"translate"),t.TgZ(10,"div",5)(11,"form",6,7),t.NdJ("ngSubmit",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.login())}),t.TgZ(13,"mat-form-field")(14,"mat-label"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"input",8),t.NdJ("ngModelChange",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.checkConditions())})("ngModelChange",function(i){t.CHM(n);const g=t.oxw();return t.KtG(g.username=i)}),t.qZA()(),t.TgZ(18,"div")(19,"es-input-password",9),t.NdJ("valueChange",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.checkConditions())})("keydown.enter",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.login())})("valueChange",function(i){t.CHM(n);const g=t.oxw();return t.KtG(g.password=i)}),t.ALo(20,"translate"),t.qZA()()(),t.YNc(21,R,7,6,"div",10),t.qZA()()()}if(2&o){const n=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,11,"LOGIN_APP.LOGIN")),t.xp6(3),t.Oqu(t.lcZ(7,13,"LOGIN_APP.LOGIN_INFO")),t.xp6(2),t.s9C("title",t.lcZ(9,15,"LOGIN_APP.LOGIN_TITLE")),t.Q6J("isCancelable",!0)("buttons",n.buttons),t.xp6(7),t.Oqu(t.lcZ(16,17,"LOGIN.USERNAME")),t.xp6(2),t.Q6J("ngModel",n.username),t.xp6(2),t.s9C("label",t.lcZ(20,19,"LOGIN.PASSWORD")),t.Q6J("required",!0)("value",n.password),t.xp6(2),t.Q6J("ngIf",n.config.register.local||n.config.register.registerUrl)}}const I=[{path:"",component:(()=>{class o{constructor(n,e,i,g,Z,U,y,J,F,Y){var p=this;this.toast=n,this.router=e,this.route=i,this.translations=g,this.platformLocation=Z,this.cordova=U,this.connector=y,this.bridge=J,this.configService=F,this.locator=Y,this.isLoading=!0,this.disabled=!0,this.username="",this.password="",this.serverurl="https://",this.errorURL=null,console.info("startup app"),this.isLoading=!0,this.cordova.isRunningCordova()?(this.route.queryParams.subscribe(K=>{this.locationNext=K.next}),this.cordova.subscribeServiceReady().subscribe((0,u.Z)(function*(){if(yield p.cordova.hasValidConfig())return console.info("app config valid, continuing to default location"),void p.cordova.refreshOAuth().subscribe(()=>{p.goToDefaultLocation()});p.init()}))):this.router.navigate([c.ru.ROUTER_PREFIX+"login"])}recoverPassword(){this.config.register.local?this.router.navigate([c.ru.ROUTER_PREFIX+"register","request"]):window.location.href=this.config.register.recoverUrl}buttonExitApp(){this.cordova.exitApp()}ngOnInit(){}checkConditions(){this.disabled=!this.username,this.updateButtons()}buttonLoginBack(){this.cordova.restartCordova()}login(){this.isLoading=!0,this.cordova.loginOAuth(this.locator.endpointUrl,this.username,this.password).subscribe(n=>{this.cordova.setPermanentStorage(r.u6.CORDOVA_STORAGE_OAUTHTOKENS,JSON.stringify(n)),this.goToDefaultLocation()},n=>{console.warn(n),this.isLoading=!1,this.toast.error(null,"string"==typeof n?n:"LOGIN.ERROR")})}goToDefaultLocation(){this.locationNext?(console.info("location next",this.locationNext),window.location.replace(this.locationNext)):this.configService.getAll().subscribe(()=>{h.d.goToDefaultLocation(this.router,this.platformLocation,this.configService,!0)})}getServerIcon(){return"assets/images/app-icon.svg"}init(){this.translations.waitForInit().subscribe(()=>{this.serverurl=this.locator.endpointUrl,this.configService.getAll().subscribe(n=>{this.config=n,this.config.register||(this.config.register={local:!0}),this.isLoading=!1,this.handleCurrentState()})})}register(){this.config.register.local?this.router.navigate([c.ru.ROUTER_PREFIX+"register"]):h.d.openUrl(this.config.register.registerUrl,this.bridge,c.qU.BlankSystemBrowser)}updateButtons(){const n=new r.Qd("LOGIN.LOGIN",{color:"primary"},()=>this.login());if(n.disabled=this.disabled,this.config&&(this.config.register.local||this.config.register.recoverUrl)){const e=new r.Qd("LOGIN.RECOVER_PASSWORD",{color:"standard"},()=>this.recoverPassword());this.buttons=[e,n]}else this.buttons=[n]}handleCurrentState(){var n=this;return(0,u.Z)(function*(){n.connector.isLoggedIn(!0).subscribe(e=>{console.info("app login status",e),e.statusCode===r.u6.STATUS_CODE_OK?n.cordova.loginOAuth(n.locator.endpointUrl,null,null,"client_credentials").subscribe(i=>{n.cordova.setPermanentStorage(r.u6.CORDOVA_STORAGE_OAUTHTOKENS,JSON.stringify(i)),n.goToDefaultLocation()}):n.checkLoginUrl()},e=>{n.checkLoginUrl()})})()}checkLoginUrl(){this.configService.instant("loginUrl")&&(window.location.href=this.configService.instant("loginUrl"))}static#t=this.\u0275fac=function(e){return new(e||o)(t.Y36(L.F),t.Y36(l.F0),t.Y36(l.gz),t.Y36(c.fA),t.Y36(f.lw),t.Y36(O.d),t.Y36(r.xD),t.Y36(_.d),t.Y36(r.eB),t.Y36(r.bp))};static#n=this.\u0275cmp=t.Xpm({type:o,selectors:[["es-app-login-page"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","appLogin",4,"ngIf"],[1,"appLogin"],[1,"infoTop",2,"margin-top","-10px"],["modal","auto","width","mlarge","height","large","avatar","assets/images/app-icon.svg",3,"title","isCancelable","buttons","onCancel"],[1,"card-content-padding"],[3,"ngSubmit"],["loginForm",""],["matInput","","required","","autofocus","","name","username","id","username",3,"ngModel","ngModelChange"],["inputId","password",3,"label","required","value","valueChange","keydown.enter"],["class","register",4,"ngIf"],[1,"register"],["mat-button","","color","primary",3,"click"],["esIcon","arrow_forward"]],template:function(e,i){1&e&&(t.YNc(0,M,1,0,"es-global-progress",0),t.YNc(1,E,22,21,"div",1)),2&e&&(t.Q6J("ngIf",i.isLoading),t.xp6(1),t.Q6J("ngIf",!i.isLoading))},dependencies:[x.A,f.O5,c.ar,a._Y,a.Fj,a.JJ,a.JL,a.Q7,a.On,a.F,P.d,T.P,A.lW,m.KE,m.hX,b.Nt,N.X$],styles:[".appLogin[_ngcontent-%COMP%]{background-color:#333;width:100%;height:100%}.card[_ngcontent-%COMP%], .card-high[_ngcontent-%COMP%]{top:15%;box-shadow:0 10px 70px #00000026}[_nghost-%COMP%]     mat-form-field{width:100%}.infoTop[_ngcontent-%COMP%]{position:absolute;top:6%;left:50%;margin-left:-265px;max-width:530px;padding:0 20px 20px}.infoTop[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#aaa}.infoTop[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:120%;font-weight:700;margin:0 0 5px;color:#fff}.register[_ngcontent-%COMP%]{color:var(--textLight)}.register[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-transform:uppercase}.register[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:11pt;position:relative;top:3px}@media only screen and (max-width: 600px){.infoTop[_ngcontent-%COMP%]{left:0;width:100%;margin-left:0}}@media only screen and (max-width: 800px){.branding[_ngcontent-%COMP%]{position:absolute;top:25px;left:calc(50% - 75px);height:50px}.branding[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:auto}}@media screen and (max-height: 750px){.card[_ngcontent-%COMP%]:not(.card-high){top:20%;bottom:auto}}@media screen and (max-height: 550px){.card[_ngcontent-%COMP%]:not(.card-high){top:0;bottom:0}.infoTop[_ngcontent-%COMP%]{display:none}}"]})}return o})()}];let S=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#n=this.\u0275mod=t.oAB({type:o});static#o=this.\u0275inj=t.cJS({imports:[l.Bz.forChild(I),l.Bz]})}return o})(),G=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#n=this.\u0275mod=t.oAB({type:o});static#o=this.\u0275inj=t.cJS({imports:[C.m,S]})}return o})()}}]);