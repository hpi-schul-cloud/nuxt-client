"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[4437],{64437:(ht,_,o)=>{o.r(_),o.d(_,{AddMaterialDialogComponent:()=>st,AddMaterialDialogModule:()=>ct});var T=o(50555),C=o(15861),p=o(86825),I=o(71993),c=o(56223),d=o(48098),r=o(52081),v=o(71928),f=o(49193),b=o(97734),x=o(17927),O=o(96124),S=o(73637),E=o(75222),L=o(11541),Z=o(62413),g=o(81771),A=o(19445),m=o(53461),t=o(65879),D=o(91486),y=o(36692),N=o(1189),R=o(98617),M=o(96814),k=o(43088),F=o(17162),U=o(5491),K=o(32296),w=o(75986),P=o(64170),J=o(24516),Q=o(82599),W=o(65928),H=o(31579),Y=o(71365);const G=["fileSelect"];function B(n,s){if(1&n&&(t.TgZ(0,"div",16),t._UZ(1,"es-user-quota",17),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("quota",e.userQuota)}}function j(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"div",10,11),t.NdJ("onFileDrop",function(a){t.CHM(e);const l=t.oxw();return t.KtG(l.closeWithFiles(a))})("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.selectFile())})("fileOver",function(a){t.CHM(e);const l=t.oxw();return t.KtG(l.isFileOver=a)}),t.TgZ(3,"div"),t._UZ(4,"i",12),t.qZA(),t.TgZ(5,"div"),t._uU(6),t.ALo(7,"translate"),t.TgZ(8,"es-mat-link",13),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.selectFile())}),t._uU(9),t.ALo(10,"translate"),t.qZA()()(),t.YNc(11,B,2,1,"div",14),t.TgZ(12,"div",15),t._uU(13),t.ALo(14,"translate"),t.qZA()()}if(2&n){const e=t.MAs(2),i=t.oxw();t.Q6J("@openOverlay",void 0),t.xp6(1),t.ekj("dropActive",i.isFileOver),t.xp6(5),t.hij(" ",t.lcZ(7,8,"WORKSPACE.ADD_OBJECT_MESSAGE")," "),t.xp6(2),t.Q6J("highlight",e.hovering),t.xp6(1),t.Oqu(t.lcZ(10,10,"WORKSPACE.ADD_OBJECT_BROWSE")),t.xp6(2),t.Q6J("ngIf",null==i.userQuota?null:i.userQuota.enabled),t.xp6(2),t.Oqu(t.lcZ(14,12,"WORKSPACE.SELECT_ORG"))}}function q(n,s){1&n&&t._UZ(0,"es-spinner-small",18)}function z(n,s){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.websiteInformation.title," - ")}}const X=function(){return{closeOnBack:!0}};function $(n,s){if(1&n&&(t.TgZ(0,"es-node-url",26),t._UZ(1,"es-node-row",27),t.qZA()),2&n){const e=s.$implicit,i=t.oxw(3);t.Q6J("node",e)("queryParams",t.DdM(4,X)),t.xp6(1),t.Q6J("node",e)("columns",i.columns)}}function V(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"es-info-message",23),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",24),t.YNc(5,$,2,5,"es-node-url",25),t.qZA(),t.BQk()),2&n){const e=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,2,"WORKSPACE.LINK_DUPLICATES_INFO")," "),t.xp6(3),t.Q6J("ngForOf",e.websiteInformation.duplicateNodes)}}function tt(n,s){if(1&n&&(t.TgZ(0,"div",19)(1,"div",20)(2,"div",21),t.YNc(3,z,2,1,"ng-container",2),t._uU(4),t.qZA(),t.TgZ(5,"div",22),t._uU(6),t.qZA()(),t.YNc(7,V,6,4,"ng-container",2),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",e.websiteInformation.title),t.xp6(1),t.hij(" ",e.websiteInformation.page," "),t.xp6(2),t.Oqu(e.websiteInformation.description),t.xp6(1),t.Q6J("ngIf",null==e.websiteInformation.duplicateNodes?null:e.websiteInformation.duplicateNodes.length)}}function et(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",31)(1,"div",32),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",33),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",34)(8,"mat-form-field")(9,"mat-label"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"input",35),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(2);return t.KtG(l.ltiConsumerKey=a)}),t.qZA()(),t.TgZ(13,"mat-form-field")(14,"mat-label"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"input",36),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(2);return t.KtG(l.ltiSharedSecret=a)}),t.qZA()()(),t._UZ(18,"div",37),t.ALo(19,"translate"),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,7,"WORKSPACE.LTI_HEADING")),t.xp6(3),t.Oqu(t.lcZ(6,9,"WORKSPACE.LTI_INFO")),t.xp6(5),t.Oqu(t.lcZ(11,11,"WORKSPACE.LTI_CONSUMER_KEY")),t.xp6(2),t.Q6J("ngModel",e.ltiConsumerKey),t.xp6(3),t.Oqu(t.lcZ(16,13,"WORKSPACE.LTI_SHARED_SECRET")),t.xp6(2),t.Q6J("ngModel",e.ltiSharedSecret),t.xp6(1),t.s9C("innerHTML",t.lcZ(19,15,"WORKSPACE.LTI_INFO_PRIVACY"),t.oJD)}}function nt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",28)(1,"div")(2,"mat-slide-toggle",29),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw();return t.KtG(l.ltiActivated=a)}),t._uU(3),t.ALo(4,"translate"),t.qZA()(),t.YNc(5,et,20,17,"div",30),t.qZA()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.ltiActivated),t.xp6(1),t.Oqu(t.lcZ(4,3,"WORKSPACE.ADD_OBJECT_LTI")),t.xp6(2),t.Q6J("ngIf",e.ltiActivated)}}function it(n,s){1&n&&(t.TgZ(0,"div",46),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"STORAGE_LOCATION_UNSET")," "))}function ot(n,s){if(1&n&&t._UZ(0,"es-breadcrumbs",47),2&n){const e=t.oxw(2);t.Q6J("clickable",!1)("home",e.breadcrumbs.homeLabel)("homeIcon",e.breadcrumbs.homeIcon)}}function at(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"mat-checkbox",48),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(2);return t.KtG(l.saveParent=a)})("ngModelChange",function(a){t.CHM(e);const l=t.oxw(2);return t.KtG(l.setSaveParent(a))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("ngModel",e.saveParent),t.xp6(1),t.hij("",t.lcZ(2,2,"STORAGE_LOCATION_SAVE")," ")}}function lt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",38)(1,"div",39),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"div",40),t.YNc(5,it,3,3,"div",41),t.YNc(6,ot,1,3,"es-breadcrumbs",42),t.TgZ(7,"div",43)(8,"button",44),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.chooseParent())}),t._uU(9),t.ALo(10,"translate"),t.qZA()()(),t.YNc(11,at,3,4,"mat-checkbox",45),t.qZA()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"WORKSPACE.FILE_LOCATION")),t.xp6(3),t.Q6J("ngIf",!e.parent),t.xp6(1),t.Q6J("ngIf",e.breadcrumbs),t.xp6(3),t.hij(" ",t.lcZ(10,7,"CHANGE_STORAGE_LOCATION")," "),t.xp6(2),t.Q6J("ngIf",e.showSaveParent)}}let st=(()=>{class n{constructor(e,i,a,l,h,dt,gt,pt,ft,mt){this.data=e,this.dialogRef=i,this.breadcrumbsService=a,this.clientUtils=l,this.configService=h,this.dialogs=dt,this.nodeService=gt,this.storageService=pt,this.toast=ft,this.userService=mt,this.disabled=!0,this.linkControl=new c.NI(""),this.showSaveParent=!1,this.saveParent=!1,this.hideFileUpload=!1,this.isFileOver=!1,this.loadingWebsiteInformation=!1,this.columns=[new r.HC("NODE",d.u6.LOM_PROP_TITLE),new r.HC("NODE",d.u6.CM_PROP_C_CREATED)],this.parent=this.data.parent,this.setState(""),this.userService.observeCurrentUser().pipe((0,I.sL)()).subscribe(u=>this.userQuota=u?.person.quota),this.configService.get("upload.lti.enabled",!1).subscribe(u=>this.ltiEnabled=u)}ngOnInit(){this.registerLink(),this.getBreadcrumbs(this.parent).pipe((0,b.h)(r.Nf)).subscribe(e=>{this.breadcrumbs=e,this.breadcrumbsService.setNodePath(e.nodes)})}registerLink(){this.linkControl.valueChanges.pipe((0,x.b)(()=>this.setState("")),(0,O.U)(e=>function rt(n){if(n=n?.trim(),!n)return null;n.startsWith("http://")||n.startsWith("https://")||(n="http://"+n);try{const s=new URL(n);if("http:"===s.protocol||"https:"===s.protocol)return n}catch{}return null}(e)),(0,S.D)(e=>v.H(e?500:0)),(0,x.b)(()=>{this.loadingWebsiteInformation=!0,this.websiteInformation=null}),(0,E.w)(e=>e?this.clientUtils.getWebsiteInformation({url:e}):f.of(null)),(0,L.x)(()=>this.loadingWebsiteInformation=!1)).subscribe({next:e=>{this.loadingWebsiteInformation=!1,this.websiteInformation=e,e&&this.setState(this.linkControl.value),this.updateHideFileUpload()},error:()=>{this.loadingWebsiteInformation=!1}})}updateHideFileUpload(){this.hideFileUpload&&!this.linkControl.value.trim()?this.hideFileUpload=!1:!this.hideFileUpload&&this.websiteInformation&&(this.hideFileUpload=!0)}cancel(){this.dialogRef.close(null)}selectFile(){this.file.nativeElement.click()}closeWithFiles(e){this.dialogRef.close({kind:"file",files:e,parent:this.parent})}setLink(){this.disabled||(!this.ltiActivated||this.ltiConsumerKey&&this.ltiSharedSecret?this.closeWithLink():this.toast.error(null,"WORKSPACE.TOAST.LTI_FIELDS_REQUIRED",null,null,null,{link:{caption:"WORKSPACE.TOAST.LTI_FIELDS_REQUIRED_LINK",callback:()=>{this.ltiActivated=!1,this.setLink()}}}))}closeWithLink(){this.dialogRef.close({kind:"link",link:this.linkControl.value,parent:this.parent,lti:this.ltiActivated?{consumerKey:this.ltiConsumerKey,sharedSecret:this.ltiSharedSecret}:null})}setState(e){e=e.trim(),this.disabled=!e,this.updateButtons(),this.dialogRef.patchConfig({closable:m.IA.Standard})}chooseParent(){var e=this;return(0,C.Z)(function*(){(yield e.dialogs.openFileChooserDialog({pickDirectory:!0,title:"WORKSPACE.CHOOSE_LOCATION_TITLE",subtitle:"WORKSPACE.CHOOSE_LOCATION_DESCRIPTION"})).afterClosed().subscribe(a=>{a&&e.parentSelected(a)})})()}parentSelected(e){this.showSaveParent=!0,this.parent=e[0],this.updateButtons(),this.dialogRef.patchConfig({closable:m.IA.Standard})}updateButtons(){const[e]=g.Qd.getOk(()=>this.setLink());e.disabled=this.disabled||this.data.chooseParent&&!this.parent;const i=[...g.Qd.getCancel(()=>this.cancel()),e];this.dialogRef.patchConfig({buttons:i})}getBreadcrumbs(e){return e&&e.ref.id!==d.u6.USERHOME?this.nodeService.getNodeParents(e.ref.id).pipe((0,O.U)(i=>this.getBreadcrumbsByParentList(i)),(0,Z.K)(()=>f.of(this.getBreadcrumbsByParentList({nodes:[e],pagination:null,scope:"UNKNOWN"})))):f.of(null)}getBreadcrumbsByParentList(e){const i=e.nodes.reverse();switch(e.scope){case"MY_FILES":case null:return{nodes:i,homeLabel:"WORKSPACE.MY_FILES",homeIcon:"person"};case"SHARED_FILES":return{nodes:i,homeLabel:"WORKSPACE.SHARED_FILES",homeIcon:"group"};case"UNKNOWN":return{nodes:i,homeLabel:"WORKSPACE.RESTRICTED_FOLDER",homeIcon:"folder"};default:return console.warn(`Unknown scope "${e.scope}"`),{nodes:i,homeLabel:null,homeIcon:null}}}setSaveParent(e){var i=this;return(0,C.Z)(function*(){e?(yield i.storageService.set("defaultInboxFolder",i.parent.ref.id),i.toast.toast("TOAST.STORAGE_LOCATION_SAVED",{name:i.parent.name})):(yield i.storageService.delete("defaultInboxFolder"),i.toast.toast("TOAST.STORAGE_LOCATION_RESET"))})()}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(m.W9),t.Y36(D.Y),t.Y36(A.d),t.Y36(d.zI),t.Y36(g.eB),t.Y36(y.H),t.Y36(g.xE),t.Y36(g.uR),t.Y36(N.F),t.Y36(d.KD))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["es-add-material-dialog"]],viewQuery:function(i,a){if(1&i&&t.Gf(G,5),2&i){let l;t.iGM(l=t.CRH())&&(a.file=l.first)}},features:[t._Bn([A.d])],decls:14,vars:10,consts:[["type","file","id","fileSelect",2,"display","none",3,"multiple","change"],["fileSelect",""],[4,"ngIf"],[1,"link"],[1,"link-info"],["matInput","","type","url","placeholder","http://","autocomplete","off","data-test","url-input","autofocus","",3,"formControl","keyup.enter"],["class","loading-website-information-spinner",4,"ngIf"],["class","link-details",4,"ngIf"],["class","lti",4,"ngIf"],["class","location",4,"ngIf"],["fileDrop","","esFocusState","",1,"dropArea",3,"onFileDrop","click","fileOver"],["dropArea","esFocusState"],["esIcon","cloud_upload"],["data-test","browse-files-button",3,"highlight","click"],["class","quota",4,"ngIf"],[1,"separator-line","uppercase"],[1,"quota"],[3,"quota"],[1,"loading-website-information-spinner"],[1,"link-details"],[1,"page-infos"],[1,"title"],[1,"description"],["mode","warning"],[1,"duplicate-nodes"],["target","_blank",3,"node","queryParams",4,"ngFor","ngForOf"],["target","_blank",3,"node","queryParams"],[3,"node","columns"],[1,"lti"],[1,"toggle-reverse",3,"ngModel","ngModelChange"],["class","lti-data",4,"ngIf"],[1,"lti-data"],[1,"heading"],[1,"info"],[1,"inputs"],["matInput","","id","consumerKey",3,"ngModel","ngModelChange"],["matInput","","id","sharedSecret",3,"ngModel","ngModelChange"],[1,"info","info-privacy",3,"innerHTML"],[1,"location"],[1,"caption"],[1,"picker-group"],["class","no-breadcrumbs",4,"ngIf"],["short","always",3,"clickable","home","homeIcon",4,"ngIf"],[1,"change"],["mat-button","","color","primary",3,"click"],[3,"ngModel","ngModelChange",4,"ngIf"],[1,"no-breadcrumbs"],["short","always",3,"clickable","home","homeIcon"],[3,"ngModel","ngModelChange"]],template:function(i,a){1&i&&(t.TgZ(0,"input",0,1),t.NdJ("change",function(h){return a.closeWithFiles(h.target.files)}),t.qZA(),t.YNc(2,j,15,14,"div",2),t.TgZ(3,"div",3)(4,"div",4)(5,"mat-form-field")(6,"mat-label"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"input",5),t.NdJ("keyup.enter",function(){return a.setLink()}),t.qZA()()(),t.YNc(10,q,1,0,"es-spinner-small",6),t.YNc(11,tt,8,4,"div",7),t.YNc(12,nt,6,5,"div",8),t.YNc(13,lt,12,9,"div",9),t.qZA()),2&i&&(t.Q6J("multiple",a.data.multiple),t.xp6(2),t.Q6J("ngIf",!a.hideFileUpload),t.xp6(5),t.Oqu(t.lcZ(8,8,"WORKSPACE.SELECT_LINK")),t.xp6(2),t.Q6J("formControl",a.linkControl),t.xp6(1),t.Q6J("ngIf",a.loadingWebsiteInformation),t.xp6(1),t.Q6J("ngIf",null==a.websiteInformation?null:a.websiteInformation.page),t.xp6(1),t.Q6J("ngIf",a.data.showLti&&a.ltiEnabled),t.xp6(1),t.Q6J("ngIf",a.data.chooseParent))},dependencies:[R.n,M.sg,M.O5,r.Qr,r.ar,r.mn,r.G2,k.G,c.Fj,c.JJ,c.On,F.u,U.N,K.lW,w.oG,P.KE,P.hX,J.Nt,Q.Rr,c.oH,W.h,H.h,Y.X$],styles:[".dropArea[_ngcontent-%COMP%]{border-radius:5px;text-align:center;border:2px dashed #ccc;padding:40px 30px;margin-bottom:10px;color:var(--textLight);cursor:pointer}.dropArea[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-weight:700}.dropArea[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:60px}.dropArea.dropActive[_ngcontent-%COMP%]{border-color:var(--palette-primary-200);background:var(--palette-primary-100)}.dropArea.dropActive[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.dropArea.dropActive[_ngcontent-%COMP%]   .object-message[_ngcontent-%COMP%]{margin-bottom:10px}.loading-website-information-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:20px 0}.link-details[_ngcontent-%COMP%]   .page-infos[_ngcontent-%COMP%]{padding:10px 20px;border:1px solid #ccc}.link-details[_ngcontent-%COMP%]   .page-infos[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700}.link-details[_ngcontent-%COMP%]   .page-infos[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-height:1.25em;max-height:2.5em;-webkit-line-clamp:2;-webkit-box-orient:vertical;color:var(--textMediumLight);font-size:90%}.link-details[_ngcontent-%COMP%]   es-info-message[_ngcontent-%COMP%]{display:flex;margin:20px 0}.separator-line[_ngcontent-%COMP%]{margin:20px 5px}mat-form-field[_ngcontent-%COMP%]{width:100%}.quota[_ngcontent-%COMP%]{padding-bottom:5px}.lti-data[_ngcontent-%COMP%]{margin:20px -25px;padding:20px 25px}.lti-data[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{font-size:110%;font-weight:700;padding:10px 0}.lti-data[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{color:var(--textLight);padding:5px 0;white-space:pre-line}.lti-data[_ngcontent-%COMP%]   .info-privacy[_ngcontent-%COMP%]{font-size:90%}.lti-data[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]{padding-top:15px}.link[_ngcontent-%COMP%]{width:100%}.link[_ngcontent-%COMP%]   .linkLabel[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.link[_ngcontent-%COMP%]   .linkLabel[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{margin-right:5px}.link[_ngcontent-%COMP%]   .linkTitle[_ngcontent-%COMP%]{color:var(--textLight)}.link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{top:7px}.link[_ngcontent-%COMP%]   .lti[_ngcontent-%COMP%]{display:flex;flex-direction:column}.link[_ngcontent-%COMP%]   .toolInfo[_ngcontent-%COMP%]{display:flex;padding:15px 20px}.link[_ngcontent-%COMP%]   .toolInfo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{padding-right:15px}.link[_ngcontent-%COMP%]   .toolInfo[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700}.location[_ngcontent-%COMP%]{margin-top:20px;background-color:#fff;display:flex;flex-direction:column}.location[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{float:left;margin-bottom:5px}.location[_ngcontent-%COMP%]   .picker-group[_ngcontent-%COMP%]{display:flex;align-items:center;padding:10px 25px;margin:0 -25px;background-color:rgba(var(--palette-primary-500-no-rgb),.08)}.location[_ngcontent-%COMP%]   .picker-group[_ngcontent-%COMP%]   .no-breadcrumbs[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center;color:var(--textLight)}.location[_ngcontent-%COMP%]   .picker-group[_ngcontent-%COMP%]   .change[_ngcontent-%COMP%]{flex-grow:1;font-weight:700;min-width:20%;text-align:right}.location[_ngcontent-%COMP%] > mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-top:20px}.location[_ngcontent-%COMP%]     .breadcrumb{max-height:unset!important;flex-wrap:wrap}"],data:{animation:[(0,p.X$)("fade",r.Le.fade()),(0,p.X$)("cardAnimation",r.Le.cardAnimation()),(0,p.X$)("openOverlay",r.Le.openOverlay())]}})}return n})(),ct=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[T.m]})}return n})()}}]);