{"version":3,"file":"src_app_pages_apply-to-lms-page_apply-to-lms-page_module_ts.js","mappings":"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","sources":["./src/app/pages/apply-to-lms-page/apply-to-lms-page-routing.module.ts","./src/app/pages/apply-to-lms-page/apply-to-lms-page.component.ts","./src/app/pages/apply-to-lms-page/apply-to-lms-page.component.html","./src/app/pages/apply-to-lms-page/apply-to-lms-page.module.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { ApplyToLmsPageComponent } from './apply-to-lms-page.component';\n\nconst routes: Routes = [\n    {\n        path: ':repo/:node',\n        component: ApplyToLmsPageComponent,\n    },\n];\n\n@NgModule({\n    imports: [RouterModule.forChild(routes)],\n    exports: [RouterModule],\n})\nexport class ApplyToLmsPageRoutingModule {}\n","import { Component } from '@angular/core';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\nimport {\n    FrameEventsService,\n    Node,\n    NodeRemoteWrapper,\n    NodeWrapper,\n    RestConnectorService,\n    RestConstants,\n    RestLocatorService,\n    RestNodeService,\n    TemporaryStorageService,\n} from '../../core-module/core.module';\nimport { Toast } from '../../services/toast';\nimport { NodeHelperService } from '../../services/node-helper.service';\nimport { TranslationsService } from 'ngx-edu-sharing-ui';\nimport { RouterHelper } from '../../util/router.helper';\nimport { PlatformLocation } from '@angular/common';\n\nexport class NodeLMS extends Node {\n    objectUrl?: string;\n    nodeId?: string;\n}\n\n@Component({\n    selector: 'es-apply-to-lms-page',\n    templateUrl: 'apply-to-lms-page.component.html',\n})\nexport class ApplyToLmsPageComponent {\n    constructor(\n        private connector: RestConnectorService,\n        private locator: RestLocatorService,\n        private nodeApi: RestNodeService,\n        private toast: Toast,\n        private events: FrameEventsService,\n        private translations: TranslationsService,\n        private temporaryStorage: TemporaryStorageService,\n        private nodeHelper: NodeHelperService,\n        private router: Router,\n        private platformLocation: PlatformLocation,\n        private route: ActivatedRoute,\n    ) {\n        this.route.queryParams.subscribe((params: Params) => {\n            if (params.reurl) {\n                this.reurl = params.reurl;\n            }\n            this.route.params.subscribe((params: Params) => {\n                this.toast.showProgressSpinner();\n                if (temporaryStorage.get(TemporaryStorageService.APPLY_TO_LMS_PARAMETER_NODE)) {\n                    this.node = temporaryStorage.get(\n                        TemporaryStorageService.APPLY_TO_LMS_PARAMETER_NODE,\n                    );\n                    this.forward();\n                } else if (params.node) {\n                    this.nodeApi\n                        .getNodeMetadata(params.node, [RestConstants.ALL], params.repo)\n                        .subscribe(\n                            (data: NodeWrapper) => {\n                                this.node = data.node;\n                                this.forward();\n                            },\n                            (error: any) => {\n                                this.translations.waitForInit().subscribe(() => {\n                                    this.toast.error(error);\n                                });\n                            },\n                        );\n                }\n            });\n        });\n    }\n    node: Node;\n    reurl: string;\n\n    private static roundNumber(number: number) {\n        number = Math.round(number);\n        if (Number.isNaN(number)) return 0;\n        return number;\n    }\n\n    forward() {\n        this.nodeApi.prepareUsage(this.node.ref.id, this.node.ref.repo).subscribe(\n            (nodeWrapper) => {\n                this.applyNode(nodeWrapper);\n            },\n            (error) => {\n                this.toast.error(error);\n            },\n        );\n    }\n\n    private applyNode(wrapper: NodeRemoteWrapper) {\n        const node: NodeLMS = wrapper.node;\n        // copy the main object to remote (in this case, it's simply a regular, local object)\n        if (!wrapper.remote) wrapper.remote = wrapper.node;\n        const reurl = this.reurl;\n        // the ccrep should always point to the local object (relevant if it's from a remote repo)\n        const ccrepUrl =\n            'ccrep://' +\n            encodeURIComponent(wrapper.remote.ref.repo) +\n            '/' +\n            encodeURIComponent(wrapper.remote.ref.id);\n        if (reurl == 'IFRAME' || reurl == 'WINDOW') {\n            node.objectUrl = ccrepUrl;\n            node.nodeId = wrapper.remote.ref.id;\n            this.nodeHelper.appendImageData(node).then(\n                (data) => {\n                    this.events.broadcastEvent(FrameEventsService.EVENT_APPLY_NODE, data);\n                    window.history.back();\n                },\n                (error) => {\n                    console.warn('failed to fetch image data', error);\n                    this.events.broadcastEvent(FrameEventsService.EVENT_APPLY_NODE, node);\n                    window.history.back();\n                },\n            );\n            return;\n        }\n        console.warn(\n            'Using an absolute url for the \"reurl\" parameter is deprecated. Please prefer the value \"WINDOW\" and use frame communication',\n        );\n        let params = reurl.indexOf('?') == -1 ? '?' : '&';\n        params += 'nodeId=' + ccrepUrl;\n        params += '&localId=' + encodeURIComponent(node.ref.id);\n        if (node.title) params += '&title=' + encodeURIComponent(node.title);\n        else params += '&title=' + encodeURIComponent(node.name);\n        params += '&mimeType=' + encodeURIComponent(node.mimetype);\n        params += '&mediatype=' + encodeURIComponent(node.mediatype);\n        params +=\n            '&h=' +\n            ApplyToLmsPageComponent.roundNumber(node.properties[RestConstants.CCM_PROP_HEIGHT]);\n        params +=\n            '&w=' +\n            ApplyToLmsPageComponent.roundNumber(node.properties[RestConstants.CCM_PROP_WIDTH]);\n        if (node.content.version) params += '&v=' + node.content.version;\n        if (node.properties[RestConstants.CCM_PROP_CCRESSOURCETYPE])\n            params +=\n                '&resourceType=' +\n                encodeURIComponent(node.properties[RestConstants.CCM_PROP_CCRESSOURCETYPE]);\n        if (node.properties[RestConstants.CCM_PROP_CCRESSOURCEVERSION])\n            params +=\n                '&resourceVersion=' +\n                encodeURIComponent(node.properties[RestConstants.CCM_PROP_CCRESSOURCEVERSION]);\n        params += '&isDirectory=' + node.isDirectory;\n        params += '&iconURL=' + encodeURIComponent(node.iconURL);\n        params += '&previewURL=' + encodeURIComponent(node.preview.url);\n        params += '&repoType=' + encodeURIComponent(node.repositoryType);\n        // reurl + params\n        // let contentParams = node.contentUrl.indexOf(\"?\") == -1 ? '?' : '&';\n        // contentParams += \"LMS_URL=\" + encodeURIComponent(reurl);\n        // console.log(node.contentUrl + contentParams);\n        console.log(reurl);\n        this.temporaryStorage.set(TemporaryStorageService.APPLY_TO_LMS_PARAMETER_NODE, node);\n        window.location.replace(reurl + params);\n    }\n}\n","<div *ngIf=\"!reurl\">No reurl received. Please check request.</div>\n","import { NgModule } from '@angular/core';\nimport { SharedModule } from '../../shared/shared.module';\nimport { ApplyToLmsPageRoutingModule } from './apply-to-lms-page-routing.module';\nimport { ApplyToLmsPageComponent } from './apply-to-lms-page.component';\n\n@NgModule({\n    declarations: [ApplyToLmsPageComponent],\n    imports: [SharedModule, ApplyToLmsPageRoutingModule],\n})\nexport class ApplyToLmsPageModule {}\n"],"names":["RouterModule","ApplyToLmsPageComponent","routes","path","component","ApplyToLmsPageRoutingModule","_","_2","_3","forChild","imports","i1","exports","FrameEventsService","Node","RestConstants","TemporaryStorageService","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","NodeLMS","constructor","connector","locator","nodeApi","toast","events","translations","temporaryStorage","nodeHelper","router","platformLocation","route","queryParams","subscribe","params","reurl","showProgressSpinner","get","APPLY_TO_LMS_PARAMETER_NODE","node","forward","getNodeMetadata","ALL","repo","data","error","waitForInit","roundNumber","number","Math","round","Number","isNaN","prepareUsage","ref","id","nodeWrapper","applyNode","wrapper","remote","ccrepUrl","encodeURIComponent","objectUrl","nodeId","appendImageData","then","broadcastEvent","EVENT_APPLY_NODE","window","history","back","console","warn","indexOf","title","name","mimetype","mediatype","properties","CCM_PROP_HEIGHT","CCM_PROP_WIDTH","content","version","CCM_PROP_CCRESSOURCETYPE","CCM_PROP_CCRESSOURCEVERSION","isDirectory","iconURL","preview","url","repositoryType","log","set","location","replace","ɵɵdirectiveInject","RestConnectorService","RestLocatorService","RestNodeService","i2","Toast","i3","TranslationsService","i4","NodeHelperService","i5","Router","i6","PlatformLocation","ActivatedRoute","selectors","decls","vars","consts","template","ApplyToLmsPageComponent_Template","rf","ctx","ɵɵtemplate","ApplyToLmsPageComponent_div_0_Template","ɵɵproperty","SharedModule","ApplyToLmsPageModule","declarations"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}