"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[9139],{89139:(G,D,r)=>{r.r(D),r.d(D,{SearchPageModule:()=>wt});var A=r(2962),U=r(50555),b=r(22941),P=r(96776),h=r(96124),f=r(12994),u=r(45125),R=r(72079),d=r(19352),v=r(75222),O=r(17927),C=r(32068),m=r(81771),E=r(81955),M=r(26523),e=r(65879),_=r(48098),B=r(47354),w=r(49193),p=r(97734),l=r(52081),he=r(61396),k=r(5178),X=r(58723),ge=r(86381),ue=r(16640);class W{constructor(o,t,s,a){this.repository=o,this.metadataSet=t,this.searchFilters=s,this.searchString=a}equals(o){return JSON.stringify(this)===JSON.stringify(o)}}let L=(()=>{class i{get results(){return this._results.value}set results(t){this._results.next(t)}constructor(t,s,a,n,c,g,x,N,y,J){this.collection=t,this.config=s,this.mainNavService=a,this.mds=n,this.navigationScheduler=c,this.network=g,this.route=x,this.router=N,this.searchField=y,this.userModifiableValues=J,this.availableRepositories=new u.X(null),this.activeRepository=this.userModifiableValues.createString(),this.showingAllRepositories=new u.X(null),this.availableMetadataSets=new u.X(null),this.activeMetadataSet=this.userModifiableValues.createString(),this.filterBarIsVisible=this.userModifiableValues.createBoolean(!1),this.searchFilters=this.userModifiableValues.createDict(),this.searchString=this.userModifiableValues.createString(),this.loadingProgress=new u.X(null),this.reUrl=new u.X(null),this.addToCollectionMode=new u.X(null),this.filtersMdsWidgets=new u.X(null),this.facetsToFetch=new u.X(null),this._results=new u.X(null),this.destroyed=new R.xQ}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}init(){this.initBasicData(),this.registerSearchField(),this.initSearchPageUi(),this.initQueryParams(),this.registerAllRepositories(),this.registerAddToCollection()}initSearchFieldOnly(){this.initBasicData();const t=this.registerSearchField({autoFocusSearchField:!1});this.initQueryParams(),t.patchConfig({showFiltersButton:!1}),B.T(t.onSearchTriggered().pipe((0,p.h)(({cleared:s})=>!s)),t.onFilterValuesChanged()).subscribe(()=>{this.navigationScheduler.scheduleNavigation({route:[m.ru.ROUTER_PREFIX,"search"]})})}initBasicData(){this.registerRepositories(),this.registerAvailableMetadataSets(),this.registerActiveMetadataSet()}initSearchPageUi(){this.registerLoadingProgress()}initQueryParams(){this.activeRepository.registerQueryParameter("repo",this.route),this.activeMetadataSet.registerQueryParameter("mds",this.route),this.searchFilters.registerQueryParameter("filters",this.route),this.searchString.registerQueryParameter("q",this.route),this.filterBarIsVisible.registerSessionStorage("search-page-filter-bar"),this.route.queryParams.pipe((0,h.U)(t=>t.reurl||!1)).subscribe(this.reUrl)}registerRepositories(){f.aj([this.network.getRepositories(),this.config.observeConfig()]).subscribe(([t,s])=>this.availableRepositories.next(function de(i,o){return o.availableRepositories?i.filter(s=>s.isHomeRepo&&o.availableRepositories.includes(_.Qs)||o.availableRepositories.includes(s.id)):i}(t,s))),this.availableRepositories.pipe((0,p.h)(l.Nf)).subscribe(t=>{this.activeRepository.setSystemValue(t[0].id),t.some(({id:s})=>s===this.activeRepository.getValue())||this.activeRepository.resetUserValue()})}registerAllRepositories(){this.showingAllRepositories.subscribe(t=>{t?(this.activeRepository.setOverrideValue(null),this.filterBarIsVisible.resetUserValue()):this.activeRepository.unsetOverrideValue()})}registerAvailableMetadataSets(){this.activeRepository.observeValue().pipe((0,p.h)(l.Nf),(0,O.b)(()=>this.availableMetadataSets.next(null)),(0,v.w)(t=>this.availableRepositories.pipe((0,p.h)(l.Nf),(0,h.U)(s=>s.find(a=>a.id===t)))),(0,v.w)(t=>this.getAvailableMetadataSets(t))).subscribe(t=>this.availableMetadataSets.next(t))}getAvailableMetadataSets(t){return f.aj([this.mds.getAvailableMetadataSets(t.id),this.config.observeConfig()]).pipe((0,h.U)(([s,a])=>function pe(i,o,t){const s=o.availableMds?.find(a=>a.repository===t.id||a.repository===_.Qs&&t.isHomeRepo)?.mds;if(s){const a=i.filter(n=>s.includes(n.id));return 0===a.length&&console.warn(`The filtered mds ${s} did not exists for the current app ${t.id}. Check your Application XML config value "metadatasetsV2"`),a}return i}(s,a,t)))}registerActiveMetadataSet(){this.availableMetadataSets.subscribe(t=>{t?this.activeMetadataSet.unsetOverrideValue():this.activeMetadataSet.setOverrideValue(null),this.activeMetadataSet.setSystemValue(t?.[0]?.id),t&&!t.some(s=>s.id===this.activeMetadataSet.getValue())&&this.activeMetadataSet.resetUserValue()})}registerSearchField({autoFocusSearchField:t=!0}={}){const s=this.searchField.enable({placeholder:"SEARCH.SEARCH_STUFF",autoFocus:t},this.destroyed);return this.showingAllRepositories.subscribe(a=>{s.patchConfig({showFiltersButton:!a,enableFiltersAndSuggestions:!a})}),s.onFiltersButtonClicked().subscribe(()=>this.filterBarIsVisible.setUserValue(!this.filterBarIsVisible.getValue())),s.onSearchTriggered().subscribe(({searchString:a})=>this.searchString.setUserValue(a||null)),this.searchString.observeUserValue().subscribe(a=>s.setSearchString(a)),f.aj([this.activeRepository.observeValue(),this.activeMetadataSet.observeValue()]).pipe((0,d.R)(this.destroyed),(0,p.h)(([a,n])=>(0,l.Nf)(a)&&(0,l.Nf)(n)),(0,h.U)(([a,n])=>({repository:a,metadataSet:n}))).subscribe(a=>s.setMdsInfo(a)),s.onFilterValuesChanged().subscribe(a=>{this.searchFilters.setUserValue(a)}),this.searchFilters.observeUserValue().subscribe(a=>{s.setFilterValues(a),s.setSearchString(this.searchString.getValue())}),s}registerLoadingProgress(){this._results.pipe((0,p.h)(l.Nf),(0,v.w)(t=>t.loadingProgress)).subscribe(this.loadingProgress)}registerAddToCollection(){this.route.queryParamMap.pipe((0,h.U)(t=>t.get("addToCollection")),(0,C.x)(),(0,v.w)(t=>t?this.collection.getCollection(t):w.of(null))).subscribe(t=>{this.addToCollectionMode.next(t?{collection:t,customOptions:this.getAddToCollectionOptions(t)}:null)})}getAddToCollectionOptions(t){const s=new l.BA("SEARCH.ADD_INTO_COLLECTION_SHORT","layers",(n,c)=>{this.mainNavService.getDialogs().addToCollectionList(t,c,!0,()=>this.router.navigate([m.ru.ROUTER_PREFIX+"collections"],{queryParams:{id:t.ref.id}}))});s.elementType=he.C.ElementTypesAddToCollection,s.group=l.EM.Reuse,s.showAlways=!0;const a=new l.BA("CANCEL","close",()=>this.router.navigate([m.ru.ROUTER_PREFIX,"collections"],{queryParams:{id:t.ref.id}}));return a.group=l.EM.Delete,a.elementType=[l.Hd.Unknown],{useDefaultOptions:!1,addOptions:[a,s]}}static#e=this.\u0275fac=function(s){return new(s||i)(e.LFG(_.a$),e.LFG(_.E4),e.LFG(k.ZF),e.LFG(_.Pf),e.LFG(X.t),e.LFG(_.SL),e.LFG(b.gz),e.LFG(b.F0),e.LFG(ge.LN),e.LFG(ue.l))};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac})}return i})();var K=r(75810),S=r(96814);class me{constructor(o){this.state=null,this.scrollPosition=null,this.dataSourceStates={},this.navigationId=o}}let z=(()=>{class i{constructor(t,s){this._router=t,this._viewportScroller=s,this._entries=[],this._restoreScrollTrigger=new R.xQ,this._currentNavigationId=1,this._registerRouterEvents(),this._registerRestoreScrollTrigger()}registerDataSource(t,s){s.connect().pipe((0,p.h)(()=>!s.isLoading),(0,P.b)(0)).subscribe(()=>this._putState(t,s.dumpState())),s.registerRestoreFunction(()=>this._restoreState(t))}_restoreState(t){const s=this._getRestoreEntry();return this._restoreScrollTrigger.next(s),s?.dataSourceStates[t]??null}_registerRestoreScrollTrigger(){this._restoreScrollTrigger.pipe((0,p.h)(l.Nf),(0,P.b)(0),(0,h.U)(({scrollPosition:t})=>t),(0,p.h)(l.Nf),(0,v.w)(t=>document.documentElement.scrollHeight<window.innerHeight+t[1]?w.of(t).pipe((0,K.g)(0)):w.of(t))).subscribe(t=>{this._viewportScroller.scrollToPosition(t)})}_putState(t,s){const a=this._getEntryOrCreate();a.state="active",a.dataSourceStates[t]=s}_getRestoreEntry(){return this._entries.find(({state:t,navigationId:s})=>"restore"===t&&s===this._currentNavigationId)??null}_getEntryOrCreate(){let t=this._entries.find(({navigationId:s})=>s===this._currentNavigationId);return null==t&&(t=new me(this._currentNavigationId),this._entries.push(t)),t}_registerRouterEvents(){this._router.events.pipe((0,p.h)(t=>t instanceof b.OD)).subscribe(t=>{if(this._currentNavigationId=t.id,"popstate"===t.navigationTrigger){const s=t.restoredState?.navigationId,a=this._entries.find(({navigationId:n})=>n===s);a&&(a.state="restore",a.navigationId=t.id)}}),this._router.events.pipe((0,p.h)(t=>t instanceof b.Xs)).subscribe(t=>{t.position&&(this._getEntryOrCreate().scrollPosition=t.position)})}static#e=this.\u0275fac=function(s){return new(s||i)(e.LFG(b.F0),e.LFG(S.EM))};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var T=r(71365);let $=(()=>{class i{constructor(t,s,a,n,c,g){this._injector=t,this._search=s,this._searchPage=a,this._searchPageRestore=n,this._mds=c,this._translate=g,this.repoData=new u.X(null),this.loadingProgress=new u.X(0),this._destroyed=new R.xQ,this._initRepoData(),this._registerPageRestore(),this._registerLoadingProgress()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}addNodes(t){this.repoData.value.find(({isHome:a})=>a)?.dataSource.appendData(t,"before")}_initRepoData(){this._searchPage.availableRepositories.pipe((0,d.R)(this._destroyed)).subscribe(t=>{this.repoData.next(t.map(s=>this._getRepoData(s)))})}_registerPageRestore(){this.repoData.subscribe(t=>{for(const s of t)this._searchPageRestore.registerDataSource(s.id,s.dataSource)})}_getRepoData(t){const s=new u.X(!0),a=new u.X(!0),n=new M.hB(this._injector),c=this._getMetadataSet(t),g=c.pipe((0,v.w)(y=>this._getMdsDefinition(t,y))),x=g.pipe((0,v.w)(y=>this._getColumns(y))),N=g.pipe((0,h.U)(y=>this._getDefaultSort(y)));return f.aj([c,N,this._searchPage.searchString.observeValue()]).pipe((0,O.b)(()=>s.next(!1)),(0,d.R)(this._destroyed)).subscribe(([y,J,Zt])=>{n.setRemote(this._getSearchRemote(t,y,J,Zt))}),n.isLoadingSubject.subscribe(y=>a.next(!!y)),{title:t.title,id:t.id,isHome:t.isHomeRepo,dataSource:n,columns:x,loadingParams:s,loadingContent:a}}_getMetadataSet(t){return this._searchPage.getAvailableMetadataSets(t).pipe((0,d.R)(this._destroyed),(0,h.U)(s=>s[0]))}_getMdsDefinition(t,s){return this._mds.getMetadataSet({repository:t.id,metadataSet:s.id})}_getColumns(t){return this._translate.get("dummy").pipe((0,h.U)(()=>E.h.getColumns(this._translate,t,"search")))}_getDefaultSort(t){return E.h.getSortInfo(t,"search")?.default}_getSearchRemote(t,s,a,n){const c=n?[{property:"ngsearchword",values:[n]}]:[];return g=>this._search.search({body:{criteria:c},maxItems:g.range.endIndex-g.range.startIndex,skipCount:g.range.startIndex,sortAscending:a?[a.sortAscending]:null,sortProperties:a?[a.sortBy]:null,contentType:"FILES",repository:t.id,metadataset:s.id,query:m.u6.DEFAULT_QUERY_NAME,propertyFilter:[m.u6.ALL]}).pipe((0,h.U)(M.CO))}_registerLoadingProgress(){this.repoData.pipe((0,v.w)(t=>f.aj([f.aj(t.map(s=>s.loadingParams)),f.aj(t.map(s=>s.loadingContent))])),(0,h.U)(([t,s])=>{const a=t.filter(q).length,n=s.filter(q).length;return 0===a?10:a<t.length?a/t.length*30+10:n/s.length*60+40}),(0,C.x)()).subscribe(this.loadingProgress)}static#e=this.\u0275fac=function(s){return new(s||i)(e.LFG(e.zs3),e.LFG(_.oD),e.LFG(L),e.LFG(z),e.LFG(_.Pf),e.LFG(T.sK))};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac})}return i})();function q(i){return!1===i}var V=r(32296),ee=r(55940);const fe=function(){return{maxWidth:100,maxHeight:100,crop:!0}};function _e(i,o){if(1&i&&(e._UZ(0,"img",9),e.ALo(1,"async"),e.ALo(2,"esNodeImage")),2&i){const t=e.oxw(2);e.Q6J("src",e.lcZ(1,1,e.xi3(2,3,t.collection,e.DdM(6,fe))),e.LSH)}}function Se(i,o){if(1&i&&(e.TgZ(0,"div",10)(1,"i",11),e._uU(2,"layers"),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(1),e.Udp("color",t.collection.collection.color)}}const te=function(i){return{title:i}};function ve(i,o){if(1&i&&(e.TgZ(0,"div",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,t.titleLabel,e.VKq(4,te,t.collection.title))," ")}}function be(i,o){if(1&i&&(e.TgZ(0,"div",13),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,t.titleLabelShort,e.VKq(4,te,t.collection.title))," ")}}function Ce(i,o){if(1&i&&(e.TgZ(0,"div",13),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.collection.title," ")}}function Pe(i,o){if(1&i&&(e.TgZ(0,"div",1)(1,"div",2),e.YNc(2,_e,3,7,"img",3),e.YNc(3,Se,3,2,"div",4),e.qZA(),e.TgZ(4,"div",5),e.YNc(5,ve,3,6,"div",6),e.YNc(6,be,3,6,"div",7),e.YNc(7,Ce,2,1,"div",7),e._UZ(8,"es-list-base",8),e.Hsn(9),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.Udp("background-color",t.collection.collection.color),e.ekj("image-icon",t.collection.preview.isIcon),e.xp6(1),e.Q6J("ngIf",!t.collection.preview.isIcon),e.xp6(1),e.Q6J("ngIf",t.collection.preview.isIcon),e.xp6(2),e.Q6J("ngIf",t.titleLabel),e.xp6(1),e.Q6J("ngIf",t.titleLabelShort),e.xp6(1),e.Q6J("ngIf",!(t.titleLabel&&t.titleLabelShort)),e.xp6(1),e.Q6J("node",t.collection)("item",t.scopeItem)}}const ye=["*"];let se=(()=>{class i{constructor(){this.scopeItem=new l.HC("COLLECTION","scope")}static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["es-small-collection"]],inputs:{titleLabel:"titleLabel",titleLabelShort:"titleLabelShort",collection:"collection"},ngContentSelectors:ye,decls:1,vars:1,consts:[["class","smallCollection",4,"ngIf"],[1,"smallCollection"],[1,"image"],[3,"src",4,"ngIf"],["class","icon",4,"ngIf"],[1,"right"],["class","title",4,"ngIf"],["class","title titleMobile",4,"ngIf"],[1,"scope",3,"node","item"],[3,"src"],[1,"icon"],[1,"material-icons"],[1,"title"],[1,"title","titleMobile"]],template:function(s,a){1&s&&(e.F$t(),e.YNc(0,Pe,10,11,"div",0)),2&s&&e.Q6J("ngIf",a.collection)},dependencies:[S.O5,l.ar,l.RQ,S.Ov,T.X$,l.PW],styles:[".smallCollection[_ngcontent-%COMP%]{display:flex;min-height:50px;width:100%;border-radius:10px}.smallCollection[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{background-color:var(--primary);border-top-right-radius:inherit;border-bottom-right-radius:inherit;padding:7px;display:flex;flex-grow:1;align-items:center;gap:10px;color:#fff}.smallCollection[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:13px;font-size:120%}.smallCollection[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   .scope[_ngcontent-%COMP%]{display:flex;align-items:center;flex-grow:1}.smallCollection[_ngcontent-%COMP%]   .image-icon[_ngcontent-%COMP%]{align-items:center;justify-content:center}.smallCollection[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{align-self:stretch;width:50px;display:flex;flex-shrink:0;border-top-left-radius:inherit;border-bottom-left-radius:inherit}.smallCollection[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#fff;width:40px;height:40px;border-radius:50%}.smallCollection[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:100%;border-top-left-radius:inherit;border-bottom-left-radius:inherit}.titleMobile[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]     es-list-collection-info{display:flex}[_nghost-%COMP%]     es-list-collection-info>i{font-size:18px}[_nghost-%COMP%]     es-list-collection-info>span{padding-left:5px}@media screen and (max-width: 700px){.title[_ngcontent-%COMP%]{display:none}.titleMobile[_ngcontent-%COMP%]{display:block}}"]})}return i})();const xe=function(i){return[i]};function Te(i,o){if(1&i&&(e.TgZ(0,"es-small-collection",5),e._UZ(1,"es-actionbar",6),e.qZA()),2&i){const t=o.ngIf;e.Q6J("collection",t.collection)("titleLabel","SEARCH.ADD_INTO_COLLECTION")("titleLabelShort","SEARCH.ADD_INTO_COLLECTION_SHORT"),e.xp6(1),e.Q6J("options",e.VKq(4,xe,t.customOptions.addOptions[0]))}}function Re(i,o){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" (",t.dataSource.getTotal(),") ")}}const Oe=function(){return[".."]};function Me(i,o){if(1&i&&(e.TgZ(0,"a",13),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"i",14),e.qZA()),2&i){const t=e.oxw(2).$implicit,s=e.oxw();e.Q6J("routerLink",e.DdM(5,Oe))("queryParams",s.getShowMoreQueryParams(t.id)),e.xp6(1),e.hij(" ",e.lcZ(2,3,"SHOW_MORE")," ")}}function Ie(i,o){if(1&i&&(e.TgZ(0,"div",9)(1,"h2",10),e._uU(2),e.ALo(3,"titlecase"),e.YNc(4,Re,2,1,"ng-container",11),e.qZA(),e.YNc(5,Me,4,6,"a",12),e.qZA()),2&i){const t=e.oxw().$implicit;e.oxw();const s=e.MAs(7);e.xp6(2),e.hij(" ",e.lcZ(3,4,t.title)," "),e.xp6(2),e.Q6J("ngIf",!t.dataSource.isLoading)("ngIfElse",s),e.xp6(1),e.Q6J("ngIf",t.dataSource.getTotal()>t.dataSource.getData().length)}}const Ae=function(){return{layout:"scroll"}},Ee=function(i){return{customOptions:i}};function Le(i,o){if(1&i&&(e.TgZ(0,"es-node-entries-wrapper",7),e.ALo(1,"async"),e.YNc(2,Ie,6,6,"ng-template",null,8,e.W1O),e.qZA()),2&i){const t=o.$implicit,s=e.oxw();e.ekj("display-none",t.dataSource.isEmpty()),e.Q6J("dataSource",t.dataSource)("scope",s.Scope.Search)("columns",e.lcZ(1,10,t.columns))("disableInfiniteScroll",!0)("displayType",s.NodeEntriesDisplayType.Grid)("gridConfig",e.DdM(12,Ae))("checkbox",!1)("initConfig",e.VKq(13,Ee,null==s.addToCollectionMode.value?null:s.addToCollectionMode.value.customOptions))}}function Fe(i,o){1&i&&e._UZ(0,"es-spinner")}function De(i,o){1&i&&(e.TgZ(0,"div",15),e._UZ(1,"i",16),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&i&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"SEARCH.QUERY_NO_RESULT"),"\n"))}function Ue(i,o){1&i&&e._UZ(0,"mat-spinner",17)}let Ve=(()=>{class i{constructor(t,s){this._searchPage=t,this._results=s,this.Scope=l.sX,this.NodeEntriesDisplayType=l.P8,this.repoData=this._results.repoData,this.loadingProgress=this._results.loadingProgress,this.addToCollectionMode=this._searchPage.addToCollectionMode,this.allEmpty=!1,this._searchString=this._searchPage.searchString,this._activeRepository=this._searchPage.activeRepository}ngOnInit(){setTimeout(()=>{this._searchPage.results=this._results,this._searchPage.showingAllRepositories.next(!0)}),this._registerAllEmpty()}getShowMoreQueryParams(t){return{...this._searchString.getQueryParamEntry(),...this._activeRepository.getQueryParamEntry(t)}}_registerAllEmpty(){this.loadingProgress.pipe((0,P.b)(0),(0,h.U)(t=>!(t<100)&&this.repoData.value.every(s=>s.dataSource.isEmpty()))).subscribe(t=>this.allEmpty=t)}static#e=this.\u0275fac=function(s){return new(s||i)(e.Y36(L),e.Y36($))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["es-search-page-results-all"]],features:[e._Bn([$])],decls:8,vars:8,consts:[["class","add-to-collection-banner",3,"collection","titleLabel","titleLabelShort",4,"ngIf"],["class","entries-wrapper",3,"display-none","dataSource","scope","columns","disableInfiniteScroll","displayType","gridConfig","checkbox","initConfig",4,"ngFor","ngForOf"],[4,"ngIf"],["class","no-search-results-message",4,"ngIf"],["smallLoadingSpinner",""],[1,"add-to-collection-banner",3,"collection","titleLabel","titleLabelShort"],["backgroundType","primary",3,"options"],[1,"entries-wrapper",3,"dataSource","scope","columns","disableInfiniteScroll","displayType","gridConfig","checkbox","initConfig"],["title",""],[1,"title-container"],[1,"mat-heading-2"],[4,"ngIf","ngIfElse"],["mat-button","",3,"routerLink","queryParams",4,"ngIf"],["mat-button","",3,"routerLink","queryParams"],["esIcon","keyboard_arrow_right"],[1,"no-search-results-message"],["esIcon","search"],["diameter","24",1,"small-progress-spinner"]],template:function(s,a){1&s&&(e.YNc(0,Te,2,6,"es-small-collection",0),e.YNc(1,Le,4,15,"es-node-entries-wrapper",1),e.ALo(2,"async"),e.YNc(3,Fe,1,0,"es-spinner",2),e.ALo(4,"async"),e.YNc(5,De,4,3,"div",3),e.YNc(6,Ue,1,0,"ng-template",null,4,e.W1O)),2&s&&(e.Q6J("ngIf",a.addToCollectionMode.value),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,4,a.repoData)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,6,a.loadingProgress)<100),e.xp6(2),e.Q6J("ngIf",a.allEmpty))},dependencies:[b.rH,S.sg,S.O5,l.nv,l.ar,l.OR,l.cE,V.zs,ee.Ou,se,S.Ov,S.rS,T.X$],styles:[".add-to-collection-banner[_ngcontent-%COMP%], .entries-wrapper[_ngcontent-%COMP%]{display:block;margin-top:1.5rem}.title-container[_ngcontent-%COMP%]{flex-grow:1;display:flex;align-items:center;gap:10px}.title-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{flex-grow:1;margin:1rem 0}.title-container[_ngcontent-%COMP%]   .small-progress-spinner[_ngcontent-%COMP%]{margin-left:12px}.no-search-results-message[_ngcontent-%COMP%]{color:#0000008a;text-align:center;padding:30px 0;font-size:120%}.no-search-results-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:60px;width:100%}"]})}return i})();var Q=r(88419),Ne=r(25705),we=r(53075),Ze=r(94760),I=r(46680),Be=r(16090);let ie=(()=>{class i{constructor(t,s,a,n,c,g){this._injector=t,this._mds=s,this._search=a,this._searchPage=n,this._searchPageRestore=c,this._translate=g,this.resultsDataSource=new M.hB(this._injector),this.totalResults=this.resultsDataSource.observeTotal(),this.collectionsDataSource=new M.hB(this._injector),this.resultColumns=new u.X([]),this.collectionColumns=new u.X([]),this.sortConfig=new u.X(null),this.loadingParams=new u.X(!0),this.loadingContent=new u.X(!0),this.loadingCollections=new u.X(!0),this.loadingProgress=new u.X(0),this.diffCount=new u.X(0),this._destroyed=new R.xQ,this._registerPageRestore(),this._registerSearchObservables(),this._registerColumnsAndSortConfig(),this._registerLoadingProgress(),this._registerResultDiffCount()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}addNodes(t){this.resultsDataSource.appendData(t,"before")}_registerPageRestore(){this._searchPageRestore.registerDataSource("materials",this.resultsDataSource),this._searchPageRestore.registerDataSource("collections",this.collectionsDataSource)}_registerSearchObservables(){const t=f.aj([this._searchPage.activeRepository.observeValue(),this._searchPage.activeMetadataSet.observeValue(),this._searchPage.searchFilters.observeValue(),this._searchPage.searchString.observeValue()]).pipe((0,d.R)(this._destroyed),(0,O.b)(()=>this.loadingParams.next(!0)),(0,P.b)(0),(0,p.h)(([a,n,c])=>(0,l.Nf)(a)&&(0,l.Nf)(n)&&(0,l.Nf)(c)),(0,v.w)(a=>this._searchPage.facetsToFetch.pipe((0,Q.P)(l.Nf),(0,h.U)(()=>a))),(0,O.b)(()=>this.loadingParams.next(!1)),(0,h.U)(([a,n,c,g])=>new W(a,n,c,g)),(0,C.x)((a,n)=>a.equals(n)),(0,Ne.B)()),s=t.pipe((0,h.U)(({repository:a,metadataSet:n,searchString:c})=>new W(a,n,{},c)),(0,C.x)((a,n)=>a.equals(n)));t.pipe((0,O.b)(()=>this.loadingContent.next(!0)),(0,h.U)(a=>this._getSearchRemote(a))).subscribe(a=>this.resultsDataSource.setRemote(a)),s.pipe((0,O.b)(()=>this.loadingCollections.next(!0)),(0,h.U)(a=>this._getCollectionsSearchRemote(a))).subscribe(a=>this.collectionsDataSource.setRemote(a)),this.resultsDataSource.isLoadingSubject.subscribe(a=>this.loadingContent.next(!!a)),this.collectionsDataSource.isLoadingSubject.subscribe(a=>this.loadingCollections.next(!!a))}_registerColumnsAndSortConfig(){const t=f.aj([this._searchPage.activeRepository.observeValue(),this._searchPage.activeMetadataSet.observeValue()]).pipe((0,d.R)(this._destroyed),(0,p.h)(([s,a])=>(0,l.Nf)(s)&&(0,l.Nf)(a)),(0,v.w)(([s,a])=>this._mds.getMetadataSet({repository:s,metadataSet:a})));t.pipe((0,h.U)(s=>E.h.getColumns(this._translate,s,"search"))).subscribe(this.resultColumns),t.pipe((0,h.U)(s=>E.h.getColumns(this._translate,s,"searchCollections"))).subscribe(this.collectionColumns),t.pipe((0,h.U)(s=>E.h.getSortInfo(s,"search"))).subscribe(s=>{this.sortConfig.next({allowed:!0,active:s.default.sortBy,direction:s.default.sortAscending?"asc":"desc",columns:s.columns?.map(({id:a,mode:n})=>new l.Sw("NODE",a,n))})})}_getSearchRemote(t){return s=>this._search.search({body:{criteria:this._getSearchCriteria(t),facetLimit:5,facetMinCount:1,resolveCollections:!1,resolveUsernames:!1,permissions:this._searchPage.reUrl.value?[I.u.ACCESS_CC_PUBLISH]:[]},maxItems:s.range.endIndex-s.range.startIndex,skipCount:s.range.startIndex,sortAscending:s.sort?["asc"===s.sort.direction]:null,sortProperties:s.sort?[s.sort.active]:null,contentType:"FILES",repository:t.repository,metadataset:t.metadataSet,query:I.u.DEFAULT_QUERY_NAME,propertyFilter:[I.u.ALL]}).pipe((0,O.b)(a=>{a.pagination.total<a.pagination.count&&console.warn("Total count of items is smaller than total, results might be truncated, check pagination results of api",a.pagination)}),(0,h.U)(M.CO))}_getCollectionsSearchRemote(t){return!this._searchPage.availableRepositories.value.find(({id:a})=>a===t.repository).isHomeRepo||this._searchPage.addToCollectionMode.value?(this.loadingCollections.next(!1),()=>w.of({data:[],total:0})):a=>this._search.requestSearch({body:{criteria:this._getSearchCriteria(t),facets:[]},sortProperties:[I.u.CCM_PROP_COLLECTION_PINNED_STATUS,I.u.CCM_PROP_COLLECTION_PINNED_ORDER,I.u.CM_MODIFIED_DATE],sortAscending:[!1,!0,!1],maxItems:a.range.endIndex-a.range.startIndex,skipCount:a.range.startIndex,contentType:"ALL",repository:t.repository,metadataset:t.metadataSet,query:I.u.QUERY_NAME_COLLECTIONS,propertyFilter:[I.u.ALL]}).pipe((0,h.U)(M.CO))}_getSearchCriteria(t){let s=Object.entries(t.searchFilters??{}).map(([a,n])=>({property:a,values:n}));return this.convertCriteria(s),t.searchString&&s.push({property:"ngsearchword",values:[t.searchString]}),s}_registerLoadingProgress(){f.aj([this.loadingParams,this.loadingContent,this.loadingCollections]).pipe((0,h.U)(([t,s,a])=>t?10:40+(s?0:30)+(a?0:30)),(0,P.b)(0),(0,C.x)()).subscribe(t=>this.loadingProgress.next(t))}_registerResultDiffCount(){this.resultsDataSource.connect().pipe((0,d.R)(this._destroyed),(0,p.h)(l.Nf),(0,h.U)(t=>t.length),(0,we.O)(0),(0,Ze.G)()).subscribe(([t,s])=>{this.diffCount.next(s-t)})}convertCriteria(t){for(const s of t){const a=this._searchPage.filtersMdsWidgets.value?.find(n=>n.definition.id===s.property)?.definition;if(a?.type===Be.Lz.MultiValueTree){let n=_.Pf.unfoldTreeChilds(s.values,a);n&&(n.length>m.Y6.MAX_QUERY_CONCAT_PARAMS?console.info("param "+s.property+" has too many unfold childs ("+n.length+"), falling back to basic prefix-based search"):s.values=s.values.concat(n))}}}static#e=this.\u0275fac=function(s){return new(s||i)(e.LFG(e.zs3),e.LFG(_.Pf),e.LFG(_.oD),e.LFG(L),e.LFG(z),e.LFG(T.sK))};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac})}return i})(),ae=(()=>{class i{constructor(){this.customTemplates=new u.X({})}static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Qe=r(4300),ne=r(92596);function Ye(i,o){1&i&&e.GkF(0,8)}function He(i,o){1&i&&(e.TgZ(0,"es-small-collection",9),e._UZ(1,"es-actionbar",10),e.qZA()),2&i&&e.Q6J("collection",o.ngIf.collection)("titleLabel","SEARCH.ADD_INTO_COLLECTION")("titleLabelShort","SEARCH.ADD_INTO_COLLECTION_SHORT")}function je(i,o){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" (",t.collectionsDataSource.getTotal(),") ")}}function Je(i,o){if(1&i&&(e.TgZ(0,"div",11)(1,"h2",12),e._uU(2),e.ALo(3,"translate"),e.YNc(4,je,2,1,"ng-container",13),e.qZA()()),2&i){const t=e.oxw(),s=e.MAs(13);e.xp6(2),e.hij(" ",e.lcZ(3,3,"SEARCH.COLLECTIONS")," "),e.xp6(2),e.Q6J("ngIf",!t.collectionsDataSource.isLoading)("ngIfElse",s)}}function Ge(i,o){if(1&i&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.qZA(),e.BQk()),2&i){const t=e.oxw(3);e.xp6(1),e.Gre("count ",t.getCountClass(),""),e.xp6(1),e.hij(" \xa0(",t.resultsDataSource.getTotal(),") ")}}function ke(i,o){if(1&i&&(e.ynx(0),e.YNc(1,Ge,3,4,"ng-container",15),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!t.resultsDataSource.isEmpty())}}function Xe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.toggleFilters())}),e.ALo(1,"translate"),e.ALo(2,"translate"),e._UZ(3,"i",17),e.TgZ(4,"span"),e._uU(5),e.ALo(6,"translate"),e.qZA()()}2&i&&(e.s9C("matTooltip",e.lcZ(2,5,"TOGGLE_SEARCH_FILTERS")),e.uIk("aria-label",e.lcZ(1,3,"SEARCH.FILTERS")),e.xp6(5),e.Oqu(e.lcZ(6,7,"SEARCH.FILTERS")))}function We(i,o){1&i&&e._UZ(0,"es-actionbar")}function Ke(i,o){if(1&i&&(e.TgZ(0,"div",11)(1,"h2",12),e._uU(2),e.ALo(3,"translate"),e.YNc(4,ke,2,1,"ng-container",13),e.qZA(),e.YNc(5,Xe,7,9,"button",14),e.YNc(6,We,1,0,"es-actionbar",15),e.qZA()),2&i){const t=e.oxw(),s=e.MAs(13),a=e.MAs(6);e.xp6(2),e.hij(" ",e.lcZ(3,5,"SEARCH.MATERIALS")," "),e.xp6(2),e.Q6J("ngIf",!t.resultsDataSource.isLoading)("ngIfElse",s),e.xp6(1),e.Q6J("ngIf",a.getSelection().isEmpty()),e.xp6(1),e.Q6J("ngIf",!t.addToCollectionMode.value)}}function ze(i,o){1&i&&(e.TgZ(0,"div",18),e._UZ(1,"i",19),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&i&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"SEARCH.QUERY_NO_RESULT")," "))}function $e(i,o){1&i&&e._UZ(0,"mat-spinner",20)}const qe=function(){return{layout:"scroll"}},et=function(i,o){return{actionbar:i,customOptions:o}};let tt=(()=>{class i{set _actionbar(t){setTimeout(()=>this.actionbar=t)}constructor(t,s,a,n,c,g){this.globalSearchPageInternal=t,this.results=s,this.searchPage=a,this.temporaryStorageService=n,this.announcer=c,this.translate=g,this.Scope=l.sX,this.NodeEntriesDisplayType=l.P8,this.destroyed=new R.xQ,this.resultsDataSource=this.results.resultsDataSource,this.collectionsDataSource=this.results.collectionsDataSource,this.resultColumns=this.results.resultColumns,this.collectionColumns=this.results.collectionColumns,this.sortConfig=this.results.sortConfig,this.addToCollectionMode=this.searchPage.addToCollectionMode,this.customTemplates=this.globalSearchPageInternal.customTemplates,s.diffCount.pipe((0,d.R)(this.destroyed),(0,v.w)(x=>this.translate.get("SEARCH.LOADED_RESULTS",{count:x}))).subscribe(x=>{this.announcer.announce(x)})}ngOnInit(){setTimeout(()=>{this.searchPage.results=this.results,this.searchPage.showingAllRepositories.next(!1)})}toggleFilters(){const t=this.searchPage.filterBarIsVisible;t.setUserValue(!t.getValue())}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete(),this.temporaryStorageService.set(l.xU.NODE_RENDER_PARAMETER_DATA_SOURCE,this.resultsDataSource)}getCountClass(){return this.searchPage.searchString.getValue()?"count-ngsearchword":""}static#e=this.\u0275fac=function(s){return new(s||i)(e.Y36(ae),e.Y36(ie),e.Y36(L),e.Y36(l.xU),e.Y36(Qe.Kd),e.Y36(T.sK))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["es-search-page-results"]],viewQuery:function(s,a){if(1&s&&e.Gf(l.nv,5),2&s){let n;e.iGM(n=e.CRH())&&(a._actionbar=n.first)}},features:[e._Bn([ie])],decls:14,vars:22,consts:[["xmlns","http://www.w3.org/1999/html",4,"ngTemplateOutlet"],["class","add-to-collection-banner",3,"collection","titleLabel","titleLabelShort",4,"ngIf"],[1,"entries-wrapper",3,"dataSource","scope","columns","disableInfiniteScroll","displayType","gridConfig"],["title",""],[1,"entries-wrapper",3,"dataSource","scope","columns","sort","primaryInstance","initConfig"],["nodeEntriesResults",""],["empty",""],["smallLoadingSpinner",""],["xmlns","http://www.w3.org/1999/html"],[1,"add-to-collection-banner",3,"collection","titleLabel","titleLabelShort"],["backgroundType","primary"],[1,"title-container"],[1,"mat-heading-2"],[4,"ngIf","ngIfElse"],["mat-flat-button","","color","primary","class","filters-button",3,"matTooltip","click",4,"ngIf"],[4,"ngIf"],["mat-flat-button","","color","primary",1,"filters-button",3,"matTooltip","click"],["esIcon","filter_list"],[1,"no-search-results-message"],["esIcon","search"],["diameter","24",1,"small-progress-spinner"]],template:function(s,a){1&s&&(e.YNc(0,Ye,1,0,"ng-container",0),e.YNc(1,He,2,3,"es-small-collection",1),e.TgZ(2,"es-node-entries-wrapper",2),e.YNc(3,Je,5,5,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(5,"es-node-entries-wrapper",4,5),e.ALo(7,"async"),e.YNc(8,Ke,7,7,"ng-template",null,3,e.W1O),e.YNc(10,ze,4,3,"ng-template",null,6,e.W1O),e.qZA(),e.YNc(12,$e,1,0,"ng-template",null,7,e.W1O)),2&s&&(e.Q6J("ngTemplateOutlet",a.customTemplates.value.resultsTop),e.xp6(1),e.Q6J("ngIf",a.addToCollectionMode.value),e.xp6(1),e.ekj("display-none",a.collectionsDataSource.isEmpty()),e.Q6J("dataSource",a.collectionsDataSource)("scope",a.Scope.SearchCollections)("columns",a.collectionColumns.value)("disableInfiniteScroll",!0)("displayType",a.NodeEntriesDisplayType.SmallGrid)("gridConfig",e.DdM(18,qe)),e.xp6(3),e.Q6J("dataSource",a.resultsDataSource)("scope",a.Scope.Search)("columns",a.resultColumns.value)("sort",e.lcZ(7,16,a.sortConfig))("primaryInstance",!0)("initConfig",e.WLB(19,et,a.actionbar,null==a.addToCollectionMode.value?null:a.addToCollectionMode.value.customOptions)))},dependencies:[S.O5,S.tP,ne.gM,l.nv,l.ar,l.cE,V.lW,ee.Ou,se,S.Ov,T.X$],styles:[".add-to-collection-banner[_ngcontent-%COMP%], .entries-wrapper[_ngcontent-%COMP%]{display:block;margin-top:1.5rem}.title-container[_ngcontent-%COMP%]{flex-grow:1;display:flex;align-items:center;gap:10px}.title-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{flex-grow:1;margin:1rem 0}.title-container[_ngcontent-%COMP%]   .small-progress-spinner[_ngcontent-%COMP%]{margin-left:12px}.no-search-results-message[_ngcontent-%COMP%]{color:#0000008a;text-align:center;padding:30px 0;font-size:120%}.no-search-results-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:60px;width:100%}@media (max-width: 600px){.filters-button[_ngcontent-%COMP%]{min-width:0;min-height:36px}.filters-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}}"]})}return i})();var Z=r(15861),F=r(86825),st=r(51418),it=r(19445),at=r(71088),re=r(36692),nt=r(16007),oe=r(32651),Y=r(74104),rt=r(66848),H=r(56223),ot=r(77504),j=r(24521),le=r(87548),lt=r(23680),ce=r(64170),ct=r(98525);function ht(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.openSavedSearchesDialog())}),e.ALo(1,"translate"),e._UZ(2,"i",5),e._uU(3),e.ALo(4,"translate"),e.qZA()}2&i&&(e.Q6J("matTooltip",e.lcZ(1,2,"SEARCH.SAVED_SEARCHES.TITLE")),e.xp6(3),e.hij(" ",e.lcZ(4,4,"SEARCH.SAVED_SEARCHES.TITLE"),"\n"))}function gt(i,o){if(1&i&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&i){const t=o.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function ut(i,o){if(1&i&&(e.TgZ(0,"mat-form-field",6)(1,"mat-label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-select",7),e.YNc(5,gt,2,2,"mat-option",8),e.ALo(6,"async"),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,3,"SEARCH.METADATASET")),e.xp6(2),e.Q6J("formControl",t.activeMdsForm),e.xp6(1),e.Q6J("ngForOf",e.lcZ(6,5,t.availableMetadataSets))}}function dt(i,o){if(1&i&&e._UZ(0,"es-mds-editor-wrapper",10),2&i){const t=e.oxw();e.Q6J("repository",t.mdsParams.repository)("setId",t.mdsParams.setId)("embedded",!0)("currentValues",t.searchFilterValues)("externalFilters",t.mdsExternalFilters)}}function pt(i,o){1&i&&e.GkF(0)}let mt=(()=>{class i{constructor(t,s,a,n,c,g,x){this.authentication=t,this.dialogs=s,this.globalSearchPageInternal=a,this.ngZone=n,this.searchPage=c,this.searchService=g,this.translate=x,this.activeRepository=this.searchPage.activeRepository,this.availableMetadataSets=this.searchPage.availableMetadataSets,this.activeMetadataSet=this.searchPage.activeMetadataSet,this.activeMdsForm=new H.p4(this.activeMetadataSet.getValue()),this.searchFilters=this.searchPage.searchFilters,this.reUrl=this.searchPage.reUrl,this.customTemplates=this.globalSearchPageInternal.customTemplates,this.mdsParams=null,this.savedSearchesButtonIsVisible=!1,this.mdsInitialized=!1,this.causedValueChange=!1,this.destroyed=new R.xQ}ngOnInit(){this.registerSearchFilterOverride(),this.activeMetadataSet.registerFormControl(this.activeMdsForm),this.registerMdsEditor(),this.searchFilters.observeUserValue().pipe((0,d.R)(this.destroyed)).subscribe(t=>{this.searchFilterValues=JSON.parse(JSON.stringify(t??{}))}),this.registerSavedSearches()}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}openSavedSearchesDialog(){var t=this;return(0,Z.Z)(function*(){(yield t.dialogs.openSavedSearchesDialog({saveSearchData:{name:yield t.getSavedSearchInitialName(),searchString:t.searchPage.searchString.getValue()},reUrl:t.reUrl.value||null})).afterClosed().subscribe(a=>{a&&t.applySavedSearch(a)})})()}applySavedSearch(t){this.searchPage.activeRepository.setUserValue(t.repository),this.searchPage.activeMetadataSet.setUserValue(t.metadataSet),this.searchPage.searchString.setUserValue(t.searchString),this.searchPage.searchFilters.setUserValue(t.filters)}getSavedSearchInitialName(){var t=this;return(0,Z.Z)(function*(){let s=[];if(t.activeRepository.getUserValue()){const c=t.searchPage.availableRepositories.value.find(({id:g})=>g===t.activeRepository.getUserValue());c&&s.push(c.title)}t.searchPage.searchString.getValue()&&s.push(`"${t.searchPage.searchString.getValue()}"`);const a=yield t.searchService.getFilters().toPromise(),n=Object.values(a).flat().map(({label:c})=>c);return s=[...s,...n],s.length>0?s.join(" - "):t.translate.get("SEARCH.SAVE_SEARCH.ALL_ITEMS").toPromise()})()}registerSearchFilterOverride(){B.T(this.activeRepository.observeValue(),this.activeMetadataSet.observeValue()).pipe((0,d.R)(this.destroyed)).subscribe(()=>{this.searchFilters.setOverrideValue(null)})}registerMdsEditor(){ot.D([this.activeRepository.observeValue().pipe((0,Q.P)(l.Nf)),this.activeMetadataSet.observeValue().pipe((0,Q.P)(l.Nf))]).pipe((0,O.b)(([t,s])=>this.mdsParams={repository:t,setId:s}),(0,K.g)(0),(0,d.R)(this.destroyed)).subscribe(()=>this.initMdsEditor()),this.searchPage.searchString.observeValue().pipe((0,d.R)(this.destroyed)).subscribe(t=>{this.mdsExternalFilters=t?{[m.u6.PRIMARY_SEARCH_CRITERIA]:[t]}:null})}registerSavedSearches(){this.authentication.observeLoginInfo().pipe((0,d.R)(this.destroyed),(0,h.U)(t=>t&&!t.isGuest)).subscribe(t=>this.savedSearchesButtonIsVisible=t)}initMdsEditor(){this.mdsEditor.mdsEditorInstance.values.pipe((0,d.R)(this.destroyed)).subscribe(t=>this.onMdsValuesChange(t)),this.mdsEditor.getInstanceService().widgets.pipe((0,d.R)(this.destroyed)).subscribe(t=>this.searchPage.filtersMdsWidgets.next(t)),B.T(this.activeMetadataSet.observeValue().pipe((0,p.h)(l.Nf),(0,j.T)(1)),this.activeRepository.observeValue().pipe((0,p.h)(l.Nf),(0,j.T)(1)),this.searchFilters.observeValue().pipe((0,p.h)(l.Nf),(0,j.T)(1),(0,p.h)(()=>!this.causedValueChange))).pipe((0,d.R)(this.destroyed),(0,P.b)(0),(0,p.h)(()=>(0,l.Nf)(this.activeMetadataSet.getValue()))).subscribe(()=>this.resetMds()),this.mdsEditor.mdsEditorInstance.getNeededFacets().pipe((0,d.R)(this.destroyed)).subscribe(t=>this.searchPage.facetsToFetch.next(t))}onMdsValuesChange(t){if(t=JSON.parse(JSON.stringify(t)),this.causedValueChange=!0,this.mdsInitialized){const s=function ft(i,o){const t={};for(const[s,a]of Object.entries(i))a.length>0&&JSON.stringify(o[s])!==JSON.stringify(a)&&(t[s]=a);return Object.keys(t).length>0?t:null}(t,this.defaultValues);this.searchFilters.setUserValue(s)}else{this.mdsInitialized=!0;const s=function _t(i,o){const t={};for(const[s,a]of Object.entries(i))s in o&&(t[s]=a);return Object.keys(t).length>0?t:null}(this.searchFilters.getUserValue()??{},t),a=this.getDefaultValues(t,s);this.defaultValues=a,this.searchFilters.setSystemValue(a),this.searchFilters.setUserValue(s),this.searchFilters.unsetOverrideValue()}this.ngZone.runOutsideAngular(()=>setTimeout(()=>this.causedValueChange=!1))}resetMds(){this.mdsParams={repository:this.activeRepository.getValue(),setId:this.activeMetadataSet.getValue()},this.mdsInitialized=!1,setTimeout(()=>{this.mdsEditor.reInit()})}getDefaultValues(t,s){const a={};for(const[n,c]of Object.entries(t))if(c.length>0&&!s?.[n]){const g=this.mdsEditor.mdsEditorInstance.getPrimaryWidget(n)?.definition;(!g||!0!==g.countDefaultvalueAsFilter)&&(a[n]=c)}return a}static#e=this.\u0275fac=function(s){return new(s||i)(e.Y36(_.$h),e.Y36(re.H),e.Y36(ae),e.Y36(e.R0b),e.Y36(L),e.Y36(_.oD),e.Y36(T.sK))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["es-search-page-filter-bar"]],viewQuery:function(s,a){if(1&s&&e.Gf(le.o,5),2&s){let n;e.iGM(n=e.CRH())&&(a.mdsEditor=n.first)}},decls:5,vars:6,consts:[["mat-stroked-button","","color","primary","class","saved-searches-button",3,"matTooltip","click",4,"ngIf"],["appearance","fill",4,"ngIf"],["class","mds-editor","groupId","ngsearch","mode","search",3,"repository","setId","embedded","currentValues","externalFilters",4,"ngIf"],[4,"ngTemplateOutlet"],["mat-stroked-button","","color","primary",1,"saved-searches-button",3,"matTooltip","click"],["esIcon","bookmark_outline"],["appearance","fill"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["groupId","ngsearch","mode","search",1,"mds-editor",3,"repository","setId","embedded","currentValues","externalFilters"]],template:function(s,a){if(1&s&&(e.YNc(0,ht,5,6,"button",0),e.YNc(1,ut,7,7,"mat-form-field",1),e.ALo(2,"async"),e.YNc(3,dt,1,5,"es-mds-editor-wrapper",2),e.YNc(4,pt,1,0,"ng-container",3)),2&s){let n;e.Q6J("ngIf",a.savedSearchesButtonIsVisible),e.xp6(1),e.Q6J("ngIf",(null==(n=e.lcZ(2,4,a.availableMetadataSets))?null:n.length)>1),e.xp6(2),e.Q6J("ngIf",a.mdsParams),e.xp6(1),e.Q6J("ngTemplateOutlet",a.customTemplates.value.filterBarBottom)}},dependencies:[S.sg,S.O5,S.tP,ne.gM,l.ar,H.JJ,lt.ey,V.lW,ce.KE,ce.hX,ct.gD,H.oH,le.o,S.Ov,T.X$],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column}.saved-searches-button[_ngcontent-%COMP%]{margin-bottom:20px}.mds-editor[_ngcontent-%COMP%]{flex-grow:1}"]})}return i})();var St=r(76754);let vt=(()=>{class i{constructor(t){this.nodeHelper=t}transform(t){return this.nodeHelper.getSourceIconRepoPath(t)}static#e=this.\u0275fac=function(s){return new(s||i)(e.Y36(St.G,16))};static#t=this.\u0275pipe=e.Yjl({name:"repositoryIcon",type:i,pure:!0})}return i})();const bt=["filtersDialogResetButton"],Ct=["filtersDialogContent"],Pt=function(){return["./all"]};function yt(i,o){if(1&i&&(e.TgZ(0,"a",11,12),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&i){const t=e.MAs(1),s=e.oxw(2);e.Q6J("routerLink",e.DdM(6,Pt))("queryParams",s.queryParamsAllRepositories)("active",t.isActive),e.xp6(2),e.hij(" ",e.lcZ(3,4,"SEARCH.REPOSITORY_ALL")," ")}}function xt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"a",13),e.NdJ("click",function(){const n=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.goToRepository(n))}),e.TgZ(1,"div",14),e._UZ(2,"img",15),e.ALo(3,"repositoryIcon"),e.qZA(),e._uU(4),e.qZA()}if(2&i){const t=o.$implicit,s=e.oxw(2);e.Q6J("active",t.id===s.activeRepository.getValue()),e.xp6(2),e.Q6J("src",e.lcZ(3,3,t),e.LSH),e.xp6(2),e.hij(" ",t.title," ")}}function Tt(i,o){1&i&&e.GkF(0)}function Rt(i,o){if(1&i&&(e.ynx(0),e.TgZ(1,"nav",6),e.YNc(2,yt,4,7,"a",7),e.YNc(3,xt,5,5,"a",8),e.qZA(),e.TgZ(4,"mat-tab-nav-panel",null,9),e.YNc(6,Tt,1,0,"ng-container",10),e.qZA(),e.BQk()),2&i){const t=e.MAs(5),s=e.oxw(),a=e.MAs(8);e.xp6(1),e.Q6J("tabPanel",t),e.xp6(1),e.Q6J("ngIf",s.availableRepositories.getValue().length>1),e.xp6(1),e.Q6J("ngForOf",s.availableRepositories.getValue()),e.xp6(3),e.Q6J("ngTemplateOutlet",a)}}function Ot(i,o){1&i&&e.GkF(0)}function Mt(i,o){if(1&i&&(e.ynx(0),e.YNc(1,Ot,1,0,"ng-container",10),e.BQk()),2&i){e.oxw();const t=e.MAs(8);e.xp6(1),e.Q6J("ngTemplateOutlet",t)}}function It(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.searchFilters.setUserValue(null))}),e._UZ(1,"i",26),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&i&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"CLEAR_FILTERS")," "))}function At(i,o){1&i&&e._UZ(0,"es-search-page-filter-bar")}function Et(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"mat-drawer-container",null,16)(2,"mat-drawer",17),e.ALo(3,"async"),e.TgZ(4,"div",18)(5,"div",19)(6,"h2",20),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.YNc(9,It,4,3,"button",21),e.TgZ(10,"button",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.filterBarIsVisible.setUserValue(!1))}),e._UZ(11,"i",23),e.qZA()(),e.TgZ(12,"div",24),e.YNc(13,At,1,0,"es-search-page-filter-bar",2),e.ALo(14,"async"),e.qZA()()(),e.TgZ(15,"main"),e._UZ(16,"router-outlet"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("opened",t.filterBarIsVisible.getValue()&&!1===e.lcZ(3,5,t.isMobileScreen)),e.xp6(5),e.Oqu(e.lcZ(8,7,"SEARCH.FILTERS")),e.xp6(2),e.Q6J("ngIf",t.searchFilters.getUserValue()),e.xp6(2),e.Q6J("aria",!0),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(14,9,t.showingAllRepositories))}}function Lt(i,o){1&i&&e._UZ(0,"es-search-page-filter-bar",27)}function Ft(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.searchFilters.setUserValue(null))}),e._UZ(1,"i",26),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&i&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"CLEAR_FILTERS")," "))}function Dt(i,o){if(1&i&&e.YNc(0,Ft,4,3,"button",21),2&i){const t=e.oxw();e.Q6J("ngIf",t.searchFilters.getUserValue())}}const Ut=function(i){return{progress:i}},Vt=[{path:"",component:(()=>{class i{constructor(t,s,a,n,c,g,x,N,y){this.breadcrumbsService=t,this.breakpointObserver=s,this.dialogs=a,this.mainNav=n,this.navigationScheduler=c,this.route=g,this.searchPage=x,this.configService=N,this.translate=y,this.Scope=l.sX,this.tabBarIsVisible=null,this.progressBarIsVisible=!1,this.availableRepositories=this.searchPage.availableRepositories,this.activeRepository=this.searchPage.activeRepository,this.showingAllRepositories=this.searchPage.showingAllRepositories,this.filterBarIsVisible=this.searchPage.filterBarIsVisible,this.searchString=this.searchPage.searchString,this.searchFilters=this.searchPage.searchFilters,this.loadingProgress=this.searchPage.loadingProgress,this.isMobileScreen=this.getIsMobileScreen(),this.destroyed=new R.xQ,this.searchPage.init()}ngOnInit(){this.initMainNav(),this.breadcrumbsService.setNodePath(null),this.availableRepositories.pipe((0,p.h)(l.Nf),(0,h.U)(t=>t.length>1)).subscribe(t=>this.tabBarIsVisible=t),this.registerProgressBarIsVisible(),this.registerFilterDialog(),this.registerQueryParamsAllRepositories(),this.registerConfigBehaviours()}registerConfigBehaviours(){(0,f.aj)([this.configService.observeConfig({forceUpdate:!1}),this.isMobileScreen]).pipe((0,st.q)(1)).subscribe(([t,s])=>{("always"===t?.searchSidenavMode||"auto"===t?.searchSidenavMode&&!s)&&this.filterBarIsVisible.setSystemValue(!0)})}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete()}goToRepository(t){this.activeRepository.setUserValue(t.id),this.navigationScheduler.scheduleNavigation({route:[m.ru.ROUTER_PREFIX,"search"]})}registerFilterDialog(){var t=this;let s,a;f.aj([this.searchPage.filterBarIsVisible.observeValue().pipe(),this.isMobileScreen.pipe((0,O.b)(n=>a=n))]).pipe((0,d.R)(this.destroyed)).subscribe(function(){var n=(0,Z.Z)(function*([c]){a&&c&&!s?(s=t.openFilterDialog(),(yield s).afterClosed().subscribe(()=>{s=null,a&&t.filterBarIsVisible.setUserValue(!1)})):(!a||!c)&&s?.then(g=>g.close())});return function(c){return n.apply(this,arguments)}}())}registerQueryParamsAllRepositories(){f.aj([this.route.queryParams,this.searchString.observeQueryParamEntry()]).pipe((0,d.R)(this.destroyed),(0,h.U)(([t,s])=>({addToCollection:t.addToCollection,...s}))).subscribe(t=>this.queryParamsAllRepositories=t)}openFilterDialog(){var t=this;return(0,Z.Z)(function*(){const s=yield t.dialogs.openGenericDialog({title:"SEARCH.FILTERS",contentTemplate:t.filtersDialogContent,minWidth:350,customHeaderBarContent:t.filtersDialogResetButton});return t.searchPage.results.totalResults.pipe((0,v.w)(a=>t.translate.get("SEARCH.NUMBER_RESULTS",{results:a})),(0,d.R)(s.afterClosed())).subscribe(a=>{s.patchConfig({subtitle:a.toString()})}),s})()}getIsMobileScreen(){return this.breakpointObserver.observe(["(max-width: 900px)"]).pipe((0,h.U)(({matches:t})=>t))}initMainNav(){this.mainNav.setMainNavConfig({title:"SEARCH.TITLE",currentScope:"search",canOpen:!0,onCreate:s=>this.searchPage.results.addNodes(s)}),f.aj([this.availableRepositories,this.activeRepository.observeValue()]).pipe((0,p.h)(([s,a])=>(0,l.Nf)(s)&&(0,l.Nf)(a)),(0,h.U)(([s,a])=>a===m.u6.HOME_REPOSITORY||s.find(n=>n.id===a).isHomeRepo)).subscribe(s=>this.mainNav.patchMainNavConfig({create:{allowed:s,allowBinary:!0}}))}onProgressBarAnimationEnd(){this.searchPage.loadingProgress.value>=100&&(this.progressBarIsVisible=!1)}registerProgressBarIsVisible(){this.searchPage.loadingProgress.pipe((0,p.h)(t=>t<100)).subscribe(()=>this.progressBarIsVisible=!0)}static#e=this.\u0275fac=function(s){return new(s||i)(e.Y36(it.d),e.Y36(at.Yg),e.Y36(re.H),e.Y36(k.ZF),e.Y36(X.t),e.Y36(b.gz),e.Y36(L),e.Y36(_.E4),e.Y36(T.sK))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["es-search-page"]],viewQuery:function(s,a){if(1&s&&(e.Gf(bt,7),e.Gf(Ct,7)),2&s){let n;e.iGM(n=e.CRH())&&(a.filtersDialogResetButton=n.first),e.iGM(n=e.CRH())&&(a.filtersDialogContent=n.first)}},hostVars:2,hostBindings:function(s,a){2&s&&e.ekj("has-tab-bar",a.tabBarIsVisible)},features:[e._Bn([L])],decls:13,vars:13,consts:[["esTitle","",1,"cdk-visually-hidden"],["mode","determinate",3,"value","animationEnd"],[4,"ngIf"],["tabBody",""],["filtersDialogContent",""],["filtersDialogResetButton",""],["mat-tab-nav-bar","",3,"tabPanel"],["mat-tab-link","","routerLinkActive","",3,"routerLink","queryParams","active",4,"ngIf"],["mat-tab-link","",3,"active","click",4,"ngFor","ngForOf"],["tabPanel",""],[4,"ngTemplateOutlet"],["mat-tab-link","","routerLinkActive","",3,"routerLink","queryParams","active"],["routerLinkActive","routerLinkActive"],["mat-tab-link","",3,"active","click"],[1,"repository-icon"],["alt","",3,"src"],["filterBar",""],["mode","side",3,"opened"],[1,"filter-bar-container"],[1,"filter-bar-heading"],[1,"filter-bar-title"],["mat-button","",3,"click",4,"ngIf"],["mat-icon-button","",1,"filter-bar-close-button",3,"click"],["esIcon","close",3,"aria"],[1,"filter-bar-body"],["mat-button","",3,"click"],["esIcon","undo"],[1,"filters-dialog-content"]],template:function(s,a){1&s&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"mat-progress-bar",1),e.NdJ("animationEnd",function(){return a.onProgressBarAnimationEnd()}),e.ALo(4,"translate"),e.qZA(),e.YNc(5,Rt,7,4,"ng-container",2),e.YNc(6,Mt,2,1,"ng-container",2),e.YNc(7,Et,17,11,"ng-template",null,3,e.W1O),e.YNc(9,Lt,1,0,"ng-template",null,4,e.W1O),e.YNc(11,Dt,1,1,"ng-template",null,5,e.W1O)),2&s&&(e.xp6(1),e.Oqu(e.lcZ(2,6,"SEARCH.TITLE")),e.xp6(2),e.Q6J("value",a.progressBarIsVisible?a.loadingProgress.value:0)("@fadeOut",a.progressBarIsVisible?"visible":"hidden"),e.uIk("aria-label",a.progressBarIsVisible?e.xi3(4,8,"SEARCH.LOADING_RESULTS",e.VKq(11,Ut,a.progressBarIsVisible?a.loadingProgress.value:0)):""),e.xp6(2),e.Q6J("ngIf",a.tabBarIsVisible),e.xp6(1),e.Q6J("ngIf",!1===a.tabBarIsVisible))},dependencies:[b.lC,b.rH,b.Od,S.sg,S.O5,S.tP,l.ar,V.lW,V.RK,nt.pW,oe.jA,oe.kh,Y.BU,Y.sW,Y.Nj,rt.M,mt,S.Ov,T.X$,vt],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;min-height:calc(100vh - var(--mainnavHeight))}mat-progress-bar[_ngcontent-%COMP%]{position:sticky;top:var(--mainnavCurrentHeight);flex-shrink:0;transition:unset;z-index:2}.mat-tab-label-active[_ngcontent-%COMP%]{opacity:1}.repository-icon[_ngcontent-%COMP%]{margin-right:12px;display:flex;align-items:center;justify-content:center;background-color:#00000003;border:1px solid rgba(0,0,0,.03);border-radius:50px;height:32px;width:32px;flex-shrink:0}.repository-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{background-color:#fff;height:20px;width:20px;border-radius:2px}mat-tab-nav-panel[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;min-height:0}.mat-drawer-container[_ngcontent-%COMP%]{flex-grow:1;background-color:unset}.filter-bar-container[_ngcontent-%COMP%]{width:300px;height:100%;display:flex;flex-direction:column}.filter-bar-heading[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 20px;height:60px;border-bottom:1px solid var(--mat-divider-color)}.filter-bar-heading[_ngcontent-%COMP%]   .filter-bar-title[_ngcontent-%COMP%]{flex-grow:1;font-size:180%;font-weight:400;margin:0}.filter-bar-heading[_ngcontent-%COMP%]   .filter-bar-close-button[_ngcontent-%COMP%]{margin-right:-10px;flex-shrink:0}.filter-bar-body[_ngcontent-%COMP%]{flex-grow:1;overflow:auto;--container-padding: 20px;padding:var(--container-padding)}.filters-dialog-content[_ngcontent-%COMP%]{flex-grow:1}main[_ngcontent-%COMP%]{padding:0 25px 25px}.entries-wrapper[_ngcontent-%COMP%]{display:block;margin-top:1.5rem}.title-container[_ngcontent-%COMP%]{flex-grow:1;display:flex;align-items:center;gap:10px}.title-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{flex-grow:1;margin:1rem 0}.title-container[_ngcontent-%COMP%]   .small-progress-spinner[_ngcontent-%COMP%]{margin-left:12px}"],data:{animation:[(0,F.X$)("fadeOut",[(0,F.SB)("visible",(0,F.oB)({opacity:1})),(0,F.SB)("hidden",(0,F.oB)({opacity:0})),(0,F.eR)("visible => hidden",[(0,F.jt)(l.Le.ANIMATION_TIME_NORMAL)])])]}})}return i})(),children:[{path:"",component:tt},{path:"all",component:Ve}]}];let Nt=(()=>{class i{static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275mod=e.oAB({type:i});static#s=this.\u0275inj=e.cJS({imports:[b.Bz.forChild(Vt),b.Bz]})}return i})(),wt=(()=>{class i{static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275mod=e.oAB({type:i});static#s=this.\u0275inj=e.cJS({imports:[Nt,U.m,l.yF,A.x]})}return i})()},19445:(G,D,r)=>{r.d(D,{d:()=>b});var A=r(45125),U=r(65879);let b=(()=>{class P{constructor(){this.breadcrumbs$=new A.X([])}setNodePath(f){this.breadcrumbs$.next(f)}static#e=this.\u0275fac=function(u){return new(u||P)};static#t=this.\u0275prov=U.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})()},66848:(G,D,r)=>{r.d(D,{M:()=>d});var A=r(72079),U=r(12994),b=r(77504),P=r(96124),h=r(65879),f=r(6593),u=r(52081),R=r(81771);let d=(()=>{class v{constructor(C,m,E,M){this.elementRef=C,this.documentTitle=m,this.translations=E,this.pageHeading=new A.xQ,this.titleOverride=new A.xQ,this.pageTitle=new A.xQ,this.mutationObserver=new MutationObserver(()=>this.updatePageHeading()),this.mutationObserver.observe(this.elementRef.nativeElement,{characterData:!0,subtree:!0}),(0,U.aj)([this.pageHeading,this.titleOverride]).pipe((0,P.U)(([e,_])=>_??e)).subscribe(this.pageTitle),(0,U.aj)([(0,b.D)({branding:M.get("branding"),siteTitle:M.get("siteTitle","edu-sharing")}),this.pageTitle,this.translations.waitForInit()]).subscribe(([e,_])=>this.updateTitle(e,_))}ngOnChanges(C){if(C.esTitle){const m=C.esTitle.currentValue;this.titleOverride.next(""===m?null:m??"")}}ngOnInit(){this.updatePageHeading()}ngOnDestroy(){this.mutationObserver.disconnect()}updatePageHeading(){this.pageHeading.next(this.elementRef.nativeElement.textContent)}updateTitle(C,m){this.documentTitle.setTitle(m?C.branding?m+" - "+C.siteTitle:m:C.siteTitle)}static#e=this.\u0275fac=function(m){return new(m||v)(h.Y36(h.SBq),h.Y36(f.Dx),h.Y36(u.fA),h.Y36(R.eB))};static#t=this.\u0275dir=h.lG2({type:v,selectors:[["","esTitle",""]],inputs:{esTitle:"esTitle"},features:[h.TTD]})}return v})()}}]);