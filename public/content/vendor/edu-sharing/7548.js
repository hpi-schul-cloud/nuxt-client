"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[7548],{87548:(P,m,i)=>{i.d(m,{o:()=>S});var a=i(15861),t=i(65879),g=i(49193),h=i(72079),f=i(88419),v=i(19352),y=i(75222),I=i(96124),u=i(81771),p=i(84019),l=i(96931),c=i(16090),b=i(1189),T=i(48098),_=i(96814),M=i(52081),x=i(94618),w=i(42068);let N=(()=>{class o{constructor(e){this.mdsEditorInstance=e,this.mdsEditorInstance.isEmbedded=!0}ngOnInit(){}static#e=this.\u0275fac=function(n){return new(n||o)(t.Y36(l.t))};static#t=this.\u0275cmp=t.Xpm({type:o,selectors:[["es-mds-editor-embedded"]],decls:1,vars:0,template:function(n,s){1&n&&t._UZ(0,"es-mds-editor-core")},dependencies:[w._],styles:["es-mds-editor-core[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]     es-mds-editor-core .extended-toggle-container{margin-bottom:10px}"]})}return o})();function R(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"es-mds",2),t.NdJ("extendedChange",function(s){t.CHM(e);const d=t.oxw();return t.KtG(d.extendedChange.emit(s))})("onCancel",function(s){t.CHM(e);const d=t.oxw();return t.KtG(d.onCancel.emit(s))})("onDone",function(s){t.CHM(e);const d=t.oxw();return t.KtG(d.onDone.emit(s))})("onMdsLoaded",function(s){t.CHM(e);const d=t.oxw();return t.KtG(d.onMdsLoaded.emit(s))})("openContributor",function(s){t.CHM(e);const d=t.oxw();return t.KtG(d.openContributor.emit(s))})("openLicense",function(s){t.CHM(e);const d=t.oxw();return t.KtG(d.openLicense.emit(s))})("openTemplate",function(s){t.CHM(e);const d=t.oxw();return t.KtG(d.openTemplate.emit(s))}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("addWidget",e.addWidget)("allowReplacing",e.allowReplacing)("bulkBehaviour",e.bulkBehaviour)("create",e.create)("currentValues",e.currentValues)("customTitle",e.customTitle)("embedded",e.embedded)("extended",e.extended)("groupId",e.groupId)("invalidate",e.invalidate)("labelNegative",e.labelNegative)("labelPositive",e.labelPositive)("mode",e.mode)("nodes",e.nodes)("parentNode",e.parentNode)("priority",e.priority)("repository",e.repository)("setId",e.setId)("suggestions",e.legacySuggestions)}}function W(o,r){1&o&&t._UZ(0,"es-mds-editor-embedded")}function L(o,r){1&o&&t._UZ(0,"es-spinner")}function O(o,r){1&o&&t._UZ(0,"es-global-progress")}let S=(()=>{class o{set externalFilters(e){this.mdsEditorInstance.externalFilters=e}constructor(e,n,s){this.mdsEditorInstance=e,this.toast=n,this.search=s,this.addWidget=!1,this.allowReplacing=!0,this.bulkBehaviour=c.B1.Default,this.embedded=!1,this.extended=!1,this.labelNegative="CANCEL",this.labelPositive="SAVE",this.toastOnSave="WORKSPACE.EDITOR.UPDATED",this.mode="default",this.priority=1,this.repository=u.u6.HOME_REPOSITORY,this.extendedChange=new t.vpe,this.onCancel=new t.vpe,this.onDone=new t.vpe,this.onMdsLoaded=new t.vpe,this.openContributor=new t.vpe,this.openLicense=new t.vpe,this.openTemplate=new t.vpe,this.isLoading=!0,this.legacySuggestionsRegistered=!1,this.destroyed$=new h.xQ}getInstanceService(){return this.mdsEditorInstance}ngOnInit(){if((this.graphqlIds||this.nodes||this.currentValues)&&this.init(),this.mdsEditorInstance.values.subscribe(e=>this.values=e),!this.embedded)throw new Error("Non-embedded use of mds-editor-wrapper has been deprecated in favor of mds-editor-dialog. Please migrate.")}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}handleKeyboardEvent(e){switch(this.editorType){case"legacy":return this.mdsRef.handleKeyboardEvent(e);case"angular":return!0;default:return console.warn("handleKeyboardEvent() was called before init finished"),null}}getValues(e=null){var n=this;return(0,a.Z)(function*(){switch(n.editorType){case"legacy":return n.mdsRef.getValues(e?.properties);case"angular":return n.mdsEditorInstance.getValues(e);default:return console.warn("getValues() was called before init finished"),null}})()}saveValues(){var e=this;return(0,a.Z)(function*(){switch(e.editorType){case"legacy":return e.mdsRef.saveValues();case"angular":const n=yield e.mdsEditorInstance.getValues();return e.onDone.emit(n),n;default:return console.warn("saveValues() was called before init finished"),null}})()}get currentWidgets(){switch(this.editorType){case"legacy":return this.mdsRef.currentWidgets;case"angular":return this.mdsEditorInstance.widgets.value.map(e=>e.definition);default:return console.warn("get currentWidgets() was called before init finished"),null}}loadMds(e=!1){setTimeout(()=>{"angular"===this.editorType&&this.groupId===this.mdsEditorInstance.groupId&&this.setId===this.mdsEditorInstance.mdsId&&this.repository===this.mdsEditorInstance.repository&&function E(o,r){return o??={},r??={},Array.from(new Set([...Object.keys(o),...Object.keys(r)])).every(n=>function C(o=[],r=[]){return o.every(e=>r.includes(e))&&r.every(e=>o.includes(e))}(o[n],r[n]))}(this.currentValues,this.values)?this.loadMdsAfterInit(e):this.init().then(()=>{this.loadMdsAfterInit(e)})})}loadMdsAfterInit(e){switch(this.editorType){case"legacy":return void setTimeout(()=>this.mdsRef.loadMds());case"angular":if(e)return;this.mdsEditorInstance.mdsDefinition$.pipe((0,f.P)(n=>null!==n)).subscribe(n=>this.onMdsLoaded.emit(n))}}onSave(){var e=this;return(0,a.Z)(function*(){e.isLoading=!0;try{if(!e.mdsEditorInstance.getCanSave())return e.mdsEditorInstance.getIsValid()?void e.onDone.emit(e.nodes):(console.warn("The following widgets are required but don't have a value: ",e.mdsEditorInstance.getCompletitonStatus().mandatory.fields.filter(s=>!s.isCompleted).map(s=>s.widget.definition.id)),void e.mdsEditorInstance.showMissingRequiredWidgets());const n=yield e.mdsEditorInstance.save();e.toastOnSave&&e.toast.toast(e.toastOnSave),e.onDone.emit(n)}catch(n){n?.error?.error?.endsWith(u.u6.CONTENT_FILE_EXTENSION_VERIFICATION_EXCEPTION)?e.handleError(new c.Zp("MDS.ERROR_FILE_EXTENSION_VERIFICATION_EXCEPTION")):e.handleError(n)}finally{e.isLoading=!1}})()}reInit(){var e=this;return(0,a.Z)(function*(){return e.init()})()}init(){var e=this;return(0,a.Z)(function*(){e.mdsEditorInstance.mdsInflatedValue&&e.mdsEditorInstance.mdsInflated.next(!1),e.isLoading=!0;try{const n={groupId:e.groupId,bulkBehavior:e.bulkBehaviour,editorMode:e.editorMode??"nodes"};if(e.nodes)e.editorType=yield e.mdsEditorInstance.initWithNodes(e.nodes,n);else try{e.editorType=yield e.mdsEditorInstance.initWithoutNodes(e.groupId,e.setId,e.repository,e.editorMode??"search",e.currentValues)}catch{return}e.editorType||(console.warn(`mds ${e.setId} at ${e.repository} did not specify any rendering type (group ${e.groupId})`),e.editorType="legacy"),"legacy"===e.editorType&&console.warn(`mds ${e.setId} at ${e.repository} is configured for legacy rendering`),"legacy"===e.editorType&&!e.legacySuggestionsRegistered&&(e.registerLegacySuggestions(),e.legacySuggestionsRegistered=!0)}catch(n){e.handleError(n)}finally{e.isLoading=!1}})()}registerLegacySuggestions(){this.mdsEditorInstance.getNeededFacets().pipe((0,v.R)(this.destroyed$),(0,y.w)(e=>e?this.search.observeFacets(e):g.of({})),(0,I.U)(e=>e?Object.entries(e).reduce((n,[s,d])=>(n[s]=d.values.map(({value:V,label:D})=>({id:V,caption:D})),n),{}):null)).subscribe(e=>this.legacySuggestions=e)}handleError(e){console.error(e),e instanceof c.Zp?this.toast.error(null,e.message):this.toast.error(e),this.onCancel.emit()}static#e=this.\u0275fac=function(n){return new(n||o)(t.Y36(l.t),t.Y36(b.F),t.Y36(T.oD))};static#t=this.\u0275cmp=t.Xpm({type:o,selectors:[["es-mds-editor-wrapper"]],viewQuery:function(n,s){if(1&n&&t.Gf(p.A,5),2&n){let d;t.iGM(d=t.CRH())&&(s.mdsRef=d.first)}},inputs:{addWidget:"addWidget",allowReplacing:"allowReplacing",bulkBehaviour:"bulkBehaviour",create:"create",currentValues:"currentValues",customTitle:"customTitle",embedded:"embedded",extended:"extended",groupId:"groupId",invalidate:"invalidate",labelNegative:"labelNegative",labelPositive:"labelPositive",toastOnSave:"toastOnSave",mode:"mode",nodes:"nodes",graphqlIds:"graphqlIds",parentNode:"parentNode",priority:"priority",repository:"repository",editorMode:"editorMode",setId:"setId",externalFilters:"externalFilters"},outputs:{extendedChange:"extendedChange",onCancel:"onCancel",onDone:"onDone",onMdsLoaded:"onMdsLoaded",openContributor:"openContributor",openLicense:"openLicense",openTemplate:"openTemplate"},features:[t._Bn([l.t])],decls:4,vars:4,consts:[[3,"addWidget","allowReplacing","bulkBehaviour","create","currentValues","customTitle","embedded","extended","groupId","invalidate","labelNegative","labelPositive","mode","nodes","parentNode","priority","repository","setId","suggestions","extendedChange","onCancel","onDone","onMdsLoaded","openContributor","openLicense","openTemplate",4,"ngIf"],[4,"ngIf"],[3,"addWidget","allowReplacing","bulkBehaviour","create","currentValues","customTitle","embedded","extended","groupId","invalidate","labelNegative","labelPositive","mode","nodes","parentNode","priority","repository","setId","suggestions","extendedChange","onCancel","onDone","onMdsLoaded","openContributor","openLicense","openTemplate"]],template:function(n,s){1&n&&(t.YNc(0,R,1,19,"es-mds",0),t.YNc(1,W,1,0,"es-mds-editor-embedded",1),t.YNc(2,L,1,0,"es-spinner",1),t.YNc(3,O,1,0,"es-global-progress",1)),2&n&&(t.Q6J("ngIf","legacy"===s.editorType),t.xp6(1),t.Q6J("ngIf","angular"===s.editorType&&s.embedded),t.xp6(1),t.Q6J("ngIf",s.isLoading&&s.embedded),t.xp6(1),t.Q6J("ngIf",s.isLoading&&!s.embedded))},dependencies:[_.O5,M.OR,x.d,p.A,N]})}return o})()}}]);