"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[4393],{74393:(Q,c,a)=>{a.r(c),a.d(c,{NodeReportDialogComponent:()=>S,NodeReportDialogModule:()=>b});var A=a(50555),f=a(86825),i=a(56223),h=a(88419),N=a(97734),v=a(51418),l=a(81771),p=a(53461),m=a(52081),T=a(77504),t=a(65879),C=a(91486),g=a(48098),u=a(71365),D=a(1189),R=a(96814),d=a(64170),L=a(24516),P=a(56263),E=a(87466);const Z=["formElement"];function x(n,O){if(1&n&&(t.TgZ(0,"mat-radio-button",9),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const o=O.$implicit,e=t.oxw();t.Q6J("value",o)("aria-describedby",e.shouldShowError("reason")?"node-report-reason-error":null),t.xp6(1),t.Oqu(t.lcZ(2,3,"NODE_REPORT.REASONS."+o))}}function I(n,O){1&n&&(t.TgZ(0,"mat-error",10),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NODE_REPORT.REASON_REQUIRED")," "))}const M=function(n){return{name:n}};let S=(()=>{class n{constructor(o,e,r,s,y,U,Y,J){this.data=o,this.dialogRef=e,this.authenticationService=r,this.userService=s,this.translate=y,this.toast=U,this.nodeApi=Y,this.cdr=J,this.reasons=["UNAVAILABLE","INAPPROPRIATE_CONTENT","INVALID_METADATA","OTHER"],this.form=new i.nJ({reason:new i.p4("",i.kI.required),comment:new i.p4(""),email:new i.p4("",[i.kI.email,i.kI.required])})}ngOnInit(){this.dialogRef.patchConfig({buttons:[new l.Qd("CANCEL",{color:"standard"},()=>this.cancel()),new l.Qd("NODE_REPORT.REPORT",{color:"primary"},()=>this.report())]}),(0,T.D)(this.authenticationService.observeLoginInfo().pipe((0,h.P)()),this.userService.observeCurrentUser().pipe((0,h.P)())).subscribe(([o,e])=>{!o.isGuest&&e?.person?.profile?.email&&(this.form.get("email").disable(),this.form.patchValue({email:e.person.profile.email}))}),this.form.valueChanges.pipe((0,N.h)(o=>Object.values(o).some(e=>!!e)),(0,v.q)(1)).subscribe(()=>this.dialogRef.patchConfig({closable:p.IA.Standard}))}cancel(){this.dialogRef.close()}shouldShowError(o){const e=this.form.get(o);return!e.disabled&&e.touched&&!e.valid}report(){if(this.form.valid){const o=this.form.getRawValue();this.setLoading(!0),this.nodeApi.reportNode(this.data.node.ref.id,this.getReasonAsString(o.reason),o.email,o.comment,this.data.node.ref.repo).subscribe(()=>{this.toast.toast("NODE_REPORT.DONE"),this.dialogRef.close()},e=>{this.setLoading(!1),this.toast.error(e)})}else for(const o of["reason","email"]){const e=this.form.get(o);if(!e.valid){e.markAsTouched(),this.focusField(o),this.cdr.detectChanges();break}}}setLoading(o){this.dialogRef.patchState({isLoading:o}),o?this.form.disable():this.form.enable()}getReasonAsString(o){return`${this.translate.instant("NODE_REPORT.REASONS."+o)} (${o})`}focusField(o){const r=this.formRef.nativeElement.elements.namedItem(o);r instanceof HTMLElement?r.focus():r instanceof RadioNodeList&&r[0].focus()}static#t=this.\u0275fac=function(e){return new(e||n)(t.Y36(p.W9),t.Y36(C.Y),t.Y36(g.$h),t.Y36(g.KD),t.Y36(u.sK),t.Y36(D.F),t.Y36(l.xE),t.Y36(t.sBO))};static#o=this.\u0275cmp=t.Xpm({type:n,selectors:[["es-node-report-dialog"]],viewQuery:function(e,r){if(1&e&&t.Gf(Z,5),2&e){let s;t.iGM(s=t.CRH())&&(r.formRef=s.first)}},decls:26,vars:29,consts:[[3,"formGroup","ngSubmit"],["formElement",""],[1,"report"],["formControlName","reason","name","reason"],[3,"value","aria-describedby",4,"ngFor","ngForOf"],["id","node-report-reason-error",4,"ngIf"],["floatLabel","always"],["matInput","","cdkTextareaAutosize","","cdkAutosizeMinRows","3","cdkAutosizeMaxRows","5","name","comment","formControlName","comment","autofocus","",3,"placeholder"],["matInput","","type","email","name","reportMail","name","email","formControlName","email",3,"placeholder"],[3,"value","aria-describedby"],["id","node-report-reason-error"]],template:function(e,r){1&e&&(t.TgZ(0,"form",0,1),t.NdJ("ngSubmit",function(){return r.report()}),t.TgZ(2,"h2"),t._uU(3),t.ALo(4,"translate"),t.ALo(5,"nodeTitle"),t.qZA(),t.TgZ(6,"div",2)(7,"mat-radio-group",3),t.ALo(8,"translate"),t.YNc(9,x,3,5,"mat-radio-button",4),t.qZA(),t.YNc(10,I,3,3,"mat-error",5),t.qZA(),t.TgZ(11,"mat-form-field",6)(12,"mat-label"),t._uU(13),t.ALo(14,"translate"),t.qZA(),t._UZ(15,"textarea",7),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"mat-form-field",6)(18,"mat-label"),t._uU(19),t.ALo(20,"translate"),t.qZA(),t._UZ(21,"input",8),t.ALo(22,"translate"),t.TgZ(23,"mat-error"),t._uU(24),t.ALo(25,"translate"),t.qZA()()()),2&e&&(t.Q6J("formGroup",r.form),t.xp6(3),t.Oqu(t.xi3(4,10,"NODE_REPORT.REPORT_INFO",t.VKq(27,M,t.lcZ(5,13,r.data.node)))),t.xp6(4),t.uIk("aria-label",t.lcZ(8,15,"NODE_REPORT.REASON")),t.xp6(2),t.Q6J("ngForOf",r.reasons),t.xp6(1),t.Q6J("ngIf",r.shouldShowError("reason")),t.xp6(3),t.Oqu(t.lcZ(14,17,"NODE_REPORT.COMMENT")),t.xp6(2),t.s9C("placeholder",t.lcZ(16,19,"NODE_REPORT.COMMENT_PLACEHOLDER")),t.xp6(4),t.Oqu(t.lcZ(20,21,"NODE_REPORT.EMAIL")),t.xp6(2),t.s9C("placeholder",t.lcZ(22,23,"NODE_REPORT.EMAIL_PLACEHOLDER")),t.xp6(3),t.hij(" ",t.lcZ(25,25,"NODE_REPORT.EMAIL_REQUIRED")," "))},dependencies:[R.sg,R.O5,i._Y,i.Fj,i.JJ,i.JL,d.KE,d.hX,d.TO,L.Nt,P.IC,E.VQ,E.U0,i.sg,i.u,u.X$,m.bB],styles:[".report[_ngcontent-%COMP%]{margin-bottom:20px}.report[_ngcontent-%COMP%]   mat-radio-group[_ngcontent-%COMP%]{display:flex;padding-bottom:10px;flex-direction:column}.report[_ngcontent-%COMP%]   mat-radio-group[_ngcontent-%COMP%] > mat-radio-button[_ngcontent-%COMP%]{height:2.75em}mat-form-field[_ngcontent-%COMP%]{width:100%}h2[_ngcontent-%COMP%]{margin:0 0 20px;font-size:110%;font-weight:700;color:var(--textLight)}"],data:{animation:[(0,f.X$)("fade",m.Le.fade()),(0,f.X$)("cardAnimation",m.Le.cardAnimation())]},changeDetection:0})}return n})(),b=(()=>{class n{static#t=this.\u0275fac=function(e){return new(e||n)};static#o=this.\u0275mod=t.oAB({type:n});static#e=this.\u0275inj=t.cJS({imports:[A.m]})}return n})()}}]);