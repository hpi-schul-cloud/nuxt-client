"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[7159],{47159:(M,D,l)=>{l.d(D,{M:()=>q});var h=l(15861),e=l(65879),o=l(81771),c=l(64634),i=l(52081),x=l(58164),I=l(45125),L=l(90001),W=l(72079),w=l(12994),U=l(49193),K=l(32068),b=l(96776),$=l(17927),k=l(75222),B=l(62413),Q=l(19352),C=l(48098),N=l(71365),Y=l(1189),H=l(96814);function Z(a,f){1&a&&(e.TgZ(0,"h5",3),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"WORKSPACE.NO_NODES_IN_FOLDER")," "))}const F=function(a){return{name:a}};function G(a,f){if(1&a&&(e.TgZ(0,"div"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&a){const t=e.oxw(3);e.xp6(1),e.hij(" ",e.xi3(2,1,"WORKSPACE.NO_MATCHING_ITEMS_FOLDER",e.VKq(4,F,t.node$.value.name))," ")}}function j(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"div",6),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.searchGlobal())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"WORKSPACE.SEARCH_GLOBAL")," "))}function V(a,f){1&a&&(e.TgZ(0,"div"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&a&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"WORKSPACE.NO_MATCHING_ITEMS")))}function J(a,f){if(1&a&&(e.TgZ(0,"h5",3),e.YNc(1,G,3,6,"div",4),e.YNc(2,j,3,3,"div",5),e.YNc(3,V,3,3,"div",4),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.node$.value),e.xp6(1),e.Q6J("ngIf",t.node$.value),e.xp6(1),e.Q6J("ngIf",!t.node$.value)}}function X(a,f){if(1&a&&(e.YNc(0,Z,3,3,"h5",2),e.YNc(1,J,4,3,"h5",2)),2&a){const t=e.oxw();e.Q6J("ngIf",null==t.searchQuery$.value||""===t.searchQuery$.value),e.xp6(1),e.Q6J("ngIf",!(null==t.searchQuery$.value||""===t.searchQuery$.value))}}const z=function(a,f){return{dragAllowed:!0,dropAllowed:a,dropped:f}};let q=(()=>{class a{static getColumns(t,r=[],n=[]){let s=[];if(s.push(new i.HC("NODE",o.u6.CM_NAME)),s.push(new i.HC("NODE",o.u6.CM_CREATOR)),s.push(new i.HC("NODE",o.u6.CM_MODIFIED_DATE)),t.getCurrentLogin()&&t.getCurrentLogin().isAdmin){s.push(new i.HC("NODE",o.u6.NODE_ID));const E=new i.HC("NODE",o.u6.CCM_PROP_REPLICATIONSOURCEID);E.visible=!1,s.push(E)}const _=new i.HC("NODE",o.u6.LOM_PROP_TITLE);_.visible=!1;const m=new i.HC("NODE",o.u6.SIZE);m.visible=!1;const g=new i.HC("NODE",o.u6.CM_PROP_C_CREATED);g.visible=!1;const T=new i.HC("NODE",o.u6.MEDIATYPE);T.visible=!1;const y=new i.HC("NODE",o.u6.LOM_PROP_GENERAL_KEYWORD);y.visible=!1;const v=new i.HC("NODE",o.u6.DIMENSIONS);v.visible=!1;const O=new i.HC("NODE",o.u6.LOM_PROP_LIFECYCLE_VERSION);O.visible=!1;const p=new i.HC("NODE",o.u6.VIRTUAL_PROP_USAGECOUNT);p.visible=!1;const u=new i.HC("NODE",o.u6.CCM_PROP_LICENSE);u.visible=!1;const R=new i.HC("NODE",o.u6.CCM_PROP_WF_STATUS);if(R.visible=!1,s.push(_),s.push(m),s.push(g),s.push(T),s.push(y),s.push(v),s.push(O),s.push(p),s.push(u),s.push(R),Array.isArray(n)){const E=[];for(const d of s)-1!=n.indexOf(d.name)&&(d.visible=!0,E.push(d));for(const d of s)-1==n.indexOf(d.name)&&(d.visible=!1,E.push(d));E.sort((d,S)=>{let A=n.indexOf(d.name),P=n.indexOf(S.name);return-1===A&&(A=n.length),-1===P&&(P=n.length),A-P}),s=E}if(Array.isArray(r)){for(const E of s){let d=!0;for(const S of r)if(E.name===S.name){d=!1;break}d&&r.push(E)}return r}return s}set root(t){this._root=t,this.storage.get(o.uR.KEY_WORKSPACE_SORT+t,null).subscribe(r=>{null!=r?.active?(this.sort.active=r.active,this.sort.direction=r.direction):(this.sort.active=o.u6.CM_NAME,this.sort.direction="asc")})}set current(t){this.setNode(t)}set searchQuery(t){this.setSearchQuery(t)}searchGlobal(){this.onSearchGlobal.emit(this.searchQuery$.value)}load(t=null){if(null==this.node$.value&&!this.searchQuery$.value)return;if(this.sort.columns=this.searchQuery$.value?o.u6.POSSIBLE_SORT_BY_FIELDS_SOLR:o.u6.POSSIBLE_SORT_BY_FIELDS,!this.sort.columns.some(n=>n.name===this.sort.active))return this.sort.active=o.u6.CM_NAME,this.sort.direction="asc",void this.setSorting(this.sort);if(t?.reset)this.dataSource.reset(),this.nodeEntries.getSelection().clear(),this.onReset.emit(),0===t.offset&&this.nodeEntries.resetPagination();else if(this.dataSource.isFullyLoaded())return;this.dataSource.isLoading=!0;const r=t.offset||this.getRealNodeCount();if(this.searchQuery$.value){const n=this.searchQuery$.value;this.lastRequestSearch=!0;const s=[];s.push({property:o.u6.PRIMARY_SEARCH_CRITERIA,values:[n]}),this.node$.value&&s.push({property:"parent",values:[this.node$.value?this.node$.value.ref.id:""]}),this.load$.next({reset:t?.reset,nodes:this.search.search({query:"workspace",repository:C.Qs,metadataset:C.TP,contentType:this.connector.getCurrentLogin()&&this.connector.getCurrentLogin().isAdmin?o.u6.CONTENT_TYPE_ALL:o.u6.CONTENT_TYPE_FILES_AND_FOLDERS,body:{criteria:s,resolveCollections:!1,resolveUsernames:!0},skipCount:r,propertyFilter:[C.mY],sortProperties:[this.sort.active],sortAscending:["asc"===this.sort.direction],maxItems:t?.amount||o.xD.DEFAULT_NUMBER_PER_REQUEST})})}else this.lastRequestSearch=!1,this.load$.next({reset:t?.reset,nodes:this.nodeApi.getChildren(this.node$.value.ref.id,{skipCount:r,maxItems:t?.amount||o.xD.DEFAULT_NUMBER_PER_REQUEST,propertyFilter:[C.mY]})})}ngOnDestroy(){this.destroyed.next(),this.destroyed.complete(),this.temporaryStorage.set(i.xU.NODE_RENDER_PARAMETER_DATA_SOURCE,this.dataSource)}ngOnChanges(t){var r=this;return(0,h.Z)(function*(){t.displayType&&(yield r.initOptions())})()}handleError(t){404==t.status?this.toast.error(null,"WORKSPACE.TOAST.NOT_FOUND",{id:this.node$.value.ref.id}):this.toast.error(t),this.dataSource.isLoading=!1}addNodes(t){this.dataSource.isLoading=!1,t&&t.nodes&&(this.dataSource.appendData(t.nodes),this.dataSource.setPagination(t.pagination))}constructor(t,r,n,s,_,m,g,T,y,v){var O=this;this.connector=t,this.translate=r,this.storage=n,this.temporaryStorage=s,this.config=_,this.search=m,this.toast=g,this.ui=T,this.nodeApi=y,this.localEvents=v,this.SCOPES=i.sX,this.InteractionType=i.s_,this.NodeEntriesDisplayType=i.P8,this.nodesChange=new e.vpe,this.sort={allowed:!0,active:o.u6.CM_NAME,direction:"asc",columns:[]},this.columns=[],this.displayType=i.P8.Table,this.refreshTree=new e.vpe,this.displayTypeChange=new e.vpe,this.reorderDialog=!1,this.reorderDialogChange=new e.vpe,this.searchQuery$=new I.X(null),this.node$=new I.X(null),this.load$=new L.t,this.onOpenNode=new e.vpe,this.onViewNode=new e.vpe,this.onSelectionChanged=new e.vpe,this.onSelectNode=new e.vpe,this.onSearchGlobal=new e.vpe,this.onDrop=new e.vpe,this.onReset=new e.vpe,this.destroyed=new W.xQ,this.canDrop=x.y,this.drop=(p,u)=>{this.onDrop.emit({target:p,source:u})},this.initColumns(),this.registerNodesDeleted(),(0,w.aj)([this.node$,this.searchQuery$]).pipe((0,K.x)((p,u)=>c.W.objectEquals(p[0],u[0])&&p[1]===u[1]),(0,b.b)(10)).subscribe(function(){var p=(0,h.Z)(function*(u){yield O.load({offset:0,reset:!0})});return function(u){return p.apply(this,arguments)}}()),this.load$.pipe((0,$.b)(({reset:p})=>{p&&this.dataSource.reset(),this.dataSource.isLoading=!0}),(0,k.w)(function(){var p=(0,h.Z)(function*({nodes:u}){return yield u.pipe((0,B.K)(R=>(O.handleError(R),(0,U.of)(null)))).toPromise()});return function(u){return p.apply(this,arguments)}}())).subscribe(function(){var p=(0,h.Z)(function*(u){u&&O.addNodes(u)});return function(u){return p.apply(this,arguments)}}())}ngAfterViewInit(){var t=this;return(0,h.Z)(function*(){yield t.initOptions()})()}setSorting(t){var r=this;return(0,h.Z)(function*(){r.sort=t,yield r.storage.set(o.uR.KEY_WORKSPACE_SORT+r._root,{active:t.active,direction:t.direction}),yield r.load({reset:!0,offset:0})})()}onSelection(t){this.onSelectionChanged.emit(t)}doubleClick(t){this.onOpenNode.emit(t)}setNode(t){this.searchQuery$.next(null),t?this.dataSource?.isLoading?setTimeout(()=>this.setNode(t),10):c.W.objectEquals(this.node$.value,t)||(this.node$.next(t),this.initOptions()):this.node$.next(null)}setSearchQuery(t){setTimeout(()=>{t&&t.query?(this.searchQuery$.next(t.query),this.node$.next(t.node)):this.searchQuery$.next(null)})}getRealNodeCount(){return this.dataSource?.getData().filter(t=>!t.virtual).length}initColumns(){this.config.get("workspaceColumns").subscribe(t=>{this.storage.get("workspaceColumns").subscribe(r=>{this.columns=a.getColumns(this.connector,r,t)})})}select(t){1===this.nodeEntries.getSelection().selected.length&&this.nodeEntries.getSelection().selected[0]===t.element||this.nodeEntries.getSelection().clear(),this.nodeEntries.getSelection().toggle(t.element)}initOptions(){var t=this;return(0,h.Z)(function*(){yield t.nodeEntries?.initOptionsGenerator({actionbar:t.actionbar,customOptions:t.customOptions,parent:t.node$.value})})()}registerNodesDeleted(){this.localEvents.nodesDeleted.pipe((0,Q.R)(this.destroyed)).subscribe(t=>{this.dataSource.removeData(t),this.nodeEntries?.getSelection().clear()})}saveColumns(t){this.storage.set("workspaceColumns",t)}clickItem(t){this.ui.isMobile()?this.onOpenNode.emit(t.element):this.select(t)}syncTreeViewOnAdd(t){t.filter(r=>r.virtual&&r.isDirectory).length&&this.refreshTree.emit()}static#e=this.\u0275fac=function(r){return new(r||a)(e.Y36(o.xD),e.Y36(N.sK),e.Y36(o.uR),e.Y36(i.xU),e.Y36(o.eB),e.Y36(C.oD),e.Y36(Y.F),e.Y36(o.VL),e.Y36(C.sX),e.Y36(i.Xn))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["es-workspace-explorer"]],viewQuery:function(r,n){if(1&r&&e.Gf(i.cE,5),2&r){let s;e.iGM(s=e.CRH())&&(n.nodeEntries=s.first)}},inputs:{customOptions:"customOptions",dataSource:"dataSource",displayType:"displayType",reorderDialog:"reorderDialog",preventKeyevents:"preventKeyevents",actionbar:"actionbar",root:"root",current:"current",searchQuery:"searchQuery"},outputs:{nodesChange:"nodesChange",refreshTree:"refreshTree",displayTypeChange:"displayTypeChange",reorderDialogChange:"reorderDialogChange",onOpenNode:"onOpenNode",onViewNode:"onViewNode",onSelectionChanged:"onSelectionChanged",onSelectNode:"onSelectNode",onSearchGlobal:"onSearchGlobal",onDrop:"onDrop",onReset:"onReset"},features:[e.TTD],decls:3,vars:15,consts:[[3,"dataSource","scope","columns","configureColumns","displayType","elementInteractionType","sort","dragDrop","primaryInstance","singleClickHint","columnsChange","displayTypeChange","fetchData","sortChange","clickItem","dblClickItem","virtualNodesAdded"],["empty",""],["class","noElementsInfo",4,"ngIf"],[1,"noElementsInfo"],[4,"ngIf"],["class","clickable",3,"click",4,"ngIf"],[1,"clickable",3,"click"]],template:function(r,n){1&r&&(e.TgZ(0,"es-node-entries-wrapper",0),e.NdJ("columnsChange",function(_){return n.saveColumns(_)})("displayTypeChange",function(_){return n.displayTypeChange.emit(_)})("fetchData",function(_){return n.load(_)})("sortChange",function(_){return n.setSorting(_)})("clickItem",function(_){return n.clickItem(_)})("dblClickItem",function(_){return n.onOpenNode.emit(_.element)})("virtualNodesAdded",function(_){return n.syncTreeViewOnAdd(_)}),e.YNc(1,X,2,2,"ng-template",null,1,e.W1O),e.qZA()),2&r&&(e.ekj("grid",n.displayType!==n.NodeEntriesDisplayType.Table),e.Q6J("dataSource",n.dataSource)("scope",n.SCOPES.WorkspaceList)("columns",n.columns)("configureColumns",!0)("displayType",n.displayType)("elementInteractionType",n.InteractionType.Emitter)("sort",n.sort)("dragDrop",e.WLB(12,z,n.canDrop,n.drop))("primaryInstance",!0)("singleClickHint","static"))},dependencies:[H.O5,i.cE,N.X$],styles:[".noElementsInfo[_ngcontent-%COMP%] > div.clickable[_ngcontent-%COMP%]{color:var(--primary);text-transform:uppercase;margin-top:5px}@media screen and (max-width: 900px){[_nghost-%COMP%]     .list>div{margin-bottom:62px}}es-node-entries-wrapper.grid[_ngcontent-%COMP%]{display:block;margin:10px 20px}"]})}return a})()},58164:(M,D,l)=>{l.d(D,{_:()=>o,y:()=>e});var h=l(81771);function e(c){return c.draggedNodes.includes(c.target)?{accept:!1,denyExplicit:!1}:c.target.isDirectory?c.draggedNodes.some(i=>i.ref.id===c.target.ref.id)||c.draggedNodes.some(i=>i.parent?.id===c.target.ref.id)?{accept:!1,denyExplicit:!1,denyReason:"WORKSPACE.SOURCE_TARGET_IDENTICAL"}:c.target.access.includes(h.u6.ACCESS_WRITE)?o(c):{accept:!1,denyExplicit:!0,denyReason:"WORKSPACE.TARGET_NO_WRITE_PERMISSIONS"}:{accept:!1,denyExplicit:!1,denyReason:"WORKSPACE.TARGET_NO_DIRECTORY"}}function o(c){return"move"===c.action&&c.draggedNodes.some(i=>!i.access.includes(h.u6.ACCESS_WRITE))?{accept:!1,denyExplicit:!0,denyReason:"WORKSPACE.SOURCE_NO_WRITE_PERMISSIONS"}:"link"===c.action?{accept:!1,denyExplicit:!0,denyReason:"WORKSPACE.FEATURE_NOT_IMPLEMENTED"}:{accept:!0}}}}]);