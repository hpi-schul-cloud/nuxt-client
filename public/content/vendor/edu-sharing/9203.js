"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[9203],{49203:(M,c,a)=>{a.r(c),a.d(c,{SaveSearchDialogComponent:()=>I,SaveSearchDialogModule:()=>Y});var u=a(50555),g=a(15861),l=a(56223),f=a(12994),C=a(45125),p=a(51418),A=a(88419),E=a(96124),r=a(81771),d=a(52081),R=a(53461),D=a(4254),t=a(65879),H=a(91486),T=a(48098),N=a(36692),L=a(1189),m=a(71365),V=a(96814),S=a(24630),Z=a(23680),v=a(64170),O=a(24516);function y(i,x){if(1&i&&(t.TgZ(0,"mat-option",5),t._uU(1),t.qZA()),2&i){const e=x.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}let I=(()=>{class i{constructor(e,s,o,n,h,F){this.data=e,this.dialogRef=s,this.savedSearchesService=o,this.dialogs=n,this.toast=h,this.translate=F,this.nameControl=new l.p4,this._savedSearches=new C.X(null)}ngOnInit(){const e=this.data.name||this.getInitialName(this.data.searchString);this.nameControl.setValue(e);const s=new r.Qd("CANCEL",{color:"standard"},()=>this.dialogRef.close()),o=new r.Qd("SAVE",{color:"primary"},()=>this.save());this.dialogRef.patchConfig({buttons:[s,o]});const n=h=>{this.dialogRef.patchConfig({subtitle:h}),o.disabled=!h};this.nameControl.valueChanges.subscribe(h=>n(h)),n(e),this.savedSearchesService.observeMySavedSearches().pipe((0,p.q)(1)).subscribe(this._savedSearches),this.registerAutoCompleteValues()}registerAutoCompleteValues(){f.aj([this._savedSearches.pipe((0,A.P)(d.Nf)),this.nameControl.valueChanges]).pipe((0,E.U)(([e,s])=>e.map(({title:o})=>o).filter(o=>o.includes(s)))).subscribe(e=>this.autocompleteValues=e)}getInitialName(e){return(e||this.translate.instant("SEARCH.SAVE_SEARCH.UNKNOWN_QUERY"))+" - "+d.Ov.formatDate(this.translate,Date.now(),{showAlwaysTime:!0,useRelativeLabels:!1})}save({replace:e=!1}={}){e||!this._savedSearches.value?.some(({title:s})=>s===this.nameControl.value)?(this.dialogRef.patchState({isLoading:!0}),this.savedSearchesService.saveCurrentSearch(this.nameControl.value,{replace:e}).subscribe({next:s=>{this.toast.toast("SEARCH.SAVE_SEARCH.TOAST_SAVED"),this.dialogRef.close(s)},error:s=>{if(this.dialogRef.patchState({isLoading:!1}),s.status!==r.u6.DUPLICATE_NODE_RESPONSE)throw s;s.preventDefault(),this.showShouldReplaceDialog()}})):this.showShouldReplaceDialog()}showShouldReplaceDialog(){var e=this;return(0,g.Z)(function*(){(yield e.dialogs.openGenericDialog({title:"SEARCH.SAVE_SEARCH.SEARCH_EXISTS_TITLE",message:"SEARCH.SAVE_SEARCH.SEARCH_EXISTS_MESSAGE",buttons:D.tq})).beforeClosed().subscribe(o=>{"REPLACE"===o?e.save({replace:!0}):e.dialogRef.patchState({isLoading:!1})})})()}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(R.W9),t.Y36(H.Y),t.Y36(T.M6),t.Y36(N.H),t.Y36(L.F),t.Y36(m.sK))};static#a=this.\u0275cmp=t.Xpm({type:i,selectors:[["es-save-search-dialog"]],decls:12,vars:9,consts:[[1,"label-form-field"],["matInput","",3,"formControl","matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"explanation-text"],[3,"value"]],template:function(s,o){if(1&s&&(t.TgZ(0,"form")(1,"mat-form-field",0)(2,"mat-label"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t._UZ(5,"input",1),t.TgZ(6,"mat-autocomplete",null,2),t.YNc(8,y,2,2,"mat-option",3),t.qZA()()(),t.TgZ(9,"p",4),t._uU(10),t.ALo(11,"translate"),t.qZA()),2&s){const n=t.MAs(7);t.xp6(3),t.Oqu(t.lcZ(4,5,"SEARCH.SAVE_SEARCH.NAME")),t.xp6(2),t.Q6J("formControl",o.nameControl)("matAutocomplete",n),t.xp6(3),t.Q6J("ngForOf",o.autocompleteValues),t.xp6(2),t.Oqu(t.lcZ(11,7,"SEARCH.SAVE_SEARCH.DESCRIPTION"))}},dependencies:[V.sg,l._Y,l.Fj,l.JJ,l.JL,l.F,S.XC,Z.ey,S.ZL,v.KE,v.hX,O.Nt,l.oH,m.X$],styles:[".label-form-field[_ngcontent-%COMP%]{width:100%}"]})}return i})(),Y=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#a=this.\u0275mod=t.oAB({type:i});static#e=this.\u0275inj=t.cJS({imports:[u.m]})}return i})()}}]);