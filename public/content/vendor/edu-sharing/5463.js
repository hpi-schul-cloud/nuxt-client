"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[5463],{5463:(N,u,s)=>{s.r(u),s.d(u,{MdsEditorDialogComponent:()=>U,MdsEditorDialogModule:()=>D});var C=s(50555),P=s(2962),c=s(15861),x=s(12994),O=s(88419),v=s(75810),m=s(96124),y=s(97734),p=s(81771),b=s(18965),h=s(42068),f=s(96931),r=s(16090),l=s(53461),w=s(1739),g=s(42534),n=s(65879),E=s(91486),_=s(52081),I=s(1189),S=s(96814),R=s(71365);function F(o,d){if(1&o){const t=n.EpF();n.ynx(0),n._uU(1," - "),n.TgZ(2,"span",6),n.NdJ("click",function(){n.CHM(t);const i=n.oxw(2);return n.KtG(i.showMissing.emit())}),n._uU(3),n.ALo(4,"translate"),n.qZA(),n.BQk()}2&o&&(n.xp6(3),n.hij(" ",n.lcZ(4,1,"FILL_STATUS.SHOW")," "))}function A(o,d){if(1&o&&(n.TgZ(0,"div",1)(1,"div"),n._UZ(2,"div",2)(3,"div",3)(4,"div",4),n.qZA(),n.TgZ(5,"label"),n.ynx(6),n._uU(7),n.BQk(),n._uU(8),n.ALo(9,"translate"),n.YNc(10,F,5,3,"ng-container",5),n.qZA()()),2&o){const t=n.oxw();n.xp6(1),n.Gre("status status-",t.getStatus(),""),n.xp6(1),n.Udp("width",(t.maximum.mandatory+(t.maximum.mandatoryForPublish||0))/t.getSum("maximum")*100+"%"),n.xp6(1),n.Udp("width",t.maximum.mandatory/t.getSum("maximum")*100+"%"),n.xp6(1),n.Udp("width",t.getFullProgress()/t.getSum("maximum")*100+"%"),n.xp6(1),n.Gre("status-",t.getStatus(),""),n.xp6(2),n.AsE("",t.getSum("current")," / ",t.getSum("maximum"),""),n.xp6(1),n.hij(" ",n.lcZ(9,16,"FILL_STATUS.MESSAGE")," "),n.xp6(2),n.Q6J("ngIf",t.getStatus()===t.RequiredMode.Mandatory||t.getStatus()===t.RequiredMode.MandatoryForPublish)}}let T=(()=>{class o{constructor(){this.RequiredMode=r._8,this.showMissing=new n.vpe}getStatus(){for(const t of Object.values(r._8))if(this.current[t]!==this.maximum[t])return t;return"finished"}getFullProgress(){let t=this.current[r._8.Mandatory];return this.current[r._8.Mandatory]===this.maximum[r._8.Mandatory]&&(t+=this.current[r._8.MandatoryForPublish]||0,this.current[r._8.MandatoryForPublish]===this.maximum[r._8.MandatoryForPublish]&&(t+=this.current.optional||0)),t}getPrimaryProgress(){return this.current[this.getStatus()]/this.maximum[this.getStatus()]}getCurrentMaximum(){return this.getStatus()===r._8.Mandatory?this.current[r._8.Mandatory]:this.maximum[r._8.Mandatory]+(this.maximum[r._8.MandatoryForPublish]||0)}getSum(t){let e=0;for(const i of Object.values(r._8))e+=this[t][i]||0;return e}static#t=this.\u0275fac=function(e){return new(e||o)};static#n=this.\u0275cmp=n.Xpm({type:o,selectors:[["es-input-fill-progress"]],inputs:{current:"current",maximum:"maximum"},outputs:{showMissing:"showMissing"},decls:1,vars:1,consts:[["class","wrapper",4,"ngIf"],[1,"wrapper"],[1,"publish-bar"],[1,"minimum-bar"],[1,"current-bar"],[4,"ngIf"],["tabindex","0",1,"clickable","show-missing-button",3,"click"]],template:function(e,i){1&e&&n.YNc(0,A,11,18,"div",0),2&e&&n.Q6J("ngIf",i.current&&i.maximum)},dependencies:[S.O5,R.X$],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.wrapper[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{width:100%;flex-grow:1;background-color:#eee;position:relative}.wrapper[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   .current-bar[_ngcontent-%COMP%]{position:absolute;height:100%;transition:var(--transitionNormal) all}.wrapper[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   .minimum-bar[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   .publish-bar[_ngcontent-%COMP%]{position:absolute;height:100%}.wrapper[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   .minimum-bar[_ngcontent-%COMP%]{background-color:#777}.wrapper[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   .publish-bar[_ngcontent-%COMP%]{background-color:#aaa}.wrapper[_ngcontent-%COMP%]   .status.status-mandatory[_ngcontent-%COMP%]   .current-bar[_ngcontent-%COMP%]{background-color:#cd2457}.wrapper[_ngcontent-%COMP%]   .status.status-mandatoryForPublish[_ngcontent-%COMP%]   .current-bar[_ngcontent-%COMP%]{background-color:#e98c1b}.wrapper[_ngcontent-%COMP%]   .status.status-recommended[_ngcontent-%COMP%]   .current-bar[_ngcontent-%COMP%]{background-color:#acd331}.wrapper[_ngcontent-%COMP%]   .status.status-finished[_ngcontent-%COMP%]   .current-bar[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%]   .status.status-optional[_ngcontent-%COMP%]   .current-bar[_ngcontent-%COMP%]{background-color:#40bf8e}.wrapper[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{padding:8px 0;font-size:90%;text-align:center}.wrapper[_ngcontent-%COMP%] > label.status-mandatory[_ngcontent-%COMP%]{color:#761532}.wrapper[_ngcontent-%COMP%] > label.status-mandatoryForPublish[_ngcontent-%COMP%]{color:#90550e}.wrapper[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]   .show-missing-button[_ngcontent-%COMP%]{font-weight:700}"]})}return o})();const B=["customBottomBarContent"];function Z(o,d){if(1&o){const t=n.EpF();n.TgZ(0,"es-input-fill-progress",1),n.NdJ("showMissing",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.onShowMissing())}),n.qZA()}if(2&o){const t=n.oxw();n.Q6J("current",t.completedProperties)("maximum",t.totalProperties)}}let U=(()=>{class o{constructor(t,e,i,a,L){this.data=t,this.dialogRef=e,this.mdsEditorInstance=i,this.localEvents=a,this.toast=L,this.dialogRef.patchState({isLoading:!0})}ngOnInit(){var t=this;return(0,c.Z)(function*(){yield t.initMdsEditor(),t.initButtons(),t.registerProgressIndicator(),t.mdsEditorInstance.mdsInflated.pipe((0,O.P)(),(0,v.g)(0)).subscribe(()=>{t.dialogRef.patchState({isLoading:!1}),t.data.immediatelyShowMissingRequiredWidgets&&t.mdsEditorInstance.showMissingRequiredWidgets(!1)})})()}ngAfterViewInit(){this.registerJumpMarks(),this.dialogRef.patchConfig({customBottomBarContent:this.customBottomBarContent})}onShowMissing(){this.mdsEditorInstance.showMissingRequiredWidgets()}initMdsEditor(){var t=this;return(0,c.Z)(function*(){let e;if((0,g.of)(t.data)?e=yield t.mdsEditorInstance.initWithNodes(t.data.nodes,{groupId:t.data.groupId,bulkBehavior:t.data.bulkBehavior,editorMode:"nodes"}):(0,g.cj)(t.data)&&(e=yield t.mdsEditorInstance.initWithoutNodes(t.data.groupId,t.data.setId,t.data.repository,t.data.editorMode,t.data.values)),"angular"!==e)throw new Error('Called mds-editor-dialog with legacy mds. Supports only "angular" rendering.')})()}initButtons(){this.dialogRef.patchConfig({buttons:[new p.Qd("CANCEL",{color:"standard"},()=>this.dialogRef.close("CANCEL")),new p.Qd("SAVE",{color:"primary"},()=>this.save())]}),this.mdsEditorInstance.observeHasUserChanges().subscribe(t=>this.dialogRef.patchConfig({closable:t?l.IA.Confirm:l.IA.Standard}))}registerJumpMarks(){x.aj([this.mdsEditorInstance.activeViews,this.mdsEditorInstance.shouldShowExtendedWidgets$]).pipe((0,m.U)(([t])=>t.map(e=>this.mdsEditorCore.viewRef?.find(i=>i.view.id===e.id))),(0,m.U)(t=>t.filter(e=>e&&!e.isInHiddenState()&&e.view.caption).map(e=>new b.q(e.view.id+w.D,e.view.caption,e.view.icon)))).subscribe(t=>this.dialogRef.patchConfig({jumpMarks:t}))}registerProgressIndicator(){this.mdsEditorInstance.observeCompletionStatus().pipe((0,y.h)(t=>!!t)).subscribe(t=>{this.completedProperties=M(t,e=>e.completed),this.totalProperties=M(t,e=>e.total)})}save(){var t=this;return(0,c.Z)(function*(){if(t.mdsEditorInstance.getCanSave()){t.dialogRef.patchState({isLoading:!0});try{const e=yield t.mdsEditorInstance.save();t.toast.toast("WORKSPACE.EDITOR.UPDATED"),t.dialogRef.close(e),(0,g.of)(t.data)&&t.localEvents.nodesChanged.emit(e)}catch(e){t.handleError(e),t.dialogRef.patchState({isLoading:!1})}}else t.mdsEditorInstance.getIsValid()?t.dialogRef.close("NO-CHANGES"):t.mdsEditorInstance.showMissingRequiredWidgets()})()}handleError(t){console.error(t),t instanceof r.Zp?this.toast.error(null,t.message):this.toast.error(t)}static#t=this.\u0275fac=function(e){return new(e||o)(n.Y36(l.W9),n.Y36(E.Y),n.Y36(f.t),n.Y36(_.Xn),n.Y36(I.F))};static#n=this.\u0275cmp=n.Xpm({type:o,selectors:[["es-mds-editor-dialog"]],viewQuery:function(e,i){if(1&e&&(n.Gf(B,5),n.Gf(h._,5)),2&e){let a;n.iGM(a=n.CRH())&&(i.customBottomBarContent=a.first),n.iGM(a=n.CRH())&&(i.mdsEditorCore=a.first)}},features:[n._Bn([f.t])],decls:3,vars:0,consts:[["customBottomBarContent",""],[3,"current","maximum","showMissing"]],template:function(e,i){1&e&&(n._UZ(0,"es-mds-editor-core"),n.YNc(1,Z,1,2,"ng-template",null,0,n.W1O))},dependencies:[h._,T],styles:["es-input-fill-progress[_ngcontent-%COMP%]{display:flex;min-width:200px;height:36px}[_nghost-%COMP%]     es-mds-editor-core{--mds-content-padding: 25px}[_nghost-%COMP%]     es-mds-editor-core .extended-toggle-container{position:sticky;top:0;width:100%;display:flex;justify-content:flex-end;background-color:#f7f7f7}@media only screen and (min-width: 400px){[_nghost-%COMP%]     es-mds-editor-core .extended-toggle-container{z-index:11;background-color:unset}}[_nghost-%COMP%]     es-mds-editor-core .extended-toggle-container .extended-toggle{display:flex;padding:0 10px 0 25px;height:39px;background:linear-gradient(to right,rgba(247,247,247,.0001) 0,#f7f7f7 15px)}[_nghost-%COMP%]     es-mds-editor-core .heading-container{position:sticky;top:0;z-index:10}[_nghost-%COMP%]     es-mds-editor-core .heading{margin:0;border-bottom:1px solid #eee;font-size:130%;font-weight:400}"]})}return o})();function M(o,d){return Object.entries(o).reduce((t,[e,i])=>(t[e]=d(i),t),{})}let D=(()=>{class o{static#t=this.\u0275fac=function(e){return new(e||o)};static#n=this.\u0275mod=n.oAB({type:o});static#e=this.\u0275inj=n.cJS({imports:[C.m,P.x]})}return o})()}}]);