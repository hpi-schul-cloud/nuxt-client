{"version":3,"file":"src_app_features_dialogs_dialog-modules_save-search-dialog_save-search-dialog_module_ts.js","mappings":"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","sources":["./src/app/features/dialogs/dialog-modules/save-search-dialog/save-search-dialog.component.ts","./src/app/features/dialogs/dialog-modules/save-search-dialog/save-search-dialog.component.html","./src/app/features/dialogs/dialog-modules/save-search-dialog/save-search-dialog.module.ts"],"sourcesContent":["import { Component, Inject, OnInit } from '@angular/core';\nimport { UntypedFormControl } from '@angular/forms';\nimport { TranslateService } from '@ngx-translate/core';\nimport { ApiErrorResponse, SavedSearch, SavedSearchesService } from 'ngx-edu-sharing-api';\nimport * as rxjs from 'rxjs';\nimport { BehaviorSubject } from 'rxjs';\nimport { first, map, take } from 'rxjs/operators';\nimport { DialogButton, RestConstants } from '../../../../core-module/core.module';\nimport { Toast } from '../../../../services/toast';\nimport { DateHelper, notNull } from 'ngx-edu-sharing-ui';\nimport { CARD_DIALOG_DATA } from '../../card-dialog/card-dialog-config';\nimport { CardDialogRef } from '../../card-dialog/card-dialog-ref';\nimport { DialogsService } from '../../dialogs.service';\nimport { REPLACE_OR_BACK } from '../generic-dialog/generic-dialog-data';\nimport { SaveSearchDialogData, SaveSearchDialogResult } from './save-search-dialog-data';\n\n@Component({\n    selector: 'es-save-search-dialog',\n    templateUrl: './save-search-dialog.component.html',\n    styleUrls: ['./save-search-dialog.component.scss'],\n})\nexport class SaveSearchDialogComponent implements OnInit {\n    readonly nameControl = new UntypedFormControl();\n    private readonly _savedSearches = new BehaviorSubject<SavedSearch[]>(null);\n    autocompleteValues: string[];\n\n    constructor(\n        @Inject(CARD_DIALOG_DATA) public data: SaveSearchDialogData,\n        private dialogRef: CardDialogRef<SaveSearchDialogData, SaveSearchDialogResult>,\n        private savedSearchesService: SavedSearchesService,\n        private dialogs: DialogsService,\n        private toast: Toast,\n        private translate: TranslateService,\n    ) {}\n\n    ngOnInit(): void {\n        const name = this.data.name || this.getInitialName(this.data.searchString);\n        this.nameControl.setValue(name);\n        const cancelButton = new DialogButton('CANCEL', { color: 'standard' }, () =>\n            this.dialogRef.close(),\n        );\n        const saveButton = new DialogButton('SAVE', { color: 'primary' }, () => this.save());\n        this.dialogRef.patchConfig({\n            buttons: [cancelButton, saveButton],\n        });\n        const updateName = (name: string) => {\n            this.dialogRef.patchConfig({ subtitle: name });\n            saveButton.disabled = !name;\n        };\n        this.nameControl.valueChanges.subscribe((name) => updateName(name));\n        updateName(name);\n        this.savedSearchesService\n            .observeMySavedSearches()\n            .pipe(take(1))\n            .subscribe(this._savedSearches);\n        this.registerAutoCompleteValues();\n    }\n\n    private registerAutoCompleteValues(): void {\n        rxjs.combineLatest([\n            this._savedSearches.pipe(first(notNull)),\n            this.nameControl.valueChanges,\n        ])\n            .pipe(\n                map(([savedSearches, input]) =>\n                    savedSearches\n                        .map(({ title }) => title)\n                        .filter((title) => title.includes(input)),\n                ),\n            )\n            .subscribe((autocompleteValues) => (this.autocompleteValues = autocompleteValues));\n    }\n\n    private getInitialName(searchString: string): string {\n        return (\n            (searchString || this.translate.instant('SEARCH.SAVE_SEARCH.UNKNOWN_QUERY')) +\n            ' - ' +\n            DateHelper.formatDate(this.translate, Date.now(), {\n                showAlwaysTime: true,\n                useRelativeLabels: false,\n            })\n        );\n    }\n\n    private save({ replace = false } = {}): void {\n        if (\n            !replace &&\n            this._savedSearches.value?.some(({ title }) => title === this.nameControl.value)\n        ) {\n            void this.showShouldReplaceDialog();\n            return;\n        }\n        this.dialogRef.patchState({ isLoading: true });\n        this.savedSearchesService.saveCurrentSearch(this.nameControl.value, { replace }).subscribe({\n            next: (savedSearch) => {\n                this.toast.toast('SEARCH.SAVE_SEARCH.TOAST_SAVED');\n                this.dialogRef.close(savedSearch);\n            },\n            error: (error: ApiErrorResponse) => {\n                this.dialogRef.patchState({ isLoading: false });\n                if (error.status === RestConstants.DUPLICATE_NODE_RESPONSE) {\n                    error.preventDefault();\n                    void this.showShouldReplaceDialog();\n                } else {\n                    throw error;\n                }\n            },\n        });\n    }\n\n    private async showShouldReplaceDialog(): Promise<void> {\n        const dialogRef = await this.dialogs.openGenericDialog({\n            title: 'SEARCH.SAVE_SEARCH.SEARCH_EXISTS_TITLE',\n            message: 'SEARCH.SAVE_SEARCH.SEARCH_EXISTS_MESSAGE',\n            buttons: REPLACE_OR_BACK,\n        });\n        dialogRef.beforeClosed().subscribe((result) => {\n            if (result === 'REPLACE') {\n                this.save({ replace: true });\n            } else {\n                this.dialogRef.patchState({ isLoading: false });\n            }\n        });\n    }\n}\n","<form>\n  <mat-form-field class=\"label-form-field\">\n    <mat-label>{{ 'SEARCH.SAVE_SEARCH.NAME' | translate }}</mat-label>\n    <input matInput [formControl]=\"nameControl\" [matAutocomplete]=\"auto\" />\n    <mat-autocomplete #auto=\"matAutocomplete\">\n      <mat-option *ngFor=\"let option of autocompleteValues\" [value]=\"option\">\n        {{ option }}\n      </mat-option>\n    </mat-autocomplete>\n  </mat-form-field>\n</form>\n<p class=\"explanation-text\">{{ 'SEARCH.SAVE_SEARCH.DESCRIPTION' | translate }}</p>\n","import { NgModule } from '@angular/core';\nimport { SharedModule } from '../../../../shared/shared.module';\nimport { SaveSearchDialogComponent } from './save-search-dialog.component';\n\nexport { SaveSearchDialogComponent };\n\n@NgModule({\n    declarations: [SaveSearchDialogComponent],\n    imports: [SharedModule],\n})\nexport class SaveSearchDialogModule {}\n"],"names":["UntypedFormControl","rxjs","BehaviorSubject","first","map","take","DialogButton","RestConstants","DateHelper","notNull","CARD_DIALOG_DATA","REPLACE_OR_BACK","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵproperty","option_r2","ɵɵadvance","ɵɵtextInterpolate1","SaveSearchDialogComponent","constructor","data","dialogRef","savedSearchesService","dialogs","toast","translate","nameControl","_savedSearches","ngOnInit","name","getInitialName","searchString","setValue","cancelButton","color","close","saveButton","save","patchConfig","buttons","updateName","subtitle","disabled","valueChanges","subscribe","observeMySavedSearches","pipe","registerAutoCompleteValues","combineLatest","savedSearches","input","title","filter","includes","autocompleteValues","instant","formatDate","Date","now","showAlwaysTime","useRelativeLabels","replace","value","some","showShouldReplaceDialog","patchState","isLoading","saveCurrentSearch","next","savedSearch","error","status","DUPLICATE_NODE_RESPONSE","preventDefault","_this","_asyncToGenerator","openGenericDialog","message","beforeClosed","result","_","ɵɵdirectiveInject","i1","CardDialogRef","i2","SavedSearchesService","i3","DialogsService","i4","Toast","i5","TranslateService","_2","selectors","decls","vars","consts","template","SaveSearchDialogComponent_Template","rf","ctx","ɵɵelement","ɵɵtemplate","SaveSearchDialogComponent_mat_option_8_Template","ɵɵtextInterpolate","ɵɵpipeBind1","_r0","SharedModule","SaveSearchDialogModule","_3","declarations","imports"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}