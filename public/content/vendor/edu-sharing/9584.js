"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[9584],{69584:(J,u,n)=>{n.r(u),n.d(u,{CreateVariantDialogComponent:()=>y,CreateVariantDialogModule:()=>_});var p=n(50555),f=n(15861),C=n(52081),o=n(81771),c=n(90721),b=n(53461),e=n(65879),v=n(91486),N=n(19445),A=n(36692),E=n(76754),O=n(22941),R=n(1189),h=n(71365),I=n(98617),m=n(96814),d=n(56223),T=n(17162),D=n(32296),g=n(64170),S=n(24516);function L(i,P){if(1&i){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){const r=e.CHM(t).ngIf,l=e.oxw(2);return e.KtG(l.openLicense(r))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"NODE_VARIANT.WARNING.LINK")," "))}function x(i,P){if(1&i&&(e.TgZ(0,"es-info-message",8),e.ALo(1,"translate"),e.TgZ(2,"div"),e.YNc(3,L,3,3,"button",9),e.ALo(4,"async"),e.qZA()()),2&i){const t=e.oxw();e.s9C("message",e.lcZ(1,2,"NODE_VARIANT.WARNING."+t.licenseWarning)),e.xp6(3),e.Q6J("ngIf",e.lcZ(4,4,t.getLicenseUrl()))}}let y=(()=>{class i{constructor(t,a,s,r,l,M,V,Z,Y,W,B,F,U){this.data=t,this.dialogRef=a,this.breadcrumbsService=s,this.connector=r,this.connectors=l,this.dialogs=M,this.events=V,this.iam=Z,this.nodeApi=Y,this.nodeHelper=W,this.router=B,this.toast=F,this.translate=U,this._initNode(),this._updateBreadcrumbs(o.u6.INBOX),this._updateButtons()}_initNode(){const t=this.data.node;this.variantName=this.translate.instant("NODE_VARIANT.DEFAULT_NAME",{name:this.data.node.name}),this._openViaConnector=this.connectors.connectorSupportsEdit(t);let a=t.properties[o.u6.CCM_PROP_LICENSE]?t.properties[o.u6.CCM_PROP_LICENSE][0]:"";a.startsWith("CC_BY")&&-1!=a.indexOf("ND")?this.licenseWarning="ND":a.startsWith("COPYRIGHT")?this.licenseWarning="COPYRIGHT":a||(this.licenseWarning="NO_LICENSE")}_cancel(){this.dialogRef.close(null)}_done(){this.dialogRef.close(null)}_create(){if(!this.breadcrumbsService.breadcrumbs$.value?.length)return;let t=null;this._openViaConnector&&(t=c.d.getNewWindow(this.connector)),this.dialogRef.patchState({isLoading:!0}),this.nodeApi.forkNode(this.breadcrumbsService.breadcrumbs$.value[this.breadcrumbsService.breadcrumbs$.value.length-1].ref.id,this.data.node.ref.id).subscribe(a=>{this.nodeApi.editNodeMetadata(a.node.ref.id,o.bv.createNameProperty(this.variantName)).subscribe(s=>{this.dialogRef.patchState({isLoading:!1}),this._openViaConnector?(c.d.openConnector(this.connectors,this.iam,this.events,this.toast,s.node,null,t),c.d.goToWorkspaceFolder(this.nodeApi,this.router,this.connector.getCurrentLogin(),this.breadcrumbsService.breadcrumbs$.value[this.breadcrumbsService.breadcrumbs$.value.length-1].ref.id)):this.toast.toast("NODE_VARIANT.CREATED",{folder:this.breadcrumbsService.breadcrumbs$.value[this.breadcrumbsService.breadcrumbs$.value.length-1].name},null,null,{link:{caption:"NODE_VARIANT.CREATED_LINK",callback:()=>{c.d.goToWorkspaceFolder(this.nodeApi,this.router,this.connector.getCurrentLogin(),this.breadcrumbsService.breadcrumbs$.value[this.breadcrumbsService.breadcrumbs$.value.length-1].ref.id)}}}),this._done()},s=>{this.dialogRef.patchState({isLoading:!1}),this.nodeHelper.handleNodeError(this.variantName,s),t&&t.close()})},a=>{this.dialogRef.patchState({isLoading:!1}),console.log(a),-1!==a.error?.error?.indexOf("DAORestrictedAccessException")?this.toast.error(null,"RESTRICTED_ACCESS_COPY_ERROR"):this.nodeHelper.handleNodeError(this.variantName,a),t&&t.close()})}chooseDirectory(){var t=this;return(0,f.Z)(function*(){(yield t.dialogs.openFileChooserDialog({title:"NODE_VARIANT.FILE_PICKER_TITLE",pickDirectory:!0,writeRequired:!0})).afterClosed().subscribe(s=>{s&&t._setDirectory(s)})})()}_setDirectory(t){this._updateBreadcrumbs(t[0].ref.id)}_updateBreadcrumbs(t){this.nodeApi.getNodeParents(t,!1).subscribe(a=>{this.breadcrumbsService.setNodePath(a.nodes.reverse())})}openLicense(t){c.d.openUrl(t,this.connector.getBridgeService(),C.qU.BlankSystemBrowser)}getLicenseUrl(){return this.nodeHelper.getLicenseUrlByString(this.data.node.properties[o.u6.CCM_PROP_LICENSE]?.[0],this.data.node.properties[o.u6.CCM_PROP_LICENSE_CC_VERSION]?.[0],this.data.node.properties[o.u6.CCM_PROP_LICENSE_CC_LOCALE]?.[0])}_updateButtons(){const t=[new o.Qd("CANCEL",{color:"standard"},()=>this._cancel()),new o.Qd("NODE_VARIANT.CREATE"+(this._openViaConnector?"_EDIT":""),{color:"primary"},()=>this._create())];this.dialogRef.patchConfig({buttons:t})}static#e=this.\u0275fac=function(a){return new(a||i)(e.Y36(b.W9),e.Y36(v.Y),e.Y36(N.d),e.Y36(o.xD),e.Y36(o.OJ),e.Y36(A.H),e.Y36(o.I_),e.Y36(o.Du),e.Y36(o.xE),e.Y36(E.G),e.Y36(O.F0),e.Y36(R.F),e.Y36(h.sK))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["es-create-variant-dialog"]],decls:15,vars:13,consts:[["for","variantName"],["matInput","","type","text","id","variantName",3,"ngModel","ngModelChange"],["mode","warning",3,"message",4,"ngIf"],[1,"breadcrumb-style"],[1,"group-left"],[1,"breadcrumb-info"],["short","always",3,"home","clickable"],["mat-raised-button","",3,"click"],["mode","warning",3,"message"],["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-button","","color","primary",3,"click"]],template:function(a,s){1&a&&(e.TgZ(0,"mat-form-field")(1,"mat-label",0),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"input",1),e.NdJ("ngModelChange",function(l){return s.variantName=l}),e.qZA()(),e.YNc(5,x,5,6,"es-info-message",2),e.TgZ(6,"div",3)(7,"div",4)(8,"div",5),e._uU(9),e.ALo(10,"translate"),e.qZA(),e._UZ(11,"es-breadcrumbs",6),e.qZA(),e.TgZ(12,"button",7),e.NdJ("click",function(){return s.chooseDirectory()}),e._uU(13),e.ALo(14,"translate"),e.qZA()()),2&a&&(e.xp6(2),e.Oqu(e.lcZ(3,7,"NODE_VARIANT.NEW_VARIANT")),e.xp6(2),e.Q6J("ngModel",s.variantName),e.xp6(1),e.Q6J("ngIf",s.licenseWarning),e.xp6(4),e.Oqu(e.lcZ(10,9,"NODE_VARIANT.BREADCRUMB_INFO")),e.xp6(2),e.Q6J("home","WORKSPACE.MY_FILES")("clickable",!1),e.xp6(2),e.hij(" ",e.lcZ(14,11,"NODE_VARIANT.CHOOSE")," "))},dependencies:[I.n,m.O5,d.Fj,d.JJ,d.On,T.u,D.lW,g.KE,g.hX,S.Nt,m.Ov,h.X$],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.breadcrumb-style[_ngcontent-%COMP%]{margin:20px -25px -25px;padding:20px 25px;background:rgba(var(--palette-primary-500-no-rgb),.08);display:flex;justify-content:space-between;align-items:center}.breadcrumb-style[_ngcontent-%COMP%]   .group-left[_ngcontent-%COMP%]{display:flex;flex-direction:column}.breadcrumb-style[_ngcontent-%COMP%]   .group-left[_ngcontent-%COMP%]   .breadcrumb-info[_ngcontent-%COMP%]{padding-bottom:5px}es-info-message[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{color:var(--primary);text-transform:uppercase}"]})}return i})(),_=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[p.m]})}return i})()}}]);