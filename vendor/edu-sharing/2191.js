"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[2191],{22191:(E,I,i)=>{i.r(I),i.d(I,{SharingPageModule:()=>q});var m=i(50555),u=i(22941),P=i(15861),r=i(52081),s=i(81771),w=i(64634),M=i(90721),t=i(65879),A=i(34997),_=i(76754),y=i(1189),g=i(48098),d=i(96814),f=i(56223),O=i(94618),v=i(654),x=i(35799),D=i(32296),b=i(49420),N=i(66848),R=i(689),Z=i(71365);const L=["nodeEntries"];function U(e,h){1&e&&t._UZ(0,"es-global-progress")}const H=function(e){return{count:e}};function B(e,h){if(1&e&&(t.TgZ(0,"div",15),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e){const n=t.oxw(2);t.xp6(1),t.hij(" ",t.xi3(2,1,"SHARING.SUBELEMENT_"+(1===n.childCount()?"SINGLE":"MULTI"),t.VKq(4,H,n.childCount()))," ")}}const Y=function(e){return{inviter:e}};function G(e,h){if(1&e&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e){const n=t.oxw(2);t.xp6(1),t.hij(" ",t.xi3(2,1,"SHARING.INVITED_AND_CREATED_BY",t.VKq(4,Y,n.getPersonName(n.sharingInfo.invitedBy)))," ")}}const j=function(e,h){return{inviter:e,creator:h}};function J(e,h){if(1&e&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e){const n=t.oxw(2);t.xp6(1),t.hij(" ",t.xi3(2,1,"SHARING.INVITED_PLUS_CREATED_BY",t.WLB(4,j,n.getPersonName(n.sharingInfo.invitedBy),n.getPersonName(n.sharingInfo.node.createdBy)))," ")}}function W(e,h){if(1&e){const n=t.EpF();t.TgZ(0,"div",16)(1,"form",17),t.NdJ("ngsubmit",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.validatePassword())}),t.TgZ(2,"es-input-password",18),t.NdJ("keydown.enter",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.validatePassword())})("valueChange",function(a){t.CHM(n);const c=t.oxw(2);return t.KtG(c.passwordInput=a)}),t.ALo(3,"translate"),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"button",19),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.validatePassword())}),t._uU(6),t.ALo(7,"translate"),t.qZA()()()}if(2&e){const n=t.oxw(2);t.xp6(2),t.s9C("label",t.lcZ(3,5,"SHARING.PASSWORD")),t.s9C("placeholder",t.lcZ(4,7,"SHARING.PASSWORD_PLACEHOLDER")),t.Q6J("required",!0)("value",n.passwordInput),t.xp6(4),t.hij(" ",t.lcZ(7,9,"SHARING.ENTER_PASSWORD")," ")}}function K(e,h){1&e&&(t.TgZ(0,"div",24),t._UZ(1,"i",25),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&e&&(t.xp6(2),t.hij("",t.lcZ(3,1,"SHARING.PASSWORD_CORRECT")," "))}function Q(e,h){if(1&e){const n=t.EpF();t.TgZ(0,"div")(1,"div",26)(2,"button",19),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(3);return t.KtG(a.download())}),t._UZ(3,"i",23),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"div",27)(7,"es-node-entries-wrapper",28,29),t.NdJ("sortChange",function(a){t.CHM(n);const c=t.oxw(3);return t.KtG(c.changeSort(a))}),t.qZA()()()}if(2&e){const n=t.oxw(3);t.xp6(4),t.hij("",t.lcZ(5,8,"SHARING.DOWNLOAD_ZIP")," "),t.xp6(3),t.Q6J("dataSource",n.nodesDataSource)("scope",n.Scope.Sharing)("columns",n.columns)("checkbox",!1)("sort",n.sort)("elementInteractionType",n.InteractionType.None)("displayType",n.NodeEntriesDisplayType.Table)}}function F(e,h){if(1&e){const n=t.EpF();t.TgZ(0,"div",20),t.YNc(1,K,4,3,"div",21),t.YNc(2,Q,9,10,"div",0),t.TgZ(3,"div",22)(4,"button",19),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.download())}),t._UZ(5,"i",23),t._uU(6),t.ALo(7,"translate"),t.qZA()()()}if(2&e){const n=t.oxw(2);let o;t.xp6(1),t.Q6J("ngIf",n.sharingInfo.password&&n.sharingInfo.passwordMatches&&!n.sharingInfo.node.isDirectory),t.xp6(1),t.Q6J("ngIf",n.sharingInfo.node.isDirectory),t.xp6(4),t.hij("",t.lcZ(7,3,"SHARING."+("link"===n.sharingInfo.node.mediatype?"LINK":n.sharingInfo.node.isDirectory&&(null==(o=n.nodesDataSource.getData())?null:o.length)>1?"DOWNLOAD_ZIP":"DOWNLOAD"))," ")}}const V=function(e){return{"details-opacity":e}};function z(e,h){if(1&e&&(t.TgZ(0,"div",3)(1,"div",4)(2,"div",5),t._UZ(3,"img",6),t.ALo(4,"esAssetsPath"),t.qZA(),t.TgZ(5,"div",7)(6,"div",8),t._UZ(7,"img",9),t.ALo(8,"async"),t.ALo(9,"esNodeIcon"),t.TgZ(10,"div")(11,"div",10),t._uU(12),t.qZA(),t.YNc(13,B,3,6,"div",11),t.YNc(14,G,3,6,"div",0),t.YNc(15,J,3,7,"div",0),t.qZA()()(),t.YNc(16,W,8,11,"div",12),t.YNc(17,F,8,5,"div",13),t.qZA(),t._UZ(18,"es-powered-by",14),t.qZA()),2&e){const n=t.oxw();t.xp6(3),t.Q6J("src",t.lcZ(4,9,"assets/images/logo.svg"),t.LSH),t.xp6(2),t.Q6J("ngClass",t.VKq(15,V,!(!n.sharingInfo.password||n.sharingInfo.passwordMatches))),t.xp6(2),t.Q6J("src",t.lcZ(8,11,t.lcZ(9,13,n.sharingInfo.node)),t.LSH),t.xp6(5),t.Oqu(n.sharingInfo.node.name),t.xp6(1),t.Q6J("ngIf",n.childCount()>0),t.xp6(1),t.Q6J("ngIf",n.inviterIsAuthor()),t.xp6(1),t.Q6J("ngIf",!n.inviterIsAuthor()),t.xp6(1),t.Q6J("ngIf",!(!n.sharingInfo.password||n.sharingInfo.passwordMatches)),t.xp6(1),t.Q6J("ngIf",!n.sharingInfo.password||n.sharingInfo.passwordMatches)}}const X=[{path:"",component:(()=>{class e{constructor(n,o,a,c,S,$,tt,nt,et,it,ot){this.router=n,this.route=o,this.connector=a,this.nodeService=c,this.sharingService=S,this.bridge=$,this.nodeHelperService=tt,this.storage=nt,this.toast=et,this.config=it,this.translations=ot,this.NodeEntriesDisplayType=r.P8,this.InteractionType=r.s_,this.Scope=r.sX,this.loading=!0,this.nodesDataSource=new r.AL,this.columns=[],this.sort={allowed:!0,columns:s.u6.POSSIBLE_SORT_BY_FIELDS,active:s.u6.CM_NAME,direction:"asc"},this.options={useDefaultOptions:!1,addOptions:[]},this.columns.push(new r.HC("NODE",s.u6.CM_NAME)),this.columns.push(new r.HC("NODE",s.u6.CM_MODIFIED_DATE)),this.columns.push(new r.HC("NODE",s.u6.SIZE));const C=new r.BA("SHARING.DOWNLOAD","cloud_download",l=>this.download(l));C.elementType=[r.Hd.Node],C.group=r.EM.Primary,C.showAsAction=!0;const T=new r.BA("SHARING.OPEN","open_in_new",l=>{console.log(l),M.d.openUrl(l.properties[s.u6.CCM_PROP_IO_WWWURL][0],this.bridge,r.qU.BlankSystemBrowser)});T.group=r.EM.Primary,T.showAsAction=!0,C.customShowCallback=function(){var l=(0,P.Z)(function*(p){return"link"!==p?.[0]?.mediatype});return function(p){return l.apply(this,arguments)}}(),T.customShowCallback=function(){var l=(0,P.Z)(function*(p){return"link"===p?.[0]?.mediatype});return function(p){return l.apply(this,arguments)}}(),this.options.addOptions.push(C),this.options.addOptions.push(T),this.translations.waitForInit().subscribe(()=>{this.route.queryParams.subscribe(l=>{this.params=l,this.sharingService.getInfo(l.nodeId,l.token).subscribe(p=>{this.loading=!1,this.sharingInfo=p,p.expired?this.router.navigate([r.ru.ROUTER_PREFIX,"messages","share_expired"]):this.loadChildren()},p=>{console.warn(p),this.router.navigate([r.ru.ROUTER_PREFIX,"messages","share_expired"]),this.loading=!1})})})}validatePassword(){this.sharingService.getInfo(this.params.nodeId,this.params.token,this.passwordInput).subscribe(n=>{n.passwordMatches||this.toast.error(null,"SHARING.ERROR_INVALID_PASSWORD"),this.sharingInfo=n,this.loadChildren()})}download(n=null){const o=this.params.nodeId,a=this.params.token;let c=this.connector.getAbsoluteEndpointUrl()+"../share?mode=download&token="+encodeURIComponent(a)+"&password="+encodeURIComponent(this.passwordInput)+"&nodeId="+encodeURIComponent(o);if(null==n&&this.sharingInfo.node.isDirectory){const S=s.bv.getNodeIds(this.nodesDataSource.getData()).join(",");c+="&childIds="+encodeURIComponent(S)}else null!=n&&(c+="&childIds="+encodeURIComponent(n.ref.id));window.open(c)}changeSort(n){this.sort=n,this.loadChildren()}loadChildren(){this.sharingInfo.password&&!this.sharingInfo.passwordMatches||(this.nodesDataSource.reset(),this.nodesDataSource.isLoading=!0,this.sharingService.getChildren(this.params.nodeId,this.params.token,this.passwordInput,{count:s.u6.COUNT_UNLIMITED,sortBy:[this.sort.active],sortAscending:["asc"===this.sort.direction],propertyFilter:[s.u6.ALL]}).subscribe(o=>{this.nodesDataSource.setData(o.nodes),this.nodesDataSource.isLoading=!1,setTimeout(()=>{this.nodeEntries.initOptionsGenerator({customOptions:this.options})})}))}inviterIsAuthor(){return w.W.objectEquals(this.sharingInfo.invitedBy,this.sharingInfo.node.createdBy)}getPersonName(n){return s.qp.getPersonWithConfigDisplayName(n,this.config)}childCount(){if(this.sharingInfo.node.type===s.u6.CCM_TYPE_IO)try{return parseInt(this.sharingInfo.node.properties[s.u6.VIRTUAL_PROP_CHILDOBJECTCOUNT]?.[0],10)||0}catch{}return 0}static#t=this.\u0275fac=function(o){return new(o||e)(t.Y36(u.F0),t.Y36(u.gz),t.Y36(s.xD),t.Y36(s.xE),t.Y36(s.jF),t.Y36(A.d),t.Y36(_.G),t.Y36(r.xU),t.Y36(y.F),t.Y36(g.E4),t.Y36(r.fA))};static#n=this.\u0275cmp=t.Xpm({type:e,selectors:[["es-sharing-page"]],viewQuery:function(o,a){if(1&o&&t.Gf(L,5),2&o){let c;t.iGM(c=t.CRH())&&(a.nodeEntries=c.first)}},decls:5,vars:5,consts:[[4,"ngIf"],["esTitle","",1,"cdk-visually-hidden"],["class","container",4,"ngIf"],[1,"container"],[1,"container-inside"],[1,"branding"],["esImageConfig","","alt","logo",3,"src"],[1,"details",3,"ngClass"],[1,"details-type"],[1,"icon",3,"src"],[1,"name"],["class","subobjects",4,"ngIf"],["class","password-required",4,"ngIf"],["class","password-valid",4,"ngIf"],["mode","color"],[1,"subobjects"],[1,"password-required"],[3,"ngsubmit"],["inputId","password",3,"label","required","value","placeholder","keydown.enter","valueChange"],["mat-raised-button","","color","primary",3,"click"],[1,"password-valid"],["class","password-correct",4,"ngIf"],[1,"download"],["esIcon","cloud_download"],[1,"password-correct"],["esIcon","done"],[1,"download-top"],[1,"folder"],[3,"dataSource","scope","columns","checkbox","sort","elementInteractionType","displayType","sortChange"],["nodeEntries",""]],template:function(o,a){1&o&&(t.YNc(0,U,1,0,"es-global-progress",0),t.TgZ(1,"h1",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,z,19,17,"div",2)),2&o&&(t.Q6J("ngIf",a.loading),t.xp6(2),t.Oqu(t.lcZ(3,3,"SHARING.TITLE")),t.xp6(2),t.Q6J("ngIf",!a.loading&&a.sharingInfo))},dependencies:[d.mk,d.O5,r.ar,r.cE,f._Y,f.JL,f.F,O.d,v.e,x.P,D.lW,b.k,N.M,R.U,d.Ov,Z.X$,r.R2],styles:[".container[_ngcontent-%COMP%]{min-height:100%;display:flex;align-items:center;margin:auto;max-width:1000px}.container[_ngcontent-%COMP%]   .container-inside[_ngcontent-%COMP%]{margin:var(--mainnavHeight) auto 70px auto;padding:5% 0 0;width:90%;z-index:1;position:relative}.password-required[_ngcontent-%COMP%]{margin:0 auto;width:400px}.password-required[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.subobjects[_ngcontent-%COMP%]{font-size:90%;color:var(--textLight);margin:6px 0}.branding[_ngcontent-%COMP%]{position:relative;height:100px;text-align:center;margin-bottom:80px}.branding[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:auto;height:100%}.details[_ngcontent-%COMP%]{margin-bottom:20px;position:relative;width:90%;left:5%}.details[_ngcontent-%COMP%]   .details-type[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:14px;width:50px;height:auto}.details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:210%;font-weight:700;height:42px;word-break:break-all;overflow:hidden}.details-opacity[_ngcontent-%COMP%]{opacity:.5}.password-required[_ngcontent-%COMP%], .password-valid[_ngcontent-%COMP%]{justify-content:center;display:flex;flex-direction:column}.password-correct[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;color:#40bf8e;font-size:10pt;text-transform:uppercase;font-weight:700;margin-bottom:10px}.password-correct[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:10px;border-radius:50%;border:2px solid #40bf8e;padding:2px;display:table}.download[_ngcontent-%COMP%]{margin-top:10px;text-align:center}.download-top[_ngcontent-%COMP%]{text-align:center;margin-top:0;margin-bottom:20px}es-powered-by[_ngcontent-%COMP%]{position:fixed;left:0;bottom:3%}.folder[_ngcontent-%COMP%]{border:6px solid #eee;border-radius:6px;margin-top:10px;margin-bottom:5px;position:relative}[_nghost-%COMP%]     .heading{background:#eee}[_nghost-%COMP%]     .password-required mat-form-field{width:100%}@media screen and (max-width: 700px),screen and (max-height: 400px){.container[_ngcontent-%COMP%], .password-required[_ngcontent-%COMP%]{width:100%}.branding[_ngcontent-%COMP%]{margin-bottom:-30px}.branding[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:auto}es-powered-by[_ngcontent-%COMP%]{display:none}.folder[_ngcontent-%COMP%]{border:none;margin-top:0;width:110%;left:-5%}}@media screen and (max-height: 400px){.branding[_ngcontent-%COMP%]{display:none}}"]})}return e})()}];let k=(()=>{class e{static#t=this.\u0275fac=function(o){return new(o||e)};static#n=this.\u0275mod=t.oAB({type:e});static#e=this.\u0275inj=t.cJS({imports:[u.Bz.forChild(X),u.Bz]})}return e})(),q=(()=>{class e{static#t=this.\u0275fac=function(o){return new(o||e)};static#n=this.\u0275mod=t.oAB({type:e});static#e=this.\u0275inj=t.cJS({imports:[m.m,k]})}return e})()},66848:(E,I,i)=>{i.d(I,{M:()=>A});var m=i(72079),u=i(12994),P=i(77504),r=i(96124),s=i(65879),w=i(6593),M=i(52081),t=i(81771);let A=(()=>{class _{constructor(g,d,f,O){this.elementRef=g,this.documentTitle=d,this.translations=f,this.pageHeading=new m.xQ,this.titleOverride=new m.xQ,this.pageTitle=new m.xQ,this.mutationObserver=new MutationObserver(()=>this.updatePageHeading()),this.mutationObserver.observe(this.elementRef.nativeElement,{characterData:!0,subtree:!0}),(0,u.aj)([this.pageHeading,this.titleOverride]).pipe((0,r.U)(([v,x])=>x??v)).subscribe(this.pageTitle),(0,u.aj)([(0,P.D)({branding:O.get("branding"),siteTitle:O.get("siteTitle","edu-sharing")}),this.pageTitle,this.translations.waitForInit()]).subscribe(([v,x])=>this.updateTitle(v,x))}ngOnChanges(g){if(g.esTitle){const d=g.esTitle.currentValue;this.titleOverride.next(""===d?null:d??"")}}ngOnInit(){this.updatePageHeading()}ngOnDestroy(){this.mutationObserver.disconnect()}updatePageHeading(){this.pageHeading.next(this.elementRef.nativeElement.textContent)}updateTitle(g,d){this.documentTitle.setTitle(d?g.branding?d+" - "+g.siteTitle:d:g.siteTitle)}static#t=this.\u0275fac=function(d){return new(d||_)(s.Y36(s.SBq),s.Y36(w.Dx),s.Y36(M.fA),s.Y36(t.eB))};static#n=this.\u0275dir=s.lG2({type:_,selectors:[["","esTitle",""]],inputs:{esTitle:"esTitle"},features:[s.TTD]})}return _})()}}]);