"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[6952],{36952:(E,r,o)=>{o.r(r),o.d(r,{PinnedCollectionsDialogComponent:()=>N,PinnedCollectionsDialogModule:()=>L});var g=o(50555),s=o(81771),C=o(64634),p=o(53461),t=o(65879),f=o(91486),u=o(1189),m=o(71365),D=o(96814),a=o(34423),P=o(52081),O=o(75986);function x(n,T){if(1&n){const e=t.EpF();t.TgZ(0,"li",2)(1,"mat-checkbox",3),t.NdJ("change",function(c){const l=t.CHM(e).$implicit,h=t.oxw();return t.KtG(h.setChecked(l,c))}),t._uU(2),t.qZA(),t._UZ(3,"i",4),t.qZA()}if(2&n){const e=T.$implicit,i=t.oxw();t.xp6(1),t.Q6J("checked",i.isChecked(e)),t.xp6(1),t.hij(" ",i.getName(e)," ")}}let N=(()=>{class n{constructor(e,i,c,d,l,h,k){this.data=e,this.dialogRef=i,this.collection=c,this.node=d,this.search=l,this.toast=h,this.translate=k,this.checked=[],this.init(),this.initButtons()}close(){this.dialogRef.close(null)}init(){this.dialogRef.patchState({isLoading:!0}),this.search.searchByProperties([s.u6.CCM_PROP_COLLECTION_PINNED_STATUS],["true"],["="],s.u6.COMBINE_MODE_AND,s.u6.CONTENT_TYPE_COLLECTIONS,{sortBy:[s.u6.CCM_PROP_COLLECTION_PINNED_ORDER],sortAscending:!0,count:s.u6.COUNT_UNLIMITED}).subscribe(e=>{this.pinnedCollections=e.nodes,this.updateSubtitle();for(let i of this.pinnedCollections)if(i.ref.id===this.data.collection.ref.id)return this.setAllChecked(),void this.dialogRef.patchState({isLoading:!1});this.node.getNodeMetadata(this.data.collection.ref.id).subscribe(i=>{this.pinnedCollections.splice(0,0,i.node),this.updateSubtitle(),this.dialogRef.patchState({isLoading:!1}),this.setAllChecked()})})}initButtons(){const e=[new s.Qd("CANCEL",{color:"standard"},()=>this.close()),new s.Qd("APPLY",{color:"primary"},()=>this.apply())];this.dialogRef.patchConfig({buttons:e})}updateSubtitle(){this.translate.get("CARD_SUBTITLE_MULTIPLE",{count:this.pinnedCollections.length}).subscribe(e=>this.dialogRef.patchConfig({subtitle:e}))}isChecked(e){return-1!=this.checked.indexOf(e.ref.id)}onDropped(e){C.W.arraySwap(this.pinnedCollections,e.previousIndex,e.currentIndex),this.dialogRef.patchConfig({closable:p.IA.Confirm})}getName(e){return s.bv.getTitle(e)}apply(){this.dialogRef.patchState({isLoading:!0});let e=[];for(let i of this.pinnedCollections)this.isChecked(i)&&e.push(i.ref.id);this.collection.setPinning(e).subscribe(()=>{this.toast.toast("COLLECTIONS.PINNING.UPDATED"),this.close()},i=>{this.toast.error(i),this.dialogRef.patchState({isLoading:!1})})}setChecked(e,i){this.isChecked(e)?this.checked.splice(this.checked.indexOf(e.ref.id),1):this.checked.push(e.ref.id)}setAllChecked(){for(let e of this.pinnedCollections)this.checked.push(e.ref.id)}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(p.W9),t.Y36(f.Y),t.Y36(s.i6),t.Y36(s.xE),t.Y36(s.Y6),t.Y36(u.F),t.Y36(m.sK))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["es-pinned-collections-dialog"]],decls:2,vars:1,consts:[["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",4,"ngFor","ngForOf"],["cdkDrag",""],[3,"checked","change"],["esIcon","drag_handle","cdkDragHandle","",1,"drag-handle"]],template:function(i,c){1&i&&(t.TgZ(0,"ul",0),t.NdJ("cdkDropListDropped",function(l){return c.onDropped(l)}),t.YNc(1,x,4,2,"li",1),t.qZA()),2&i&&(t.xp6(1),t.Q6J("ngForOf",c.pinnedCollections))},dependencies:[D.sg,a.Wj,a.Zt,a.Bh,P.ar,O.oG],styles:["ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}li[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-bottom:solid 1px #ccc}li[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin:12px}li[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{opacity:.5;cursor:move;padding:20px;box-sizing:content-box}"]})}return n})(),L=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#i=this.\u0275inj=t.cJS({imports:[g.m]})}return n})()}}]);