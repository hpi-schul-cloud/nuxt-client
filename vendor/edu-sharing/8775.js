"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[8775],{78775:(D,d,r)=>{r.r(d),r.d(d,{AppSharePageModule:()=>E});var v=r(50555),p=r(22941),l=r(52081),m=r(90721),o=r(81771),g=r(64634),u=r(84003),t=r(65879),x=r(1189),P=r(6593),f=r(71365),C=r(96814),b=r(94618),T=r(32296);function y(n,h){1&n&&t._UZ(0,"es-global-progress")}function _(n,h){if(1&n&&(t.TgZ(0,"div",17),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Oqu(e.description)}}function O(n,h){if(1&n&&(t.TgZ(0,"div",18)(1,"i",19),t._uU(2,"home"),t.qZA(),t.TgZ(3,"div"),t._uU(4,"\u203a"),t.qZA(),t.TgZ(5,"div"),t._uU(6),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(6),t.Oqu(e.inbox.name)}}function A(n,h){if(1&n){const e=t.EpF();t.TgZ(0,"div",2)(1,"div",3),t._UZ(2,"img",4),t.TgZ(3,"div",5)(4,"div",6),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",7),t._uU(8),t.qZA(),t.YNc(9,_,2,1,"div",8),t.qZA()(),t.TgZ(10,"div",9),t._uU(11),t.ALo(12,"translate"),t.YNc(13,O,7,1,"div",10),t.qZA(),t.TgZ(14,"div",11)(15,"button",12),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.saveFile())}),t._UZ(16,"i",13),t.TgZ(17,"span"),t._uU(18),t.ALo(19,"translate"),t.qZA()()(),t.TgZ(20,"div",14)(21,"div",15),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"es-node-entries-wrapper",16),t.NdJ("clickItem",function(s){t.CHM(e);const a=t.oxw();return t.KtG(a.saveToCollection(s.element))}),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("src",e.previewUrl,t.LSH),t.xp6(3),t.Oqu(t.lcZ(6,12,"MEDIATYPE."+e.getType())),t.xp6(3),t.Oqu(e.title?e.title:e.uri),t.xp6(1),t.Q6J("ngIf",e.description),t.xp6(2),t.hij(" ",t.lcZ(12,14,"SHARE_APP.WILL_BE_SAVED_AT"),": "),t.xp6(2),t.Q6J("ngIf",e.inbox),t.xp6(5),t.Oqu(t.lcZ(19,16,"SAVE")),t.xp6(4),t.hij(" ",t.lcZ(23,18,"SHARE_APP.ADD_TO_COLLECTION")," "),t.xp6(2),t.Q6J("dataSource",e.collections)("columns",e.columns)("displayType",e.NodeEntriesDisplayType.SmallGrid)("elementInteractionType",e.InteractionType.Emitter)}}const I=[{path:"",component:(()=>{class n{constructor(e,i,s,a,c,w,S,L,N,Z,R,U,Y){this.toast=e,this.route=i,this.router=s,this.sanitizer=a,this.node=c,this.connectors=w,this.events=S,this.utilities=L,this.translate=N,this.translations=Z,this.collectionApi=R,this.cordova=U,this.connector=Y,this.NodeEntriesDisplayType=l.P8,this.InteractionType=l.s_,this.globalProgress=!0,this.type="LINK",this.columns=[],this.collections=new l.AL,this.cordova.setOnBackBehaviour(u.V.closeApp),this.columns.push(new l.HC("COLLECTION","title")),this.columns.push(new l.HC("COLLECTION","info")),this.columns.push(new l.HC("COLLECTION","scope")),this.cordova.isRunningCordova()?this.cordova.subscribeServiceReady().subscribe(()=>{this.init()}):this.init()}getType(){if(this.isLink())return"link";if(this.isTextSnippet())return"file-txt";if("application/pdf"===this.mimetype)return"file-pdf";if(["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(this.mimetype))return"file-word";if(["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(this.mimetype))return"file-excel";if(["application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint"].includes(this.mimetype))return"file-powerpoint";if(["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"].includes(this.mimetype))return"file-word";if(this.mimetype){let e=this.mimetype.split("/")[0];if(this.translate.instant("MEDIATYPE.file-"+e)==="MEDIATYPE.file-"+e&&(e=null),null!=e)return"file-"+e}return"file"}saveInternal(e){if(this.globalProgress=!0,this.isLink()){let i={};i[o.u6.CCM_PROP_IO_WWWURL]=[this.getUri()],this.node.createNode(this.inbox?.ref?.id||o.u6.INBOX,o.u6.CCM_TYPE_IO,[],i,!0,o.u6.COMMENT_MAIN_FILE_UPLOAD).subscribe(s=>{e(s.node)})}else{let i=o.bv.createNameProperty(this.title);this.editorType&&(i[o.u6.CCM_PROP_EDITOR_TYPE]=[this.editorType]),this.text&&!this.isTextSnippet()&&(i[o.u6.LOM_PROP_GENERAL_DESCRIPTION]=[this.text]),this.node.createNode(this.inbox.ref.id,o.u6.CCM_TYPE_IO,[],i,!0).subscribe(s=>{this.node.uploadNodeContent(s.node.ref.id,this.file,o.u6.COMMENT_MAIN_FILE_UPLOAD,this.mimetype).subscribe(()=>{e(s.node)},a=>{this.toast.error(a),this.globalProgress=!1})},s=>{this.toast.error(s),this.globalProgress=!1})}}saveFile(){this.saveInternal(e=>{this.goToInbox(),this.events.broadcastEvent(o.I_.EVENT_SHARED,e)})}saveToCollection(e){this.saveInternal(i=>{this.collectionApi.addNodeToCollection(e.ref.id,i.ref.id,i.ref.repo).subscribe(()=>{m.d.goToCollection(this.router,e,null,{replaceUrl:!0}),this.events.broadcastEvent(o.I_.EVENT_SHARED,i)})})}isLink(){if("public.url"==this.cordovaType)return!0;if(this.hasData()||!this.uri||this.uri.startsWith("content://")||this.uri.startsWith("file://"))return!1;let e=this.uri.indexOf("://");return e>0&&e<10}isTextSnippet(){return"public.text"==this.cordovaType||!(this.hasData()||this.isLink()||!this.uri)&&!this.uri.startsWith("content://")&&!this.uri.startsWith("file://")}goToInbox(){m.d.goToWorkspaceFolder(this.node,this.router,null,this.inbox.ref.id,{replaceUrl:!0})}hasWritePermissions(e){return-1==e.access.indexOf(o.u6.ACCESS_WRITE)?{status:!1,message:"NO_WRITE_PERMISSIONS"}:{status:!0}}init(){this.translations.waitForInit().subscribe(()=>{this.route.queryParams.subscribe(e=>{if(this.uri=e.uri,this.mimetype=e.mimetype,"public.image"==this.mimetype?this.mimetype="image/jpeg":this.mimetype.includes("/")||(console.info("invalid mimetype from ios",this.mimetype),this.mimetype="application/octet-stream"),this.cordovaType=e.mimetype,this.fileName=e.file,this.text=e.text,this.description=null,this.collections.reset(),this.collections.isLoading=!0,this.collectionApi.search("",{sortBy:[o.u6.CM_MODIFIED_DATE],offset:0,count:50,sortAscending:!1}).subscribe(i=>{this.collections.setData(i.collections,i.pagination),this.collections.isLoading=!1},i=>{this.toast.error(i),this.collections.isLoading=!1}),this.node.getNodeParents(o.u6.INBOX,!1).subscribe(i=>{this.inboxPath=i.nodes,this.inbox=i.nodes[0]}),this.previewUrl=this.connector.getThemeMimePreview(this.getType()+".svg"),console.log("type",this.mimetype,this.getType()),this.isLink())this.utilities.getWebsiteInformation(this.getUri()).subscribe(i=>{this.title=i.title?i.title+" - "+i.page:this.getUri(),this.description=i.description,this.globalProgress=!1},i=>{this.title=this.getUri(),this.globalProgress=!1});else if(this.isTextSnippet())this.globalProgress=!1,this.connectors.list().subscribe(i=>{this.prepareTextSnippet(i.connectors)},i=>{this.prepareTextSnippet(null)});else if(this.cordova.isRunningCordova()&&this.cordova.getLastIntent()&&this.cordova.getLastIntent().stream){let i=this.cordova.getLastIntent().stream;this.mimetype.startsWith("image/")&&(this.previewUrl=this.sanitizer.bypassSecurityTrustResourceUrl("data:"+this.mimetype+";base64,"+i)),this.file=g.W.base64toBlob(i,this.mimetype),this.cordova.getFileAsBlob(this.getUri(),this.mimetype).subscribe(s=>{this.globalProgress=!1,this.updateTitle()},s=>{console.warn(s),this.globalProgress=!1,this.updateTitle()})}else this.router.navigate([l.ru.ROUTER_PREFIX,"messages","SHARING_ERROR"])})})}updateTitle(){let e=this.fileName?this.fileName.split("/"):this.uri.split("/");this.title=decodeURIComponent(e[e.length-1])}hasData(){return this.cordova.isRunningCordova()&&this.cordova.getLastIntent()&&null!=this.cordova.getLastIntent().stream}prepareTextSnippet(e){this.mimetype="text/plain";let i="txt";if(e&&e.length){let a=g.W.indexOfObjectArray(e,"id","TINYMCE");if(-1!=a){let c=e[a];this.mimetype=c.filetypes[0].mimetype,i=c.filetypes[0].filetype,this.editorType=c.filetypes[0].editorType}}this.title=this.translate.instant("SHARE_APP.TEXT_SNIPPET")+" "+l.Ov.getDateForNewFile()+"."+i;let s=this.getTextContent();"text/html"==this.mimetype&&(s=s.replace(/\n/g,"<br />")),this.file=new Blob([s],{type:this.mimetype})}getTextContent(){return this.cordova.isAndroid()?this.uri:this.text}getUri(){return this.cordova.isAndroid()?this.uri:this.cordova.getLastIntent().base64}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(x.F),t.Y36(p.gz),t.Y36(p.F0),t.Y36(P.H7),t.Y36(o.xE),t.Y36(o.OJ),t.Y36(o.I_),t.Y36(o.li),t.Y36(f.sK),t.Y36(l.fA),t.Y36(o.i6),t.Y36(u.d),t.Y36(o.xD))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["es-app-share-page"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","content",4,"ngIf"],[1,"content"],[1,"preview"],[3,"src"],[1,"info"],[1,"type"],[1,"label"],["class","description",4,"ngIf"],[1,"location"],["class","breadcrumbs",4,"ngIf"],[1,"save"],["mat-flat-button","","color","primary",3,"click"],["esIcon","folder"],[1,"collections"],[1,"addToCollection"],[3,"dataSource","columns","displayType","elementInteractionType","clickItem"],[1,"description"],[1,"breadcrumbs"],[1,"material-icons"]],template:function(i,s){1&i&&(t.YNc(0,y,1,0,"es-global-progress",0),t.YNc(1,A,25,20,"div",1)),2&i&&(t.Q6J("ngIf",s.globalProgress),t.xp6(1),t.Q6J("ngIf",!s.globalProgress))},dependencies:[C.O5,l.ar,l.cE,b.d,T.lW,f.X$],styles:[".content[_ngcontent-%COMP%]{padding:20px 30px;width:100%;max-width:calc(var(--cardWidth) * 4 + 125px);margin:auto;margin-top:var(--mainnavHeight);display:flex;flex-direction:column}.content[_ngcontent-%COMP%]   .breadcrumbs[_ngcontent-%COMP%]{color:var(--primary);display:flex;flex-grow:1;align-items:center;margin-left:5px}.content[_ngcontent-%COMP%]   .breadcrumbs[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 2px}.content[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]{display:flex;padding-bottom:10px}.content[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:90px;height:90px;min-width:90px;min-height:90px;object-fit:cover}.content[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-left:20px}.content[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{font-weight:700;font-size:80%;color:var(--textLight);padding-bottom:15px}.content[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-height:1.5em;max-height:1.5em;-webkit-line-clamp:1;-webkit-box-orient:vertical;word-break:break-all;margin-bottom:10px}.content[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:90%;color:var(--textLight);overflow:hidden;text-overflow:ellipsis;display:-webkit-box;line-height:1.5em;max-height:3em;-webkit-line-clamp:2;-webkit-box-orient:vertical}.content[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:90%;color:var(--textLight)}.content[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]   es-breadcrumbs[_ngcontent-%COMP%]{margin-top:2px}.content[_ngcontent-%COMP%]   .save[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.content[_ngcontent-%COMP%]   .collections[_ngcontent-%COMP%]{margin-top:40px;margin-bottom:10px}.content[_ngcontent-%COMP%]   .collections[_ngcontent-%COMP%]   .addToCollection[_ngcontent-%COMP%]{font-weight:700;margin-bottom:20px}@media all and (max-width: calc(var(--cardWidth) * 3)){[_nghost-%COMP%]     .cardSmallList{width:calc(100% - 10px)!important}}"],data:{animation:[]}})}return n})()}];let M=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#i=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(I),p.Bz]})}return n})(),E=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#i=this.\u0275inj=t.cJS({imports:[v.m,M]})}return n})()}}]);