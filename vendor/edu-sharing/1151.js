"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[1151],{21151:(K,g,i)=>{i.r(g),i.d(g,{ShareLinkDialogComponent:()=>M,ShareLinkDialogModule:()=>k});var _=i(50555),d=i(81771),S=i(52081),f=i(90721),C=i(53461),e=i(65879),A=i(91486),p=i(71365),m=i(1189),L=i(85540),E=i(96814),h=i(56223),D=i(35799),O=i(32296),P=i(75986),c=i(64170),R=i(24516),b=i(82599);function x(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"es-calendar",20),e.NdJ("dateChange",function(n){e.CHM(t);const l=e.oxw();return e.KtG(l.expiryDate=n)}),e.ALo(1,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.s9C("label",e.lcZ(1,3,"WORKSPACE.SHARE_LINK.EXPIRY_LABEL")),e.Q6J("date",t.expiryDate)("minDate",t.today)}}function v(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"es-input-password",21),e.NdJ("change",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.setPassword())})("valueChange",function(n){e.CHM(t);const l=e.oxw();return e.KtG(l.passwordString=n)}),e.ALo(1,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.s9C("label",e.lcZ(1,2,t.passwordAlreadySet?"WORKSPACE.SHARE_LINK.PASSWORD_PLACEHOLDER_EDIT":"WORKSPACE.SHARE_LINK.PASSWORD_PLACEHOLDER")),e.Q6J("value",t.passwordString)}}const y=function(o){return{count:o}};function I(o,u){if(1&o&&(e.TgZ(0,"div",22),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,1,"WORKSPACE.SHARE_LINK.LINK_DOWNLOADS",e.VKq(4,y,t.currentShare.downloadCount))," ")}}let M=(()=>{class o{constructor(t,a,n,l,s){this.data=t,this.dialogRef=a,this.nodeService=n,this.translate=l,this.toast=s,this.enabled=!1,this.expiry=!1,this.passwordEnabled=!1,this.today=new Date,this.currentShare={},this.dialogRef.patchState({isLoading:!0})}ngOnInit(){this.setNode(this.data.node)}set expiryDate(t){this._expiryDate=t,this.setExpiry(!0)}get expiryDate(){return this._expiryDate}copyClipboard(){if(this.enabled)try{f.d.copyToClipboard(this.currentShare.url),this.toast.toast("WORKSPACE.SHARE_LINK.COPIED_CLIPBOARD")}catch{this.toast.error(null,"WORKSPACE.SHARE_LINK.COPIED_CLIPBOARD_ERROR")}}cancel(){this.dialogRef.close()}setEnabled(t){t?this.createShare():(this.deleteShare(),this.expiry=!1,this.passwordEnabled=!1)}setNode(t){this._node=t,this.dialogRef.patchState({isLoading:!0}),this.nodeService.getNodeShares(t.ref.id,d.u6.SHARE_LINK).subscribe(a=>{this._expiryDate=new Date((new Date).getTime()+864e5),a.length?(this.currentShare=a[0],this.expiry=a[0].expiryDate>0,this.passwordEnabled=a[0].password,this.passwordEnabled&&(this.passwordAlreadySet=!0),this.currentDate=a[0].expiryDate,this.expiry&&(this.expiryDate=new Date(a[0].expiryDate)),0==a[0].expiryDate?(this.enabled=!1,this.dialogRef.patchState({isLoading:!1}),this.currentShare.url=this.translate.instant("WORKSPACE.SHARE_LINK.DISABLED")):(this.enabled=!0,this.dialogRef.patchState({isLoading:!1}))):this.createShare()},a=>this.toast.error(a))}updateShare(t=this.currentDate){this.currentShare.url=this.translate.instant("LOADING"),this.nodeService.updateNodeShare(this._node.ref.id,this.currentShare.shareId,t,this.getPasswordParameter()).subscribe(a=>{this.currentShare=a,0==t&&(this.currentShare.url=this.translate.instant("WORKSPACE.SHARE_LINK.DISABLED"))})}getPasswordParameter(){return this.passwordEnabled&&this.passwordString?this.passwordString:this.passwordEnabled&&this.passwordAlreadySet?null:""}setExpiry(t){this.enabled&&(this.currentDate=t?S.Ov.getDateFromDatepicker(this.expiryDate).getTime():d.u6.SHARE_EXPIRY_UNLIMITED,this.updateShare())}setPassword(){this.passwordEnabled||(this.passwordString=null,this.passwordAlreadySet=!1),this.updateShare()}createShare(){this.dialogRef.patchState({isLoading:!0}),this.nodeService.createNodeShare(this._node.ref.id).subscribe(t=>{this.passwordAlreadySet=!1,this.currentShare=t,this.dialogRef.patchState({isLoading:!1}),this.enabled=!0},t=>this.toast.error(t))}deleteShare(){this.dialogRef.patchState({isLoading:!0}),this.nodeService.deleteNodeShare(this._node.ref.id,this.currentShare.shareId).subscribe(()=>{this.currentShare={},this.dialogRef.patchState({isLoading:!1})})}static#e=this.\u0275fac=function(a){return new(a||o)(e.Y36(C.W9),e.Y36(A.Y),e.Y36(d.xE),e.Y36(p.sK),e.Y36(m.F))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["es-share-link-dialog"]],decls:45,vars:37,consts:[[1,"group"],[1,"configuration-link"],[1,"info-left"],[1,"heading"],[3,"label","date","minDate","dateChange",4,"ngIf"],[1,"info-right"],[3,"ngModel","disabled","ngModelChange","change"],[3,"value","label","change","valueChange",4,"ngIf"],[1,"link"],[1,"info"],[1,"info-checkbox"],[3,"ngModel","ngModelChange","change"],[1,"info","link-info"],[1,"linkInput","info-left"],["matInput","","readonly","true",3,"disabled","ngModel","click","ngModelChange"],["shareUrl",""],[1,"copyLink"],["mat-raised-button","",1,"link-copy",3,"disabled","click","keyup.enter"],[1,"link-info"],["class","link-downloads",4,"ngIf"],[3,"label","date","minDate","dateChange"],[3,"value","label","change","valueChange"],[1,"link-downloads"]],template:function(a,n){if(1&a){const l=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.YNc(9,x,2,5,"es-calendar",4),e.qZA(),e.TgZ(10,"div",5)(11,"mat-slide-toggle",6),e.NdJ("ngModelChange",function(r){return n.expiry=r})("change",function(){return n.setExpiry(n.expiry)}),e.qZA()()(),e.TgZ(12,"div",1)(13,"div",2)(14,"div",3),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"p"),e._uU(18),e.ALo(19,"translate"),e.qZA()(),e.TgZ(20,"div",5)(21,"mat-slide-toggle",6),e.NdJ("ngModelChange",function(r){return n.passwordEnabled=r})("change",function(){return n.setPassword()}),e.qZA()(),e.YNc(22,v,2,4,"es-input-password",7),e.qZA()(),e.TgZ(23,"div",8)(24,"div",9)(25,"div",10)(26,"mat-checkbox",11),e.NdJ("ngModelChange",function(r){return n.enabled=r})("change",function(){return n.setEnabled(n.enabled)}),e._uU(27),e.ALo(28,"translate"),e.qZA()()(),e.TgZ(29,"div",12)(30,"mat-form-field",13)(31,"mat-label"),e._uU(32),e.ALo(33,"translate"),e.qZA(),e.TgZ(34,"input",14,15),e.NdJ("click",function(){e.CHM(l);const r=e.MAs(35);return e.KtG(r.select())})("ngModelChange",function(r){return n.currentShare.url=r}),e.qZA()(),e.TgZ(36,"div",16)(37,"button",17),e.NdJ("click",function(){return n.copyClipboard()})("keyup.enter",function(){return n.copyClipboard()}),e._uU(38),e.ALo(39,"translate"),e.qZA()()()(),e.TgZ(40,"div",0)(41,"div",18),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.YNc(44,I,3,6,"div",19),e.qZA()}2&a&&(e.xp6(4),e.Oqu(e.lcZ(5,21,"WORKSPACE.SHARE_LINK.EXPIRY_TITLE")),e.xp6(3),e.Oqu(e.lcZ(8,23,"WORKSPACE.SHARE_LINK.EXPIRY_INFO")),e.xp6(2),e.Q6J("ngIf",n.expiry),e.xp6(2),e.Q6J("ngModel",n.expiry)("disabled",!n.enabled),e.xp6(4),e.Oqu(e.lcZ(16,25,"WORKSPACE.SHARE_LINK.PASSWORD")),e.xp6(3),e.Oqu(e.lcZ(19,27,"WORKSPACE.SHARE_LINK.PASSWORD_INFO")),e.xp6(3),e.Q6J("ngModel",n.passwordEnabled)("disabled",!n.enabled),e.xp6(1),e.Q6J("ngIf",n.passwordEnabled),e.xp6(4),e.Q6J("ngModel",n.enabled),e.xp6(1),e.Oqu(e.lcZ(28,29,"WORKSPACE.SHARE_LINK.ACTIVATE")),e.xp6(2),e.ekj("link-disabled",!n.enabled),e.xp6(3),e.Oqu(e.lcZ(33,31,"WORKSPACE.SHARE_LINK.LINK")),e.xp6(2),e.Q6J("disabled",!n.enabled)("ngModel",n.currentShare.url),e.xp6(3),e.Q6J("disabled",!n.enabled),e.xp6(1),e.hij(" ",e.lcZ(39,33,"WORKSPACE.SHARE_LINK.COPY_CLIPBOARD")," "),e.xp6(4),e.hij(" ",e.lcZ(43,35,"WORKSPACE.SHARE_LINK.LINK_INFO"+(n._node.isDirectory?"_FOLDER":""))," "),e.xp6(2),e.Q6J("ngIf",n.enabled))},dependencies:[L.e,E.O5,h.Fj,h.JJ,h.On,D.P,O.lW,P.oG,c.KE,c.hX,R.Nt,b.Rr,p.X$],styles:[".group[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}.group[_ngcontent-%COMP%]   .info-checkbox[_ngcontent-%COMP%]{padding-bottom:10px}.group[_ngcontent-%COMP%]   .configuration-link[_ngcontent-%COMP%]{position:relative;margin-bottom:20px}.group[_ngcontent-%COMP%]   .info-left[_ngcontent-%COMP%]{width:100%}.group[_ngcontent-%COMP%]   .info-right[_ngcontent-%COMP%]{position:relative;text-align:right}.group[_ngcontent-%COMP%]   .info-right[_ngcontent-%COMP%]   .switch[_ngcontent-%COMP%]{float:right}.copyLink[_ngcontent-%COMP%]{padding-left:10px;margin-top:10px}.heading[_ngcontent-%COMP%]{font-weight:700}.link[_ngcontent-%COMP%]{background-color:#fff}.link-info[_ngcontent-%COMP%], .link-downloads[_ngcontent-%COMP%]{display:block;width:100%;line-height:1.5}.link-info[_ngcontent-%COMP%]{padding:10px 0 5px;display:flex}.link-info[_ngcontent-%COMP%]   .linkInput[_ngcontent-%COMP%]{flex-grow:1}es-input-password[_ngcontent-%COMP%]{margin-top:10px}.link-disabled[_ngcontent-%COMP%]{filter:blur(2px)}"]})}return o})(),k=(()=>{class o{static#e=this.\u0275fac=function(a){return new(a||o)};static#t=this.\u0275mod=e.oAB({type:o});static#n=this.\u0275inj=e.cJS({imports:[_.m]})}return o})()}}]);