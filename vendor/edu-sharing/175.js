"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[175],{20175:(N,l,r)=>{r.r(l),r.d(l,{ShareHistoryDialogComponent:()=>E,ShareHistoryDialogModule:()=>H});var f=r(50555),p=r(81771),v=r(64634),h=r(52081),O=r(53461),t=r(65879),_=r(91486),S=r(1189),A=r(76754),u=r(71365),m=r(96814);function y(n,d){1&n&&(t.TgZ(0,"div",2),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"WORKSPACE.SHARE.HISTORY.EMPTY"),"\n"))}function T(n,d){if(1&n&&(t.TgZ(0,"div",15)(1,"span",5),t._uU(2),t.qZA(),t.TgZ(3,"span",16),t._uU(4),t.qZA()()),2&n){const i=d.$implicit;t.xp6(2),t.Oqu(i.name),t.xp6(2),t.hij("(",i.permissions,")")}}function C(n,d){if(1&n&&(t.TgZ(0,"div",12)(1,"div",13)(2,"i",6),t._uU(3,"add_circle_outline"),t.qZA(),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.YNc(6,T,5,2,"div",14),t.qZA()),2&n){const i=t.oxw().$implicit;t.xp6(4),t.hij(" ",t.lcZ(5,2,"WORKSPACE.SHARE.HISTORY.ADDED")," "),t.xp6(2),t.Q6J("ngForOf",i.added)}}function P(n,d){if(1&n&&(t.TgZ(0,"div",15)(1,"span",5),t._uU(2),t.qZA(),t.TgZ(3,"span",18),t._uU(4),t.qZA(),t.TgZ(5,"span",16),t._uU(6),t.qZA()()),2&n){const i=d.$implicit;t.xp6(2),t.Oqu(i.name),t.xp6(2),t.hij("(",i.oldPermissions,")"),t.xp6(2),t.hij("(",i.permissions,")")}}function x(n,d){if(1&n&&(t.TgZ(0,"div",17)(1,"div",13)(2,"i",6),t._uU(3,"autorenew"),t.qZA(),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.YNc(6,P,7,3,"div",14),t.qZA()),2&n){const i=t.oxw().$implicit;t.xp6(4),t.hij(" ",t.lcZ(5,2,"WORKSPACE.SHARE.HISTORY.CHANGED")," "),t.xp6(2),t.Q6J("ngForOf",i.modified)}}function M(n,d){if(1&n&&(t.TgZ(0,"div",15)(1,"span",5),t._uU(2),t.qZA(),t.TgZ(3,"span",16),t._uU(4),t.qZA()()),2&n){const i=d.$implicit;t.xp6(2),t.Oqu(i.name),t.xp6(2),t.hij("(",i.permissions,")")}}function R(n,d){if(1&n&&(t.TgZ(0,"div",19)(1,"div",13)(2,"i",6),t._uU(3,"remove_circle_outline"),t.qZA(),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.YNc(6,M,5,2,"div",14),t.qZA()),2&n){const i=t.oxw().$implicit;t.xp6(4),t.hij(" ",t.lcZ(5,2,"WORKSPACE.SHARE.HISTORY.REMOVED")," "),t.xp6(2),t.Q6J("ngForOf",i.removed)}}function Z(n,d){if(1&n&&(t.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"i",6),t._uU(4,"person"),t.qZA(),t._uU(5),t.qZA(),t.TgZ(6,"div",7),t._uU(7),t.qZA()(),t.TgZ(8,"div",8),t.YNc(9,C,7,4,"div",9),t.YNc(10,x,7,4,"div",10),t.YNc(11,R,7,4,"div",11),t.qZA()()),2&n){const i=d.$implicit;t.xp6(5),t.hij(" ",i.user,""),t.xp6(2),t.Oqu(i.date),t.xp6(2),t.Q6J("ngIf",i.added.length),t.xp6(1),t.Q6J("ngIf",i.modified.length),t.xp6(1),t.Q6J("ngIf",i.removed.length)}}let E=(()=>{class n{constructor(i,e,o,s,a,c){this.data=i,this.dialogRef=e,this.nodeApi=o,this.toast=s,this.nodeHelper=a,this.translation=c,this.STATUS_SAME=0,this.STATUS_ADD=1,this.STATUS_CHANGE=2,this.loadHistory()}loadHistory(){this.dialogRef.patchState({isLoading:!0}),this.nodeApi.getNodePermissionsHistory(this.data.node.ref.id).subscribe(i=>{this.processHistory(i),this.dialogRef.patchState({isLoading:!1})},i=>{this.toast.error(i),this.close()})}close(){this.dialogRef.close()}processHistory(i){this.history=[];let e=0;for(const o of i){const s={added:[],modified:[]};s.removed=e<i.length-1?this.getRemoved(o.permissions.permissions,i[e+1].permissions.permissions):[],s.date=h.Ov.formatDate(this.translation,o.date),s.user=this.nodeHelper.getUserDisplayName(o.user);for(const a of o.permissions.permissions)if(e<i.length-1){const c=this.getPermissionStatus(a,i[e+1]),g=c.status;g==this.STATUS_SAME||(g==this.STATUS_CHANGE?s.modified.push(this.convertPermission(a,c.permissions)):g==this.STATUS_ADD&&s.added.push(this.convertPermission(a)))}else s.added.push(this.convertPermission(a));(s.added.length||s.modified.length||s.removed.length)&&this.history.push(s),e++}}getRemoved(i,e){const o=[];for(const s of e){let a=!0;for(const c of i)c.authority.authorityName===s.authority.authorityName&&(a=!1);a&&o.push(this.convertPermission(s))}return o}getPermissionStatus(i,e){for(const o of e.permissions.permissions)if(o.authority.authorityName===i.authority.authorityName)return v.W.arrayEquals(o.permissions,i.permissions)?{status:this.STATUS_SAME}:{status:this.STATUS_CHANGE,permissions:o.permissions};return{status:this.STATUS_ADD}}convertPermission(i,e=null){const o={};o.name=i.user?(i.user.firstName+" "+i.user.lastName).trim():i.group?i.group.displayName:i.authority.authorityName===p.u6.AUTHORITY_EVERYONE?this.translation.instant("GROUP_EVERYONE"):i.authority.authorityName,i.permissions=this.cleanupPermissions(i.permissions),e=this.cleanupPermissions(e);const s=[];for(const a of i.permissions)s.push(this.translation.instant("PERMISSION_TYPE."+a));if(o.permissions=s.join(", "),e){const a=[];for(const c of e)a.push(this.translation.instant("PERMISSION_TYPE."+c));o.oldPermissions=a.join(", ")}return o}cleanupPermissions(i){if(null==i)return i;const e=i.indexOf(p.u6.PERMISSION_ALL);-1!=e&&i.splice(e,1,p.u6.PERMISSION_COORDINATOR);const o=i.indexOf(p.u6.PERMISSION_COORDINATOR),s=i.indexOf(p.u6.PERMISSION_COLLABORATOR),a=i.indexOf(p.u6.PERMISSION_CONSUMER);return-1!=o?(-1!=s&&i.splice(s,1),-1!=a&&i.splice(a,1)):-1!=s&&-1!=a&&i.splice(a,1),i}static#t=this.\u0275fac=function(e){return new(e||n)(t.Y36(O.W9),t.Y36(_.Y),t.Y36(p.xE),t.Y36(S.F),t.Y36(A.G),t.Y36(u.sK))};static#i=this.\u0275cmp=t.Xpm({type:n,selectors:[["es-share-history-dialog"]],decls:2,vars:2,consts:[["class","empty",4,"ngIf"],["class","groupHistory",4,"ngFor","ngForOf"],[1,"empty"],[1,"groupHistory"],[1,"heading"],[1,"name"],[1,"material-icons"],[1,"date"],[1,"content"],["class","group added",4,"ngIf"],["class","group changed",4,"ngIf"],["class","group removed",4,"ngIf"],[1,"group","added"],[1,"type"],["class","entry",4,"ngFor","ngForOf"],[1,"entry"],[1,"permissions"],[1,"group","changed"],[1,"permissionsOld"],[1,"group","removed"]],template:function(e,o){1&e&&(t.YNc(0,y,3,3,"div",0),t.YNc(1,Z,12,5,"div",1)),2&e&&(t.Q6J("ngIf",!(o.history&&o.history.length||o.dialogRef.state.isLoading)),t.xp6(1),t.Q6J("ngForOf",o.history))},dependencies:[m.sg,m.O5,h.ar,u.X$],styles:[".groupHistory[_ngcontent-%COMP%]{width:100%}.heading[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid #aaa;background:#f7f7f7}.heading[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:relative;top:7px}.heading[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:700}.heading[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:var(--textLight);padding-left:27px}.empty[_ngcontent-%COMP%]{text-align:center;padding-top:10%;font-size:120%;color:var(--textLight)}.content[_ngcontent-%COMP%]{padding-bottom:20px}.group[_ngcontent-%COMP%]{padding:10px 30px}.group[_ngcontent-%COMP%]   .entry[_ngcontent-%COMP%]{padding:5px 20px}.group[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin-right:5px}.group[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]{font-weight:700;padding-bottom:5px}.group[_ngcontent-%COMP%]   .type[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;position:relative;top:3px}.group[_ngcontent-%COMP%]   .permissions[_ngcontent-%COMP%], .group[_ngcontent-%COMP%]   .permissionsOld[_ngcontent-%COMP%]{color:var(--textLight)}.group[_ngcontent-%COMP%]   .permissionsOld[_ngcontent-%COMP%]{text-decoration:line-through}"]})}return n})(),H=(()=>{class n{static#t=this.\u0275fac=function(e){return new(e||n)};static#i=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[f.m]})}return n})()}}]);