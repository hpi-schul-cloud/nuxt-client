"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[4939],{84939:(it,C,n)=>{n.r(C),n.d(C,{FileChooserDialogComponent:()=>V,FileChooserDialogModule:()=>q});var I=n(50555),c=n(52081),T=n(49193),b=n(45125),O=n(72079),d=n(96124),v=n(32068),F=n(75222),y=n(19352),E=n(24521),u=n(17927),l=n(81771),M=n(90721),L=n(47159),A=n(53461),x=n(19445),t=n(65879),R=n(91486),w=n(1189),S=n(71365),N=n(98617),g=n(96814),h=n(56223),f=n(64170),P=n(24516),_=n(74104);const H=["bottomBarContent"];function Z(o,r){1&o&&(t.TgZ(0,"div",4),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"WORKSPACE.FILE_CHOOSER.HOME_FOLDER_NO_PERMISSIONS")," "))}function $(o,r){1&o&&(t.TgZ(0,"div",4),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"WORKSPACE.FILE_CHOOSER.NO_WRITE_PERMISSIONS")," "))}function Y(o,r){if(1&o&&(t.YNc(0,Z,3,3,"div",3),t.YNc(1,$,3,3,"div",3)),2&o){const e=t.oxw();t.Q6J("ngIf",!e.data.collections&&!e.path$.value.length&&!e.canSelectHome),t.xp6(1),t.Q6J("ngIf",!e.folderIsWritable())}}function W(o,r){if(1&o&&(t._UZ(0,"i",9),t.TgZ(1,"span",10),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o){const e=t.oxw().$implicit;t.Q6J("esIcon",e.homeIcon),t.xp6(2),t.Oqu(t.lcZ(3,2,e.label))}}function B(o,r){1&o&&t.GkF(0)}function Q(o,r){if(1&o&&(t.TgZ(0,"mat-tab"),t.YNc(1,W,4,4,"ng-template",7),t.YNc(2,B,1,0,"ng-container",8),t.qZA()),2&o){const e=r.$implicit;t.oxw(2);const i=t.MAs(4);t.xp6(2),t.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e)}}function J(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"mat-tab-group",5),t.NdJ("selectedTabChange",function(s){t.CHM(e);const a=t.oxw();return t.KtG(a.onTabChange(s))}),t.YNc(1,Q,3,2,"mat-tab",6),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.tabs)}}function U(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"es-breadcrumbs",16),t.NdJ("onClick",function(s){t.CHM(e);const a=t.oxw(2);return t.KtG(a.selectBreadcrumb(s))}),t.ALo(1,"translate"),t.qZA()}if(2&o){const e=t.oxw(),i=e.label,s=e.homeIcon,a=t.oxw();t.Q6J("createLink",!1)("home",a.homeOverride?a.homeOverride.label:t.lcZ(1,3,i))("homeIcon",a.homeOverride?a.homeOverride.icon:s)}}function K(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",17)(1,"form",18),t.NdJ("ngSubmit",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.search())}),t.TgZ(2,"mat-form-field",19),t._UZ(3,"mat-label")(4,"i",20),t.TgZ(5,"input",21),t.NdJ("ngModelChange",function(s){t.CHM(e);const a=t.oxw(2);return t.KtG(a.searchQuery=s)}),t.ALo(6,"translate"),t.qZA()()()()}if(2&o){const e=t.oxw(2);t.xp6(5),t.s9C("placeholder",t.lcZ(6,2,"NODE_SEARCH")),t.Q6J("ngModel",e.searchQuery)}}function j(o,r){1&o&&(t.TgZ(0,"h5",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_MORE_ELEMENTS")," "))}function G(o,r){1&o&&(t.TgZ(0,"h5",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NO_MATCHES")," "))}function X(o,r){if(1&o&&(t.YNc(0,j,3,3,"h5",22),t.YNc(1,G,3,3,"h5",22)),2&o){const e=t.oxw(2);t.Q6J("ngIf",!e.searchMode),t.xp6(1),t.Q6J("ngIf",e.searchMode)}}function k(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",11),t.YNc(1,U,2,5,"es-breadcrumbs",12),t.YNc(2,K,7,4,"div",13),t.TgZ(3,"es-node-entries-wrapper",14),t.NdJ("columnsChange",function(s){t.CHM(e);const a=t.oxw();return t.KtG(a.checkColumnState(s))})("sortChange",function(s){t.CHM(e);const a=t.oxw();return t.KtG(a.setSorting(s))})("clickItem",function(s){t.CHM(e);const a=t.oxw();return t.KtG(a.selectItem(s.element))})("fetchData",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.loadMore())})("scrolled",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.loadMore())}),t.YNc(4,X,2,2,"ng-template",null,15,t.W1O),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.searchMode),t.xp6(1),t.Q6J("ngIf",e.searchMode),t.xp6(1),t.Q6J("dataSource",e.list)("columns",e.columns)("configureColumns",!0)("displayType",e.displayType)("checkbox",!1)("sort",e.sort)("elementInteractionType",e.InteractionType.Emitter)("scrollWindow",!1)}}let V=(()=>{class o{get defaultSubtitle(){return this.defaultSubtitleSubject.value}set defaultSubtitle(e){this.defaultSubtitleSubject.next(e)}constructor(e,i,s,a,m,p,tt,et){this.data=e,this.dialogRef=i,this.connector=s,this.collectionApi=a,this.nodeApi=m,this.toast=p,this.breadcrumbsService=tt,this.translate=et,this.InteractionType=c.s_,this.path$=new b.X([]),this.columns=[],this.selectedFiles=[],this.displayType=c.P8.Table,this.defaultSubtitleSubject=new b.X(null),this.list=new c.AL,this.hasHeading=!0,this.tabs=[{label:"WORKSPACE.MY_FILES",homeIcon:"person",directory:l.u6.USERHOME,canSelectHome:!0},{label:"WORKSPACE.SHARED_FILES",homeIcon:"group",directory:l.u6.SHARED_FILES,canSelectHome:!1}],this.homeOverride=null,this.loadDirectoryTrigger=new O.xQ,this.columns.push(new c.HC("NODE",l.u6.CM_NAME))}ngOnInit(){this.processDialogData(),this.registerObservables(),this.initialize(),this.setDialogConfig(),this.defaultSubtitleSubject.pipe((0,d.U)(e=>this.data.subtitle??e),(0,v.x)()).subscribe(e=>this.dialogRef.patchConfig({subtitle:e}))}ngAfterViewInit(){this.dialogRef.patchConfig({customBottomBarContent:this.bottomBarContent})}setDialogConfig(){const e={title:this.data.title,width:600};this.dialogRef.patchConfig(e),this.cardIcon&&(e.avatar={kind:"icon",icon:this.cardIcon})}folderIsWritable(){return-1!==this.path$?.value?.[this.path$?.value?.length-1]?.access?.indexOf(l.u6.ACCESS_WRITE)}registerObservables(){this.loadDirectoryTrigger.pipe((0,F.w)(({directory:e,reset:i})=>this.loadDirectory(e,i))).subscribe(),this.path$.subscribe(e=>{this.breadcrumbsService.setNodePath(e),this.updateButtons()})}onTabChange(e){const i=this.tabs[e.index];this.setHomeDirectory(i.directory,{canSelectHome:i.canSelectHome})}setHomeDirectory(e,{canSelectHome:i=!1}){this.homeDirectory=e,this.canSelectHome=i,this.selectHome()}onSelection(e){this.selectedFiles=e}processDialogData(){this.data.pickDirectory&&(this.cardIcon="folder",this.data.filter.push(l.u6.FILTER_FOLDERS)),this.data.collections?(this.displayType=c.P8.SmallGrid,this.tabs=null,this.setHomeDirectory(l.u6.ROOT,{canSelectHome:!1}),this.hasHeading=!1,this.searchMode=!0,this.searchQuery="",this.columns=M.d.getDefaultCollectionColumns(),this.sort={active:l.u6.CM_MODIFIED_DATE,direction:"desc",columns:[]}):(this.columns=L.M.getColumns(this.connector),this.columns=this.columns.map((e,i)=>(e.visible=0===i,e)),this.sort={active:this.columns[0].name,direction:"asc",allowed:!0,columns:l.u6.POSSIBLE_SORT_BY_FIELDS.filter(e=>this.columns.some(i=>i.name===e.name))})}initialize(){this.homeDirectory?this.viewDirectory(this.homeDirectory):this.setHomeDirectory(this.tabs[0].directory,{canSelectHome:this.tabs[0].canSelectHome})}hasWritePermissions(e){return-1==e.access.indexOf(l.u6.ACCESS_WRITE)?{status:!1,message:"NO_WRITE_PERMISSIONS"}:{status:!0}}selectBreadcrumb(e){0===e?this.selectHome():this.selectItem(this.path$.value[e-1])}selectHome(){this.homeOverride=null,this.path$.next([]),this.viewDirectory(this.homeDirectory,!0)}selectItem(e){if(e.isDirectory||this.data.collections){if(this.searchMode)return this.selectedFiles=[e],void this.updateButtons();if(this.selectedFiles=[],this.path$.value?.[this.path$.value.length-1]?.ref.id===e.parent.id)this.path$.next([...this.path$.value,e]);else if(this.path$.value?.some(i=>i.ref.id===e.ref.id)){const i=this.path$.value.findIndex(s=>s.ref.id===e.ref.id);this.path$.next(this.path$.value.slice(0,i+1))}else 0===this.path$.value.length&&this.path$.next([e]),this.updatePathFromBackend(e.ref.id).pipe((0,y.R)(this.loadDirectoryTrigger.pipe((0,E.T)(1)))).subscribe();this.viewDirectory(e.ref.id)}}updatePathFromBackend(e){return this.nodeApi.getNodeParents(e).pipe((0,u.b)(i=>{this.path$.next(i.nodes.reverse()),i.scope||(this.homeOverride={label:null,icon:"SHARED_FILES"===i.scope?"group":"person"})}))}onSelectionChanged(e){this.selectedFiles=e,this.updateButtons()}search(){this.viewDirectory(this.homeDirectory)}viewDirectory(e,i=!0){this.loadDirectoryTrigger.next({directory:e,reset:i})}loadDirectory(e,i=!0){return this.currentDirectory=e,i&&this.list.reset(),this.isLoading=!0,this.data.collections?this.collectionApi.search(this.searchQuery,{offset:this.list.getData().length,sortBy:[this.sort.active],sortAscending:"asc"===this.sort.direction,propertyFilter:[l.u6.ALL]}).pipe((0,u.b)(s=>{const a=[];for(const m of s.collections){const p=m;p.collection=m,a.push(p)}this.showList({pagination:s.pagination,nodes:a})}),(0,d.U)(()=>{})):this.nodeApi.getChildren(e,this.data.filter,{offset:this.list.getData().length,sortBy:[this.sort.active],sortAscending:"asc"===this.sort.direction,propertyFilter:[l.u6.ALL]}).pipe((0,u.b)(s=>{this.showList(s)}),(0,d.U)(()=>{}))}loadMore(){this.list.hasMore()&&(this.viewDirectory(this.currentDirectory,!1),this.isLoading=!0)}setSorting(e){this.sort=e,this.list.reset(),this.viewDirectory(this.currentDirectory)}showList(e){this.addToList(e),this.updateButtons(),this.isLoading=!1}cancel(){this.dialogRef.close(null)}addToList(e){this.isLoading=!1,e.nodes.length&&(this.list.setPagination(e.pagination),this.list.appendData(e.nodes))}chooseDirectory(){(()=>this.path$.value.length?T.of(this.path$.value[this.path$.value.length-1]):this.nodeApi.getNodeMetadata(this.homeDirectory).pipe((0,d.U)(e=>e.node)))().subscribe(e=>{this.data.collections&&-1===e.access.indexOf(l.u6.ACCESS_WRITE)?this.toast.error(null,"NO_WRITE_PERMISSIONS"):this.dialogRef.close([e])})}chooseFile(){this.data.collections&&-1==this.selectedFiles[0].access.indexOf(l.u6.ACCESS_WRITE)?this.toast.error(null,"NO_WRITE_PERMISSIONS"):this.dialogRef.close(this.selectedFiles)}updateButtons(){const e=[new l.Qd(this.translate.instant("CANCEL"),{color:"standard"},()=>this.cancel())];let i;this.data.pickDirectory?(this.defaultSubtitle=this.path$.value.length?this.path$.value[this.path$.value.length-1].name:this.translate.instant("SELECT_ROOT_NAME"),i=new l.Qd(this.translate.instant("APPLY"),{color:"primary"},()=>this.chooseDirectory()),i.disabled=!this.path$.value.length&&!this.canSelectHome||!this.folderIsWritable()):this.data.collections&&!this.selectedFiles.length?(this.defaultSubtitle=null,i=new l.Qd("SELECT_ROOT_DISABLED",{color:"primary"},()=>{}),i.disabled=!0):this.selectedFiles.length&&(this.defaultSubtitle=this.selectedFiles[0].name,i=new l.Qd(this.translate.instant(this.data.collections?"SELECT_COLLECTION":"SELECT_FILE",{name:this.defaultSubtitle}),{color:"primary"},()=>this.chooseFile()),i.disabled=this.data.writeRequired&&0==this.hasWritePermissions(this.selectedFiles[0]).status),i&&e.push(i),this.dialogRef.patchConfig({buttons:e})}checkColumnState(e){e.filter(i=>i.visible).length>1?this.dialogRef.patchConfig({width:900}):this.dialogRef.patchConfig({width:600})}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(A.W9),t.Y36(R.Y),t.Y36(l.xD),t.Y36(l.i6),t.Y36(l.xE),t.Y36(w.F),t.Y36(x.d),t.Y36(S.sK))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["es-file-chooser-dialog"]],viewQuery:function(i,s){if(1&i&&t.Gf(H,5),2&i){let a;t.iGM(a=t.CRH())&&(s.bottomBarContent=a.first)}},features:[t._Bn([x.d])],decls:5,vars:2,consts:[["bottomBarContent",""],["mat-stretch-tabs","",3,"selectedTabChange",4,"ngIf","ngIfElse"],["tabContent",""],["class","no-permissions",4,"ngIf"],[1,"no-permissions"],["mat-stretch-tabs","",3,"selectedTabChange"],[4,"ngFor","ngForOf"],["mat-tab-label",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"tab-icon",3,"esIcon"],[1,"tab-label"],[1,"tab-content"],["class","breadcrumbFrame",3,"createLink","home","homeIcon","onClick",4,"ngIf"],["class","searchInputFrame",4,"ngIf"],["esInfiniteScroll","",1,"fileChooserList",3,"dataSource","columns","configureColumns","displayType","checkbox","sort","elementInteractionType","scrollWindow","columnsChange","sortChange","clickItem","fetchData","scrolled"],["empty",""],[1,"breadcrumbFrame",3,"createLink","home","homeIcon","onClick"],[1,"searchInputFrame"],["autocomplete","off",3,"ngSubmit"],["floatLabel","always"],["esIcon","search","matPrefix",""],["matInput","","type","search","name","search",3,"placeholder","ngModel","ngModelChange"],["class","noElements",4,"ngIf"],[1,"noElements"]],template:function(i,s){if(1&i&&(t.YNc(0,Y,2,2,"ng-template",null,0,t.W1O),t.YNc(2,J,2,1,"mat-tab-group",1),t.YNc(3,k,6,10,"ng-template",null,2,t.W1O)),2&i){const a=t.MAs(4);t.xp6(2),t.Q6J("ngIf",s.tabs)("ngIfElse",a)}},dependencies:[N.n,g.sg,g.O5,g.tP,c.ar,c.Ry,c.cE,h._Y,h.Fj,h.JJ,h.JL,h.On,h.F,f.KE,f.hX,f.qo,P.Nt,_.uD,_.uX,_.SP,S.X$],styles:["[_nghost-%COMP%]     es-node-entries-card-grid{display:block;margin:10px 20px}.fileChooserOut[_ngcontent-%COMP%]{padding:20px}.card-content[_ngcontent-%COMP%]{background-color:#fff}.no-permissions[_ngcontent-%COMP%]{display:flex;width:100%;text-align:center;justify-content:center;padding-bottom:10px}.mat-tab-group[_ngcontent-%COMP%]{height:100%;overflow:hidden}.tab-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.breadcrumbFrame[_ngcontent-%COMP%], .searchInputFrame[_ngcontent-%COMP%]{flex-shrink:0;padding:11px;margin:0;height:50px;z-index:2;width:100%;background-color:#fff;box-shadow:0 3px 3px #0000001a}.searchInputFrame[_ngcontent-%COMP%]{padding-top:10px;padding-bottom:0;height:auto;display:flex;align-items:center}.searchInputFrame[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{flex-grow:1}.searchInputFrame[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{display:flex;flex-grow:1;padding:0 10px}.searchInputFrame[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]     .mat-form-field-wrapper{width:100%}.listFrame[_ngcontent-%COMP%]{display:flex;min-height:0}.noElements[_ngcontent-%COMP%]{text-align:center;color:var(--textLight);display:inline-block;width:100%;padding-top:20px}.fileChooserList[_ngcontent-%COMP%]{padding-top:10px;overflow-y:auto;width:100%}"]})}return o})(),q=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({imports:[I.m,c.fn]})}return o})()}}]);