"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[6678],{56678:(K,r,s)=>{s.r(r),s.d(r,{DeleteNodesDialogComponent:()=>P,DeleteNodesDialogModule:()=>N});var E=s(50555),g=s(17927),c=s(96124),m=s(75222),a=s(81771),p=s(47562),f=s(53461),e=s(65879),C=s(91486),S=s(52081),u=s(76754),L=s(48098),O=s(1189),v=s(96814),h=s(56223),T=s(75986),D=s(12883),I=s(71365);function R(n,k){if(1&n){const t=e.EpF();e.TgZ(0,"div",1)(1,"mat-checkbox",2),e.NdJ("ngModelChange",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.shouldBlockImport=i)}),e.TgZ(2,"es-multi-line-label"),e.ynx(3,3),e._uU(4),e.ALo(5,"translate"),e.BQk(),e.ynx(6,4),e._uU(7),e.ALo(8,"translate"),e.BQk(),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.shouldBlockImport),e.xp6(3),e.hij(" ",e.lcZ(5,3,"WORKSPACE.DELETE_IMPORT_BLOCK")," "),e.xp6(3),e.hij(" ",e.lcZ(8,5,"WORKSPACE.DELETE_IMPORT_BLOCK_INFO")," ")}}let P=(()=>{class n{constructor(t,o,i,l,d,A,M,x,B){this.data=t,this.dialogRef=o,this.connector=i,this.localEvents=l,this.nodeHelper=d,this.nodeService=A,this.temporaryStorage=M,this.toast=x,this.usageService=B,this.dialogRef.patchState({isLoading:!0})}ngOnInit(){this.updateTitleAndMessage(),this.canBlockImport=this.getCanBlockImports(),this.shouldBlockImport=this.canBlockImport,this.dialogRef.patchConfig({buttons:[new a.Qd("CANCEL",{color:"standard"},()=>this.dialogRef.close()),new a.Qd("YES_DELETE",{color:"danger"},()=>this.onConfirm())]})}updateTitleAndMessage(){let o,t=!1;if(o="WORKSPACE.DELETE_TITLE"+(1===this.data.nodes.length?"_SINGLE":""),this.message="WORKSPACE.DELETE_MESSAGE"+(1===this.data.nodes.length?"_SINGLE":""),1===this.data.nodes.length){const i=this.data.nodes[0],l=a.bv.getName(i);this.messageParams={name:l},i.collection?(o="WORKSPACE.DELETE_TITLE_COLLECTION",this.message="WORKSPACE.DELETE_MESSAGE_COLLECTION"):this.nodeHelper.isNodePublishedCopy(i)?(o="WORKSPACE.DELETE_TITLE_PUBLISHED_COPY",this.message="WORKSPACE.DELETE_MESSAGE_PUBLISHED_COPY"):"folder-link"===i.mediatype?(o="WORKSPACE.DELETE_TITLE_FOLDER_LINK",this.message="WORKSPACE.DELETE_MESSAGE_FOLDER_LINK"):i.isDirectory&&(t=!0,this.usageService.getNodeUsages(i.ref.id,i.ref.repo).subscribe(({usages:d})=>{d.length>0&&(this.message="WORKSPACE.DELETE_MESSAGE_SINGLE_USAGES",this.messageParams={name:l,usages:d.length.toString()}),this.dialogRef.patchState({isLoading:!1})}))}this.dialogRef.patchConfig({title:o}),t||setTimeout(()=>{this.dialogRef.patchState({isLoading:!1})})}getCanBlockImports(){return this.connector.getCurrentLogin()?.isAdmin&&this.data.nodes.every(t=>null!=t.properties[a.u6.CCM_PROP_REPLICATIONSOURCE])}onConfirm(){this.dialogRef.patchState({isLoading:!0}),(0,p.k)(this.data.nodes.map(t=>this.processNode(t))).subscribe(({successes:t,errors:o})=>{0===o.length&&this.toast.toast("WORKSPACE.TOAST.DELETE_FINISHED"),this.dialogRef.close(t.length>0?{nodes:t,action:this.shouldBlockImport?"changed":"deleted"}:null),this.shouldBlockImport?this.localEvents.nodesChanged.emit(t):this.localEvents.nodesDeleted.emit(t)})}processNode(t){let o;return o=this.shouldBlockImport?this.blockImport(t):this.deleteNode(t),o.pipe((0,g.b)(()=>this.removeNodeFromClipboard(t)))}deleteNode(t){return this.nodeService.deleteNode(t.ref.id).pipe((0,c.U)(()=>t))}blockImport(t){return this.nodeService.editNodeMetadata(t.ref.id,{[a.u6.CCM_PROP_IMPORT_BLOCKED]:["true"]},{versionComment:a.u6.COMMENT_BLOCKED_IMPORT}).pipe((0,m.w)(o=>this.nodeService.setPermissions(o.ref.id,{inherited:!1,permissions:[]})),(0,c.U)(()=>t))}removeNodeFromClipboard(t){let o=this.temporaryStorage.get("workspace_clipboard");if(null!=o)for(const i of o.nodes)i.ref.id===t.ref.id&&o.nodes.splice(o.nodes.indexOf(i),1),0===o.nodes.length&&this.temporaryStorage.remove("workspace_clipboard")}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(f.W9),e.Y36(C.Y),e.Y36(a.xD),e.Y36(S.Xn),e.Y36(u.G),e.Y36(L.sX),e.Y36(a.xU),e.Y36(O.F),e.Y36(a.kD))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["es-delete-nodes-dialog"]],decls:3,vars:5,consts:[["class","block-import-checkbox",4,"ngIf"],[1,"block-import-checkbox"],[3,"ngModel","ngModelChange"],["slot","label"],["slot","description"]],template:function(o,i){1&o&&(e._uU(0),e.ALo(1,"translate"),e.YNc(2,R,9,7,"div",0)),2&o&&(e.hij("",e.xi3(1,2,i.message,i.messageParams),"\n"),e.xp6(2),e.Q6J("ngIf",i.canBlockImport))},dependencies:[v.O5,h.JJ,h.On,T.oG,D.w,I.X$],styles:[".block-import-checkbox[_ngcontent-%COMP%]{margin-top:20px}"]})}return n})(),N=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[E.m]})}return n})()}}]);