"use strict";(self.webpackChunkapp_as_web_component=self.webpackChunkapp_as_web_component||[]).push([[490],{90490:(St,R,s)=>{s.r(R),s.d(R,{NodeRelationsDialogComponent:()=>vt,NodeRelationsDialogModule:()=>Rt});var P=s(50555),M=s(2962),h=s(15861),d=s(56223),N=s(77504),Z=s(88419),p=s(81771),L=s(90721),f=s(53461),c=s(52081),t=s(65879),y=s(91486),D=s(34997),x=s(76754),O=s(48098),b=s(1189),_=s(96814),T=s(92596),w=s(17162),E=s(23680),C=s(32296),u=s(64170),J=s(98525),Q=s(12994),Y=s(96124),U=s(96776),F=s(97734),H=s(17927),B=s(75222),A=s(10723),m=s(46680),G=s(81955),K=s(86825),S=s(87548),j=s(42411),v=s(71365),I=s(24630),q=s(24516),k=s(65928);const X=["noPermissions"];function $(i,r){1&i&&t._UZ(0,"es-spinner-small",11)}function W(i,r){1&i&&(t.TgZ(0,"mat-option",14)(1,"div",15),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&i&&(t.Q6J("disabled",!0),t.xp6(2),t.Oqu(t.lcZ(3,2,"NODE_SEARCH_SELECTOR.NO_MATCHES")))}function V(i,r){1&i&&t.GkF(0)}function z(i,r){1&i&&(t.ynx(0),t._UZ(1,"i",21),t.ALo(2,"translate"),t.BQk()),2&i&&(t.xp6(1),t.s9C("matTooltip",t.lcZ(2,1,"NODE_SEARCH_SELECTOR.NO_PERMISSIONS")))}const tt=function(i){return{node:i}};function et(i,r){if(1&i&&(t.TgZ(0,"div",19),t.YNc(1,V,1,0,"ng-container",20),t.YNc(2,z,3,3,"ng-container",6),t.qZA()),2&i){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngTemplateOutlet",n.noPermissionsRef)("ngTemplateOutletContext",t.VKq(3,tt,e)),t.xp6(1),t.Q6J("ngIf",!n.noPermissionsRef)}}function nt(i,r){if(1&i&&(t.TgZ(0,"mat-option",16),t.YNc(1,et,3,5,"div",17),t._UZ(2,"es-node-row",18),t.qZA()),2&i){const e=r.$implicit,n=t.oxw(2);t.Q6J("value",e)("disabled",!n.hasPermissions(e)),t.xp6(1),t.Q6J("ngIf",!n.hasPermissions(e)),t.xp6(1),t.Q6J("node",e)("columns",n.columns)}}function ot(i,r){if(1&i&&(t.ynx(0),t.YNc(1,W,4,4,"mat-option",12),t.YNc(2,nt,3,5,"mat-option",13),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",0===(null==e.searchStatus.result?null:e.searchStatus.result.length)),t.xp6(1),t.Q6J("ngForOf",e.searchStatus.result)}}function it(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",22),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.showMds=!o.showMds)}),t.TgZ(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"button",23),t.NdJ("click",function(o){t.CHM(e);const a=t.oxw();return a.showMds=!a.showMds,t.KtG(o.stopPropagation())}),t._UZ(5,"i",24),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"NODE_SEARCH_SELECTOR.MORE_FILTERS")),t.xp6(3),t.Q6J("esIcon","keyboard_arrow_"+(e.showMds?"up":"down"))}}const st=function(){return{}};let at=(()=>{class i{constructor(e,n,o,a,l){this.searchApi=e,this.mdsService=n,this.translate=o,this.nodeHelper=a,this.changeDetectorRef=l,this.permissions=[],this.criteria=[],this.itemCount=25,this.onSelect=new t.vpe,this.searchStatus={loading:!1},this.input=new d.p4(""),this.showMds=!1,this.hasMds=!1}setOption(e){this.onSelect.emit(e.option.value),this.input.setValue("")}searchNodes(){let e=[];return this.input.value&&e.push({property:m.u.PRIMARY_SEARCH_CRITERIA,values:[this.input.value]}),this.values&&(e=e.concat(A.Y.convertCritierias(this.values,this.mdsEditor.currentWidgets))),e=e.concat(this.criteria),this.searchApi.search(e,[],{count:this.itemCount,sortBy:[m.u.LUCENE_SCORE],sortAscending:[!1]},m.u.CONTENT_TYPE_ALL,m.u.HOME_REPOSITORY,m.u.DEFAULT,[m.u.ALL],this.queryId,this.permissions).pipe((0,Y.U)(o=>o.nodes.sort((a,l)=>!this.hasPermissions(a)&&this.hasPermissions(l)?1:this.hasPermissions(a)&&!this.hasPermissions(l)?-1:0)))}ngAfterViewInit(){this.mdsService.getSet().subscribe(e=>{this.columns=G.h.getColumns(this.translate,e,this.columnsIds)}),(0,Q.aj)([this.input.valueChanges,this.mdsEditor.mdsEditorInstance.values]).pipe((0,U.b)(500),(0,F.h)(()=>!(this.input.value?.length<2&&(this.searchStatus={loading:!1},this.changeDetectorRef.detectChanges(),1))),(0,H.b)(()=>{this.searchStatus.loading=!0,this.changeDetectorRef.detectChanges()}),(0,B.w)(()=>this.searchNodes())).subscribe(e=>{this.searchStatus={loading:!1,result:e},this.changeDetectorRef.detectChanges()}),this.mdsEditor.loadMds(),this.mdsEditor.mdsEditorInstance.values.subscribe(e=>this.values=e)}hasPermissions(e){return this.permissions.every(n=>this.nodeHelper.getNodesRight([e],n,c.jj.Effective))}onMdsLoaded(){console.log("mds loaded",this.mdsEditor.currentWidgets),this.hasMds=this.mdsEditor.currentWidgets?.length>0}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(A.Y),t.Y36(j.x),t.Y36(v.sK),t.Y36(x.G),t.Y36(t.sBO))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["es-node-search-selector"]],contentQueries:function(n,o,a){if(1&n&&t.Suo(a,X,5),2&n){let l;t.iGM(l=t.CRH())&&(o.noPermissionsRef=l.first)}},viewQuery:function(n,o){if(1&n&&t.Gf(S.o,5),2&n){let a;t.iGM(a=t.CRH())&&(o.mdsEditor=a.first)}},inputs:{groupId:"groupId",queryId:"queryId",columnsIds:"columnsIds",label:"label",permissions:"permissions",criteria:"criteria",itemCount:"itemCount"},outputs:{onSelect:"onSelect"},decls:14,vars:12,consts:[["esIcon","search","matPrefix",""],["type","search","matInput","","name","authoritySearch",3,"matAutocomplete","formControl"],["inputElement",""],["matSuffix","",4,"ngIf"],[1,"mat-autocomplete-high",3,"optionSelected"],["autoGroup","matAutocomplete"],[4,"ngIf"],["class","more clickable",3,"click",4,"ngIf"],[1,"mds-wrapper"],[3,"embedded","editorMode","groupId","currentValues","onMdsLoaded"],["mds",""],["matSuffix",""],[3,"disabled",4,"ngIf"],["class","node-row-option",3,"value","disabled",4,"ngFor","ngForOf"],[3,"disabled"],[1,"no-match"],[1,"node-row-option",3,"value","disabled"],["class","missing-permissions",4,"ngIf"],[3,"node","columns"],[1,"missing-permissions"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["esIcon","security",3,"matTooltip"],[1,"more","clickable",3,"click"],["mat-icon-button","","color","primary",3,"click"],[3,"esIcon"]],template:function(n,o){if(1&n&&(t.TgZ(0,"mat-form-field")(1,"mat-label"),t._uU(2),t.qZA(),t._UZ(3,"i",0)(4,"input",1,2),t.YNc(6,$,1,0,"es-spinner-small",3),t.TgZ(7,"mat-autocomplete",4,5),t.NdJ("optionSelected",function(l){return o.setOption(l)}),t.YNc(9,ot,3,2,"ng-container",6),t.qZA()(),t.YNc(10,it,6,4,"div",7),t.TgZ(11,"div",8)(12,"es-mds-editor-wrapper",9,10),t.NdJ("onMdsLoaded",function(){return o.onMdsLoaded()}),t.qZA()()),2&n){const a=t.MAs(8);t.xp6(2),t.Oqu(o.label),t.xp6(2),t.Q6J("matAutocomplete",a)("formControl",o.input),t.xp6(2),t.Q6J("ngIf",o.searchStatus.loading),t.xp6(3),t.Q6J("ngIf",!o.searchStatus.loading),t.xp6(1),t.Q6J("ngIf",o.hasMds),t.xp6(1),t.Q6J("@switchDialog",o.showMds),t.xp6(1),t.Q6J("embedded",!0)("editorMode","search")("groupId",o.groupId)("currentValues",t.DdM(11,st))}},dependencies:[_.sg,_.O5,_.tP,T.gM,c.ar,c.G2,d.Fj,d.JJ,I.XC,E.ey,I.ZL,C.RK,u.KE,u.hX,u.qo,u.R9,q.Nt,d.oH,k.h,S.o,v.X$],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.node-row-option[_ngcontent-%COMP%]{height:auto;line-height:unset}.node-row-option.mat-option-disabled[_ngcontent-%COMP%]{color:var(--textMediumLight);cursor:not-allowed}.more[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative;z-index:1;width:100%;margin-top:-15px;padding:2px 15px;box-shadow:0 3px 3px #0000001a}.more[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{flex-grow:1}.mds-wrapper[_ngcontent-%COMP%]{background-color:#f9f9f9}.missing-permissions[_ngcontent-%COMP%]{position:absolute;height:100%;display:grid;grid-template-columns:auto auto;grid-gap:10px;justify-content:center;align-items:center;-webkit-backdrop-filter:blur(1px);backdrop-filter:blur(1px);z-index:2;padding:0 5px 0 16px;background-color:#ffffffe6;color:#383838;font-weight:700}[_nghost-%COMP%]     .mds-wrapper es-mds-editor-core{padding:10px 20px 0}[_nghost-%COMP%]     .mds-wrapper .clear-button{display:none}"],data:{animation:[(0,K.X$)("switchDialog",c.Le.switchDialogBoolean())]}})}return i})();var rt=s(99994);function lt(i,r){1&i&&(t.TgZ(0,"es-info-message",13),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NODE_RELATIONS.RELATION_COPY_HINT"),"\n"))}function ct(i,r){if(1&i&&(t.TgZ(0,"mat-option",14),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",t.lcZ(2,2,"NODE_RELATIONS.RELATION_TYPE_FULLY."+e)," ")}}function dt(i,r){1&i&&(t._UZ(0,"i",15),t.ALo(1,"translate")),2&i&&t.s9C("matTooltip",t.lcZ(1,1,"NODE_RELATIONS.NO_PERMISSIONS"))}function pt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",16)(1,"div",17),t._UZ(2,"es-node-row",18),t.TgZ(3,"button",19),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.openNode(o.swapRelation?o.target:o.source))}),t.ALo(4,"translate"),t._UZ(5,"i",20),t.qZA()(),t.TgZ(6,"div",21)(7,"span"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._UZ(10,"i",22),t.ALo(11,"translate"),t.TgZ(12,"span"),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.TgZ(15,"div",17),t._UZ(16,"es-node-row",18),t.TgZ(17,"button",19),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.openNode(o.swapRelation?o.source:o.target))}),t.ALo(18,"translate"),t._UZ(19,"i",20),t.qZA()()()}if(2&i){const e=t.oxw(),n=t.MAs(13);t.xp6(2),t.Q6J("node",e.swapRelation?e.target:e.source)("columns",n.columns),t.xp6(1),t.s9C("matTooltip",t.lcZ(4,11,"NODE_RELATIONS.OPEN_NODE")),t.xp6(2),t.Q6J("aria",!1),t.xp6(3),t.Oqu(t.lcZ(9,13,"NODE_RELATIONS.RELATION_TYPE."+e.RelationsInverted[e.form.get("relation").value])),t.xp6(2),t.s9C("altText",t.lcZ(11,15,"NODE_RELATIONS.RELATES_TO")),t.xp6(3),t.Oqu(t.lcZ(14,17,"NODE_RELATIONS.RELATION_TYPE."+e.form.get("relation").value)),t.xp6(3),t.Q6J("node",e.swapRelation?e.source:e.target)("columns",n.columns),t.xp6(1),t.s9C("matTooltip",t.lcZ(18,19,"NODE_RELATIONS.OPEN_NODE")),t.xp6(2),t.Q6J("aria",!1)}}function gt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",23)(1,"button",24),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return o.target=null,t.KtG(o.updateButtons())}),t._UZ(2,"i",25),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"button",26),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.swap())}),t._UZ(6,"i",27),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"button",28),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.createRelation())}),t._UZ(10,"i",29),t._uU(11),t.ALo(12,"translate"),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("aria",!1),t.xp6(1),t.hij(" ",t.lcZ(4,8,"NODE_RELATIONS.RESELECT")," "),t.xp6(2),t.Q6J("disabled",!e.isSwappable()),t.xp6(1),t.Q6J("aria",!1),t.xp6(1),t.hij(" ",t.lcZ(8,10,"NODE_RELATIONS.SWAP")," "),t.xp6(2),t.Q6J("disabled",!e.form.valid),t.xp6(1),t.Q6J("aria",!1),t.xp6(1),t.hij(" ",t.lcZ(12,12,"NODE_RELATIONS.CREATE_CONFIRM")," ")}}function ut(i,r){1&i&&(t.TgZ(0,"div",30),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"NODE_RELATIONS.NO_RELATIONS"),"\n"))}const mt=function(){return{relative:!1}};function _t(i,r){if(1&i&&(t.TgZ(0,"div",38)(1,"label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.ALo(6,"formatDate"),t.qZA()(),t.TgZ(7,"div",38)(8,"label"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"span"),t._uU(12),t.ALo(13,"authorityName"),t.qZA()()),2&i){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(t.lcZ(3,4,"NODE_RELATIONS.RELATION_CREATED")),t.xp6(3),t.Oqu(t.xi3(6,6,e.timestamp,t.DdM(13,mt))),t.xp6(4),t.Oqu(t.lcZ(10,9,"NODE_RELATIONS.RELATION_CREATOR")),t.xp6(3),t.Oqu(t.lcZ(13,11,e.creator))}}function ft(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"button",39),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,a=t.oxw(2);return t.KtG(a.removeRelation(o))}),t.ALo(1,"translate"),t._UZ(2,"i",40),t.qZA()}if(2&i){const e=t.oxw().$implicit,n=t.oxw(2);t.s9C("matTooltip",t.lcZ(1,3,"NODE_RELATIONS.REMOVE_RELATION")),t.Q6J("disabled",!n.canModify(e)),t.xp6(2),t.Q6J("aria",!1)}}function ht(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",41)(1,"div",42)(2,"div",43),t._UZ(3,"hr"),t.qZA(),t.TgZ(4,"div",44),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",43),t._UZ(8,"hr"),t.qZA()(),t.TgZ(9,"button",19),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,a=t.oxw(2);return t.KtG(a.deleteRelations.splice(a.deleteRelations.indexOf(o),1))}),t.ALo(10,"translate"),t._UZ(11,"i",45),t.qZA()()}2&i&&(t.xp6(5),t.Oqu(t.lcZ(6,3,"WORKSPACE.SHARE.DELETED")),t.xp6(4),t.s9C("matTooltip",t.lcZ(10,5,"NODE_RELATIONS.RESTORE_RELATION")),t.xp6(2),t.Q6J("aria",!1))}function Ot(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",17)(1,"es-node-row",18),t.YNc(2,_t,14,14,"ng-template",null,35,t.W1O),t.qZA(),t.TgZ(4,"button",19),t.NdJ("click",function(){const a=t.CHM(e).$implicit,l=t.oxw(2);return t.KtG(l.openNode(a.node))}),t.ALo(5,"translate"),t._UZ(6,"i",20),t.qZA(),t.YNc(7,ft,3,5,"button",36),t.YNc(8,ht,12,7,"div",37),t.qZA()}if(2&i){const e=r.$implicit,n=t.oxw(2);t.ekj("added",n.addRelations.includes(e)),t.xp6(1),t.Q6J("node",e.node)("columns",n.columns),t.xp6(3),t.s9C("matTooltip",t.lcZ(5,8,"NODE_RELATIONS.OPEN_NODE")),t.xp6(2),t.Q6J("aria",!1),t.xp6(1),t.Q6J("ngIf",!n.deleteRelations.includes(e)),t.xp6(1),t.Q6J("ngIf",n.deleteRelations.includes(e))}}function Ct(i,r){if(1&i&&(t.TgZ(0,"div",31)(1,"div")(2,"h5",32),t._uU(3),t.ALo(4,"nodeTitle"),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",33),t.YNc(7,Ot,9,10,"div",34),t.qZA()()()),2&i){const e=r.$implicit,n=t.oxw();t.xp6(3),t.AsE(' "',t.lcZ(4,3,n.source),'" ',t.lcZ(5,5,"NODE_RELATIONS.RELATION_TYPE."+e)," "),t.xp6(4),t.Q6J("ngForOf",n.getRelations(e))}}let vt=(()=>{class i{constructor(e,n,o,a,l,Nt,xt,Tt,Et,At){this.data=e,this.dialogRef=n,this.bridgeService=o,this.cdr=a,this.localEvents=l,this.nodeHelper=Nt,this.nodeService=xt,this.relationService=Tt,this.toast=Et,this.userService=At,this.Relations=Object.values(g),this.RelationsInverted={[g.isBasedOn]:"isBasisFor",[g.isPartOf]:"hasPart",[g.references]:"references"},this.addRelations=[],this.deleteRelations=[],this.form=new d.nJ({relation:new d.p4(g.isBasedOn,d.kI.required)}),this.permissions=[p.u6.PERMISSION_WRITE],this.columns=[new c.HC("NODE",p.u6.LOM_PROP_TITLE)],this.buttons=[new p.Qd("CANCEL",p.Qd.TYPE_CANCEL,()=>this.dialogRef.close(null)),new p.Qd("SAVE",p.Qd.TYPE_PRIMARY,()=>this.save())],this.dialogRef.patchState({isLoading:!0})}ngOnInit(){this.dialogRef.patchConfig({buttons:this.buttons}),this.initNode(this.data.node),this.updateButtons()}getRelationKeys(){return[...new Set(this.addRelations.concat(this.relations||[])?.map(e=>e.type))].sort()}swap(){this.swapRelation=!this.swapRelation}getCriteria(){return[{property:"sourceNode",values:[this.source.ref.id]}]}getAllExistingRelations(){return this.getAllRelations().filter(e=>!this.deleteRelations.includes(e))}getAllRelations(){return this.relations.concat(this.addRelations)}getRelations(e){return this.getAllRelations().filter(n=>n.type===e).sort((n,o)=>n.timestamp>o.timestamp?1:-1)}openNode(e){L.d.openUrl(this.nodeHelper.getNodeUrl(e,{closeOnBack:!0}),this.bridgeService,c.qU.Blank)}removeRelation(e){this.deleteRelations.includes(e)||this.deleteRelations.push(e),this.updateButtons()}resolveRelationSendData(e){const n=this.isInverted(e);let o=this.source.ref.id,a=e.node.ref.id,l=e.type;return n&&(o=e.node.ref.id,a=this.source.ref.id,l=n),{source:o,target:a,type:l}}save(){var e=this;return(0,h.Z)(function*(){e.toast.showProgressSpinner();try{yield(0,N.D)(e.addRelations.map(n=>{const o=e.resolveRelationSendData(n);return e.relationService.createRelation(o.source,o.target,o.type)})).toPromise(),yield(0,N.D)(e.deleteRelations.map(n=>{const o=e.resolveRelationSendData(n);return e.relationService.deleteRelation(o.source,o.target,o.type)})).toPromise(),e.dialogRef.close(!0),e.localEvents.nodesChanged.emit([e.data.node])}catch{}e.toast.closeProgressSpinner()})()}updateButtons(){const e=this.hasChanges();this.buttons[1].disabled=!e,this.dialogRef.patchConfig(e?{closable:f.IA.Confirm}:this.target?{closable:f.IA.Standard}:{closable:f.IA.Casual})}getCurrentType(){}createRelation(){var e=this;return(0,h.Z)(function*(){let n=e.form.get("relation").value;e.swapRelation&&(n=e.RelationsInverted[n]),e.getAllExistingRelations().find(o=>o.node.ref.id===e.target.ref.id&&o.type===n)?e.toast.error(null,"NODE_RELATIONS.RELATION_EXISTS"):(e.addRelations.push({node:e.target,type:n,timestamp:(new Date).getTime(),creator:(yield e.userService.observeCurrentUser().pipe((0,Z.P)()).toPromise()).person}),e.form.reset(),e.form.setValue({relation:g.isBasedOn}),e.swapRelation=!1,e.target=null,e.updateButtons())})()}isInverted(e){return Object.keys(this.RelationsInverted).find(n=>this.RelationsInverted[n]===e.type&&n!==e.type)}isPublishedCopy(){return!!this.source.properties[p.u6.CCM_PROP_PUBLISHED_ORIGINAL]?.[0]}isSwappable(){const e=this.form.get("relation").value;return this.RelationsInverted[e]!==e}canModify(e){return this.nodeHelper.getNodesRight([e.node],p.u6.PERMISSION_WRITE,c.jj.Effective)}hasChanges(){return this.addRelations?.length||this.deleteRelations?.length}initNode(e){var n=this;return(0,h.Z)(function*(){e.properties[p.u6.CCM_PROP_PUBLISHED_ORIGINAL]&&(e=yield n.nodeService.getNode(p.bv.removeSpacesStoreRef(e.properties[p.u6.CCM_PROP_PUBLISHED_ORIGINAL][0])).toPromise()),n.source=e,n.relationService.getRelations(e.ref.id).subscribe(o=>{n.relations=o.relations,n.dialogRef.patchState({isLoading:!1}),n.cdr.detectChanges()},o=>{n.dialogRef.close(null)})})()}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(f.W9),t.Y36(y.Y),t.Y36(D.d),t.Y36(t.sBO),t.Y36(c.Xn),t.Y36(x.G),t.Y36(O.sX),t.Y36(O.MV),t.Y36(b.F),t.Y36(O.KD))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["es-node-relations-dialog"]],decls:24,vars:26,consts:[["mode","info",4,"ngIf"],[1,"mat-heading-4"],[3,"formGroup"],["formElement",""],["formControlName","relation"],[3,"value",4,"ngFor","ngForOf"],[3,"groupId","queryId","columnsIds","permissions","criteria","label","onSelect"],["selector",""],["noPermissions",""],["class","relation-result",4,"ngIf"],["class","actions",4,"ngIf"],["class","relations-none",4,"ngIf"],["class","relations-group",4,"ngFor","ngForOf"],["mode","info"],[3,"value"],["esIcon","security",3,"matTooltip"],[1,"relation-result"],[1,"relation-node"],[3,"node","columns"],["mat-icon-button","","color","primary",3,"matTooltip","click"],["esIcon","open_in_new",3,"aria"],[1,"relation-details"],["esIcon","swap_horiz",3,"altText"],[1,"actions"],["mat-flat-button","","color","warn",3,"click"],["esIcon","clear",3,"aria"],["mat-button","","color","primary",3,"disabled","click"],["esIcon","swap_horiz",3,"aria"],["mat-flat-button","","color","primary",3,"disabled","click"],["esIcon","add",3,"aria"],[1,"relations-none"],[1,"relations-group"],[1,"mat-heading-5"],[1,"relation-nodes"],["class","relation-node",3,"added",4,"ngFor","ngForOf"],["customMetadata",""],["mat-icon-button","","color","primary",3,"disabled","matTooltip","click",4,"ngIf"],["class","deleted-overlay",4,"ngIf"],[1,"info-group"],["mat-icon-button","","color","primary",3,"disabled","matTooltip","click"],["esIcon","delete",3,"aria"],[1,"deleted-overlay"],[1,"deleted-info"],[1,"line"],[1,"info"],["esIcon","undo",3,"aria"]],template:function(n,o){1&n&&(t.YNc(0,lt,3,3,"es-info-message",0),t.TgZ(1,"h2",1),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"form",2,3)(6,"mat-form-field")(7,"mat-label"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"mat-select",4),t.YNc(11,ct,3,4,"mat-option",5),t.qZA()(),t.TgZ(12,"es-node-search-selector",6,7),t.NdJ("onSelect",function(l){return o.target=l,o.updateButtons()}),t.ALo(14,"translate"),t.YNc(15,dt,2,3,"ng-template",null,8,t.W1O),t.qZA()(),t.YNc(17,pt,20,21,"div",9),t.YNc(18,gt,13,14,"div",10),t.TgZ(19,"h2",1),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.YNc(22,ut,3,3,"div",11),t.YNc(23,Ct,8,7,"div",12)),2&n&&(t.Q6J("ngIf",o.isPublishedCopy()),t.xp6(2),t.Oqu(t.lcZ(3,18,"NODE_RELATIONS.CREATE_RELATION")),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(4),t.Oqu(t.lcZ(9,20,"NODE_RELATIONS.RELATION_TYPE_LABEL")),t.xp6(3),t.Q6J("ngForOf",o.Relations),t.xp6(1),t.ekj("display-none",o.target),t.s9C("label",t.lcZ(14,22,"NODE_RELATIONS.RELATION_SEARCH_LABEL")),t.Q6J("groupId","search_relation_node")("queryId","search_relation_query")("columnsIds","relationNodes")("permissions",o.permissions)("criteria",o.getCriteria()),t.xp6(5),t.Q6J("ngIf",o.target),t.xp6(1),t.Q6J("ngIf",o.target),t.xp6(2),t.Oqu(t.lcZ(21,24,"NODE_RELATIONS.EXISTING_RELATIONS")),t.xp6(2),t.Q6J("ngIf",!o.getRelationKeys().length),t.xp6(1),t.Q6J("ngForOf",o.getRelationKeys()))},dependencies:[_.sg,_.O5,T.gM,c.ar,c.G2,d._Y,d.JJ,d.JL,w.u,E.ey,C.lW,C.RK,u.KE,u.hX,J.gD,d.sg,d.u,at,rt.F,v.X$,c.ik,c.bB],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   es-node-search-selector[_ngcontent-%COMP%]{width:100%}h2[_ngcontent-%COMP%]:first-child{margin-top:0}.relation-result[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column;padding:20px 15px;background-color:#f9f9f9}.relation-result[_ngcontent-%COMP%]   .relation-node[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:1fr auto auto;grid-gap:10px;align-items:center;padding:5px 10px}.relation-result[_ngcontent-%COMP%]   .relation-details[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center;padding:10px 0}.relation-result[_ngcontent-%COMP%]   .relation-details[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{padding:0 5px}.relation-result[_ngcontent-%COMP%]   .relation-details[_ngcontent-%COMP%] > i[_ngcontent-%COMP%]{transform:rotate(90deg)}.relation-result[_ngcontent-%COMP%] > es-node-row[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto auto auto;grid-gap:20px;width:100%;justify-content:flex-end;padding-top:10px}.relations-none[_ngcontent-%COMP%]{font-size:110%;padding:20px 0;color:var(--textLight);text-align:center}.relations-group[_ngcontent-%COMP%]{display:grid;grid-gap:20px;grid-template-rows:repeat(auto-fit,1fr)}.relations-group[_ngcontent-%COMP%]   .relation-nodes[_ngcontent-%COMP%]{position:relative;display:grid;grid-template-rows:auto;grid-gap:10px;background-color:#f9f9f9;margin:10px 0}.relations-group[_ngcontent-%COMP%]   .relation-nodes[_ngcontent-%COMP%]   .relation-node[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto auto;grid-gap:10px;align-items:center;padding:5px 10px}.relations-group[_ngcontent-%COMP%]   .relation-nodes[_ngcontent-%COMP%]   .relation-node.added[_ngcontent-%COMP%]{border-radius:25px;border:2px dashed #42ca8d}.relations-group[_ngcontent-%COMP%]   .relation-nodes[_ngcontent-%COMP%]   .relation-node[_ngcontent-%COMP%] > .deleted-overlay[_ngcontent-%COMP%]{display:grid;grid-gap:20px;padding:5px 10px;grid-template-columns:1fr auto;align-items:center;position:absolute;width:100%;height:100%;background-color:#fff9;-webkit-backdrop-filter:blur(1px) saturate(50%);backdrop-filter:blur(1px) saturate(50%)}.relations-group[_ngcontent-%COMP%]   .relation-nodes[_ngcontent-%COMP%]   .relation-node[_ngcontent-%COMP%] > .deleted-overlay[_ngcontent-%COMP%]   .deleted-info[_ngcontent-%COMP%]{display:flex}.relations-group[_ngcontent-%COMP%]   .relation-nodes[_ngcontent-%COMP%]   .relation-node[_ngcontent-%COMP%] > .deleted-overlay[_ngcontent-%COMP%]   .deleted-info[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{flex-grow:1;padding:0 15px}.relations-group[_ngcontent-%COMP%]   .relation-nodes[_ngcontent-%COMP%]   .relation-node[_ngcontent-%COMP%] > .deleted-overlay[_ngcontent-%COMP%]   .deleted-info[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]:last-child{padding-right:40px}.relations-group[_ngcontent-%COMP%]   .relation-nodes[_ngcontent-%COMP%]   .relation-node[_ngcontent-%COMP%] > .deleted-overlay[_ngcontent-%COMP%]   .deleted-info[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;background:#000;height:1px}.info-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.info-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:var(--fontSizeXSmall);color:var(--textLight)}"],changeDetection:0})}return i})();var g=function(i){return i.isBasedOn="isBasedOn",i.isPartOf="isPartOf",i.references="references",i}(g||{});let Rt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#n=this.\u0275inj=t.cJS({imports:[P.m,c.yF,M.x]})}return i})()}}]);